import{e,b as a,H as l,$ as t,Y as s,u as i,j as o,a1 as n,a2 as r,k as d,S as c,K as u,a0 as m,l as g,a3 as p,F as h,a5 as v,ad as f,ae as w,m as y,a9 as _,c as V}from"./vue.js";import{L as U,b as C,c as D,T as x,m as b,s as k,g as $,f as P,o as L,n as H,p as O}from"./index.js";import{D as R,X as T,e as F,F as M,q as A,z as E,A as z,b as S,d as I,l as N,J as B,o as G,n as Z,E as j,G as Y,y as q}from"./vuetify.js";import{_ as X,g as J,I as K,e as Q,D as W,r as ee}from"./lmd-system.js";import{u as ae}from"./vuei18n.js";import{d as le}from"./pinia.js";const te=le("localeInfo",{state:()=>({currentLocale:U.getCurrentLocale()}),actions:{async changeLocale(e){this.currentLocale=e}}}),se={class:"pt-4 pb-3 change-name-form"},ie=e({__name:"change-nickname-form",emits:["changeSuccess","hideDialog"],setup(e,{emit:g}){const{t:p}=R(),{addToast:h}=C(),v=a(!1),f=a(!1),w=a({}),y=D(),_=g,V=[e=>!!e||p("Common.fieldRequired"),e=>e&&e.length>=2||p("User.NicknameVMsgMoreThan2Chars"),e=>e&&e.length<=30||p("User.NicknameVMsgLessThan30Chars")];l((()=>{w.value={name:y.currentUserData.name}}));const U=async()=>{if(f.value){v.value=!0;try{await y.changeNickname(w.value),h(p("User.UpdateSuccess")),x(),y.updateCurrentUserData()}catch(e){console.error(e);const a=e?.message;a&&h(a,"error")}finally{v.value=!1}}},x=()=>{_("hideDialog")};return(e,a)=>(m(),t(T,{modelValue:i(f),"onUpdate:modelValue":a[1]||(a[1]=e=>o(f)?f.value=e:null),onSubmit:s(U,["prevent"])},{default:n((()=>[r("div",se,[d(F,{class:"form-input",rules:V,density:"compact",modelValue:i(w).name,"onUpdate:modelValue":a[0]||(a[0]=e=>i(w).name=e),readonly:i(v),variant:"outlined",rounded:"lg"},null,8,["modelValue","readonly"])]),d(M,{style:{"border-top":"1px solid #EBEBF7"},class:"py-6 text-center justify-center"},{default:n((()=>[d(A,{variant:"outlined",onClick:x},{default:n((()=>[c(u(e.$t("User.Cancel")),1)])),_:1}),d(A,{variant:"flat",color:"primary",type:"submit",loading:i(v)},{default:n((()=>[c(u(e.$t("User.Submit")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"]))}}),oe=e({__name:"change-nickname-dialog",setup(e){const l=a(!1),s=D(),r=()=>{l.value=!1};return g((()=>s.changeNicknameViewVisible),(e=>{e&&(l.value=!0)})),(e,a)=>{const s=ie;return m(),t(E,{modelValue:i(l),"onUpdate:modelValue":a[0]||(a[0]=e=>o(l)?l.value=e:null),"min-width":"400","max-width":"480"},{default:n((()=>[d(z,{title:e.$t("User.ChangeName")},{append:n((()=>[d(A,{icon:"mdi-close",class:"ms-auto",size:"compact",elevation:"0",onClick:r})])),default:n((()=>[d(s,{onHideDialog:r,onChangeSuccess:r})])),_:1},8,["title"])])),_:1},8,["modelValue"])}}}),ne={class:"pt-4 pb-3 change-pwd-form"},re=e({__name:"change-pwd-form",emits:["changeSuccess","hideDialog"],setup(e,{emit:l}){const{t:g}=R(),{addToast:p}=C(),h=a(!1),v=a(!1),f=a({}),w=D(),y=l,_=e=>!!e||g("Common.fieldRequired"),V=[_,e=>e&&e.length>=8||g("User.PwdVMsgMoreThan8Chars"),e=>e&&e.length<=30||g("User.PwdVMsgLessThan30Chars"),e=>/[0-9]/.test(e)||g("User.PwdVMsgHasNum"),e=>/[A-Z]/.test(e)||g("User.PwdVMsgHasUppercase"),e=>/[a-z]/.test(e)||g("User.PwdVMsgHasLowercase")],U=async()=>{if(console.log("onSubmit changePwd",f.value),v.value){h.value=!0;try{await w.changePwd(f.value),p(g("User.UpdateSuccess")),x()}catch(e){console.error(e);const a=e?.message;a&&p(a,"error")}finally{h.value=!1}}},x=()=>{y("hideDialog")};return(e,a)=>(m(),t(T,{modelValue:i(v),"onUpdate:modelValue":a[3]||(a[3]=e=>o(v)?v.value=e:null),onSubmit:s(U,["prevent"])},{default:n((()=>[r("div",ne,[d(F,{class:"form-input",rules:[_],density:"compact",modelValue:i(f).oldPassword,"onUpdate:modelValue":a[0]||(a[0]=e=>i(f).oldPassword=e),type:"password",readonly:i(h),variant:"outlined",rounded:"lg",placeholder:e.$t("User.OldPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["rules","modelValue","readonly","placeholder"]),d(F,{class:"form-input",rules:V,density:"compact",modelValue:i(f).password,"onUpdate:modelValue":a[1]||(a[1]=e=>i(f).password=e),type:"password",readonly:i(h),variant:"outlined",rounded:"lg",placeholder:e.$t("User.NewPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(F,{class:"form-input",rules:V,density:"compact",modelValue:i(f).repeatPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>i(f).repeatPassword=e),type:"password",readonly:i(h),variant:"outlined",rounded:"lg",placeholder:e.$t("User.ConfirmPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd-confirm.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"])]),d(M,{style:{"border-top":"1px solid #EBEBF7"},class:"py-6 text-center justify-center"},{default:n((()=>[d(A,{variant:"outlined",onClick:x},{default:n((()=>[c(u(e.$t("User.Cancel")),1)])),_:1}),d(A,{variant:"flat",color:"primary",type:"submit",loading:i(h)},{default:n((()=>[c(u(e.$t("User.Submit")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"]))}}),de=e({__name:"change-pwd-dialog",setup(e){const l=a(!1),s=D(),r=()=>{l.value=!1};return g((()=>s.changePwdViewVisible),(e=>{e&&(l.value=!0)})),(e,a)=>{const s=re;return m(),t(E,{modelValue:i(l),"onUpdate:modelValue":a[0]||(a[0]=e=>o(l)?l.value=e:null),"min-width":"400","max-width":"480"},{default:n((()=>[d(z,{title:e.$t("User.ChangePwd")},{append:n((()=>[d(A,{icon:"mdi-close",class:"ms-auto",size:"compact",elevation:"0",onClick:r})])),default:n((()=>[d(s,{onHideDialog:r,onChangeSuccess:r})])),_:1},8,["title"])])),_:1},8,["modelValue"])}}}),ce={class:"reset-form-view"},ue={class:"d-flex flex-row",style:{"align-items":"center"}},me={style:{"font-size":"16px","font-weight":"bold"}},ge={class:"reset-tip"},pe=e({__name:"reset-pwd-form",emits:["back","resetPwdSuccess"],setup(e,{emit:l}){const t=a(!1),g=a(!1),h=a({}),{addToast:v}=C(),f=D(),{t:w}=R(),y=l,_=()=>{y("back")},V=e=>!!e||w("Common.fieldRequired"),U=[V,e=>e&&e.length>=8||w("User.PwdVMsgMoreThan8Chars"),e=>e&&e.length<=30||w("User.PwdVMsgLessThan30Chars"),e=>/[0-9]/.test(e)||w("User.PwdVMsgHasNum"),e=>/[A-Z]/.test(e)||w("User.PwdVMsgHasUppercase"),e=>/[a-z]/.test(e)||w("User.PwdVMsgHasLowercase")],b=[V,e=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)||w("User.EmailNotValid")],k=async()=>{console.log("sendCode"),await f.forgotPwd({email:h.value.email}),v(w("User.CodeSent"))},$=async()=>{if(g.value){t.value=!0;try{await f.resetPwd(h.value),v(w("User.PwdResetSuccess")),y("resetPwdSuccess")}catch(e){console.error(e)}finally{t.value=!1}}};return(e,a)=>(m(),p("div",ce,[r("div",ue,[d(A,{onClick:_,variant:"plain",style:{"margin-left":"-1rem"}},{default:n((()=>[d(I,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"24",icon:"mdi-chevron-left",color:"#FB6C00"})])),_:1}),r("div",me,u(e.$t("User.ResetPwd")),1)]),d(T,{class:"pt-4 pb-3 login-form",modelValue:i(g),"onUpdate:modelValue":a[4]||(a[4]=e=>o(g)?g.value=e:null),style:{margin:"auto","max-width":"350px"},onSubmit:s($,["prevent"])},{default:n((()=>[d(F,{class:"login-input",rules:b,density:"compact",modelValue:i(h).email,"onUpdate:modelValue":a[0]||(a[0]=e=>i(h).email=e),readonly:i(t),variant:"outlined",rounded:"lg",placeholder:e.$t("User.FormEmail")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/email.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),"append-inner":n((()=>[d(A,{onClick:k,variant:"text",size:"small",color:i(x).PRIMARY_COLOR},{default:n((()=>[c(u(e.$t("User.SendCode")),1)])),_:1},8,["color"])])),_:1},8,["modelValue","readonly","placeholder"]),d(F,{class:"login-input",rules:[V],density:"compact",modelValue:i(h).resetToken,"onUpdate:modelValue":a[1]||(a[1]=e=>i(h).resetToken=e),readonly:i(t),variant:"outlined",rounded:"lg",placeholder:e.$t("User.VerifyCode")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["rules","modelValue","readonly","placeholder"]),d(F,{class:"login-input",rules:U,density:"compact",modelValue:i(h).password,"onUpdate:modelValue":a[2]||(a[2]=e=>i(h).password=e),readonly:i(t),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.FormPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(F,{class:"login-input",rules:U,density:"compact",modelValue:i(h).repeatPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>i(h).repeatPassword=e),readonly:i(t),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.ConfirmPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd-confirm.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(A,{class:"submit-btn mt-3",height:"40",variant:"flat",type:"submit",loading:i(t)},{default:n((()=>[c(u(e.$t("User.Submit")),1)])),_:1},8,["loading"])])),_:1},8,["modelValue"]),r("div",ge,[d(I,{size:"18",color:i(x).PRIMARY_COLOR,icon:"mdi-information-outline"},null,8,["color"]),c(" "+u(e.$t("User.SendCodeTip")),1)])]))}}),he={class:"reg-form-view"},ve={class:"d-flex flex-row",style:{"align-items":"center"}},fe={style:{"font-size":"16px","font-weight":"bold"}},we=e({__name:"reg-form",emits:["back","registerSuccess"],setup(e,{emit:l}){const t=a(!1),g=a(!1),h=a({}),{addToast:v}=C(),f=D(),{t:w}=R(),y=l,_=()=>{y("back")},V=e=>!!e||w("Common.fieldRequired"),U=[V,e=>e&&e.length>=8||w("User.PwdVMsgMoreThan8Chars"),e=>e&&e.length<=30||w("User.PwdVMsgLessThan30Chars"),e=>/[0-9]/.test(e)||w("User.PwdVMsgHasNum"),e=>/[A-Z]/.test(e)||w("User.PwdVMsgHasUppercase"),e=>/[a-z]/.test(e)||w("User.PwdVMsgHasLowercase")],x=[V,e=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)||w("User.EmailNotValid")],b=async()=>{if(g.value){t.value=!0;try{await f.userRegister(h.value),y("registerSuccess")}catch(e){console.error(e)}finally{t.value=!1}}};return(e,a)=>(m(),p("div",he,[r("div",ve,[d(A,{onClick:_,variant:"plain",style:{"margin-left":"-1rem"}},{default:n((()=>[d(I,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"24",icon:"mdi-chevron-left",color:"#FB6C00"})])),_:1}),r("div",fe,u(e.$t("User.UserRegister")),1)]),d(T,{class:"pt-4 pb-3 px-0 login-form",modelValue:i(g),"onUpdate:modelValue":a[3]||(a[3]=e=>o(g)?g.value=e:null),onSubmit:s(b,["prevent"])},{default:n((()=>[d(F,{class:"login-input",rules:x,density:"compact",modelValue:i(h).email,"onUpdate:modelValue":a[0]||(a[0]=e=>i(h).email=e),readonly:i(t),variant:"outlined",rounded:"lg",placeholder:e.$t("User.FormEmail")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/email.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(F,{class:"login-input",rules:U,density:"compact",modelValue:i(h).password,"onUpdate:modelValue":a[1]||(a[1]=e=>i(h).password=e),readonly:i(t),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.FormPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(F,{class:"login-input",rules:U,density:"compact",modelValue:i(h).repeatPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>i(h).repeatPassword=e),readonly:i(t),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.ConfirmPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(A,{class:"submit-btn mt-7",height:"40",variant:"flat",type:"submit",loading:i(t)},{default:n((()=>[c(u(e.$t("User.Login")),1)])),_:1},8,["loading"])])),_:1},8,["modelValue"])]))}}),ye={class:"login-title"},_e={style:{"text-align":"center"},class:"mt-10"},Ve={style:{"text-align":"center","font-size":"12px","margin-top":"80px",color:"rgba(0,0,0,0.45)"}},Ue=["href"],Ce=["href"],De=e({__name:"login-form",emits:["loginSuccess","toResetPwdView","toRegisterView"],setup(e,{emit:l}){const{addToast:t}=C(),{t:g}=R(),v=a(!1),f=a(!1),w=a({}),y=D(),_=e=>!!e||g("Common.fieldRequired"),V=[_,e=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)||g("User.EmailNotValid")],U=[_],x=l,b=async()=>{if(f.value){v.value=!0;try{await y.userLogin(w.value),x("loginSuccess")}catch(e){console.error(e)}finally{v.value=!1}}},k=async()=>{x("toResetPwdView")},$=async()=>{x("toRegisterView")};return(e,a)=>(m(),p(h,null,[r("div",null,[r("div",ye,u(e.$t("User.EmailLogin")),1)]),d(T,{class:"pt-4 pb-3 px-0 login-form",modelValue:i(f),"onUpdate:modelValue":a[2]||(a[2]=e=>o(f)?f.value=e:null),onSubmit:s(b,["prevent"])},{default:n((()=>[d(F,{class:"login-input",rules:V,density:"compact",modelValue:i(w).email,"onUpdate:modelValue":a[0]||(a[0]=e=>i(w).email=e),readonly:i(v),variant:"outlined",rounded:"lg",placeholder:e.$t("User.FormEmail")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/email.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(F,{class:"login-input",rules:U,density:"compact",modelValue:i(w).password,"onUpdate:modelValue":a[1]||(a[1]=e=>i(w).password=e),readonly:i(v),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.FormPwd")},{"prepend-inner":n((()=>[d(S,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(A,{class:"submit-btn mt-7",height:"40",variant:"flat",type:"submit",loading:i(v)},{default:n((()=>[c(u(e.$t("User.Login")),1)])),_:1},8,["loading"]),r("div",_e,[r("a",{href:"#",onClick:s(k,["prevent"])},u(e.$t("User.ResetPwd")),1),a[3]||(a[3]=r("span",{class:"mx-3",style:{color:"#D2D8E6"}},"|",-1)),r("a",{href:"#",onClick:s($,["prevent"])},u(e.$t("User.UserRegister")),1)]),r("div",Ve,[c(u(e.$t("User.LoginPrivacyTip"))+" ",1),r("a",{href:e.$t("User.UserAggrementUrl"),target:"_blank"},u(e.$t("User.UserAggrement")),9,Ue),c(" "+u(e.$t("User.And"))+" ",1),r("a",{href:e.$t("User.PrivacyPolicyUrl"),target:"_blank"},u(e.$t("User.PrivacyPolicy")),9,Ce)])])),_:1},8,["modelValue"])],64))}}),xe={class:"left-side"},be={class:"headline"},ke={class:"login-tip"},$e={class:"login-tip-list"},Pe={class:"login-tip-item"},Le={class:"check-icon"},He={class:"tip-str"},Oe={class:"login-tip-item"},Re={class:"check-icon"},Te={class:"tip-str"},Fe={class:"login-tip-item"},Me={class:"check-icon"},Ae={class:"tip-str"};const Ee=X({},[["render",function(e,a){return m(),p("div",xe,[r("div",be,u(e.$t("App.AppName")),1),r("div",ke,u(e.$t("User.LoginTip")),1),r("div",$e,[r("div",Pe,[r("div",Le,[d(I,{color:"#FFF",icon:"mdi-check",size:"12"})]),r("div",He,u(e.$t("User.LoginTip1")),1)]),r("div",Oe,[r("div",Re,[d(I,{color:"#FFF",icon:"mdi-check",size:"12"})]),r("div",Te,u(e.$t("User.LoginTip2")),1)]),r("div",Fe,[r("div",Me,[d(I,{color:"#FFF",icon:"mdi-check",size:"12"})]),r("div",Ae,u(e.$t("User.LoginTip3")),1)])])])}],["__scopeId","data-v-0467a237"]]),ze={class:"d-flex flex-row"},Se={class:"right-side"},Ie={style:{"text-align":"right"}},Ne={key:0,style:{margin:"0 24px"}},Be={key:1,style:{margin:"0 24px"}},Ge={key:2,style:{margin:"0 8px"}},Ze=e({__name:"login-and-reg-dialog",setup(e){const s=a(!1),c=D(),u=a("login");l((()=>{w()})),g((()=>c.loginViewVisible),(e=>{e&&h()}));const h=()=>{s.value=!0,w()},f=()=>{s.value=!1},w=()=>{u.value="login"},y=()=>{u.value="reg"},_=()=>{u.value="resetpwd"};return(e,a)=>{const l=Ee,c=De,g=we,h=pe;return m(),t(E,{modelValue:i(s),"onUpdate:modelValue":a[0]||(a[0]=e=>o(s)?s.value=e:null),"max-width":"700",class:"login-dialog"},{default:n((()=>[d(N,{style:{"border-radius":"19px"},class:"mx-auto px-0 py-0 window-no-drag",width:"100%"},{default:n((()=>[r("div",ze,["login"===i(u)||"reg"===i(u)?(m(),t(l,{key:0})):v("",!0),r("div",Se,[r("div",Ie,[d(A,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:f})]),"login"===i(u)?(m(),p("div",Ne,[d(c,{onLoginSuccess:f,onToRegisterView:y,onToResetPwdView:_})])):"reg"===i(u)?(m(),p("div",Be,[d(g,{onRegisterSuccess:f,onBack:w})])):"resetpwd"===i(u)?(m(),p("div",Ge,[d(h,{onResetPwdSuccess:w,onBack:w})])):v("",!0)])])])),_:1})])),_:1},8,["modelValue"])}}}),je={class:"login-action-list"},Ye={class:"title"},qe={class:"title"},Xe={class:"login-action-list"},Je={class:"title"},Ke={class:"title"},Qe={class:"px-6 pb-6"},We=e({__name:"login-action-list",setup(e){const t=D(),s=a("");l((async()=>{const e=await b.getAppInfo();e&&(s.value=e.version)}));const o=()=>{t.showChangePwdView()},g=()=>{t.showChangeNicknameView()},v=async()=>{b.info()},f=async()=>{t.logout()},w=()=>{const e=document.createElement("a");e.href="https://daiyl.com",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)};return(e,a)=>(m(),p(h,null,[r("div",je,[r("div",{class:"item",onClick:o},[r("div",Ye,u(e.$t("User.ChangePwd")),1),d(I,{size:"16",icon:"mdi-chevron-right"})]),r("div",{class:"item",onClick:g},[r("div",qe,u(e.$t("User.ChangeName")),1),d(I,{size:"16",icon:"mdi-chevron-right"})])]),r("div",Xe,[r("div",{class:"item",onClick:w},[r("div",Je,u(e.$t("Common.officialSite")),1),d(I,{size:"16",icon:"mdi-chevron-right"})]),r("div",{class:"item",onClick:v},[r("div",Ke,u(e.$t("Common.version"))+" "+u(i(s)),1),d(I,{size:"16",icon:"mdi-chevron-right"})])]),r("div",Qe,[d(A,{variant:"outlined",onClick:f,style:{"background-color":"#FFF2F2",border:"none"},color:"#F2313F",width:"100%"},{default:n((()=>[c(u(e.$t("User.Logout")),1)])),_:1})])],64))}}),ea={class:"login-action-list"},aa={class:"title"},la={class:"title"},ta=e({__name:"not-login-action-list",setup(e){const t=a("");l((async()=>{const e=await b.getAppInfo();e&&(t.value=e.version)}));const s=async()=>{b.info()},o=()=>{const e=document.createElement("a");e.href="https://daiyl.com",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)};return(e,a)=>(m(),p("div",ea,[r("div",{class:"item",onClick:o},[r("div",aa,u(e.$t("Common.officialSite")),1),d(I,{size:"16",icon:"mdi-chevron-right"})]),r("div",{class:"item",onClick:s},[r("div",la,u(e.$t("Common.version"))+" "+u(i(t)),1),d(I,{size:"16",icon:"mdi-chevron-right"})])]))}}),sa={key:0,class:"d-flex flex-row"},ia={style:{flex:"1","font-size":"14px","line-height":"22px","margin-top":"18px"}},oa={key:1,class:"d-flex flex-row"},na={style:{flex:"1","margin-top":"14px",width:"164px"}},ra={style:{"font-size":"16px","font-weight":"bold","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},da={style:{"font-size":"14px","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},ca=e({__name:"user-avatar-with-status",setup(e){const a=D(),l=()=>{a.showLoginView()};return(e,t)=>i(a).isUserLoggedIn?(m(),p("div",oa,[d(S,{src:"./images/user/avatar-large.svg",transition:!1,"max-width":"68","max-height":"68",width:"68",height:"68",class:"mr-4"}),r("div",na,[r("div",ra,u(i(a).currentUserData?.name),1),r("div",da,u(i(a).currentUserData?.email),1)])])):(m(),p("div",sa,[d(S,{src:"./images/user/avatar-not-login-large.svg",transition:!1,"max-width":"68","max-height":"68",width:"68",height:"68",class:"mr-4"}),r("div",ia,[r("div",null,u(e.$t("User.NotLoggin")),1),r("div",null,[c(u(e.$t("User.ClickTo"))+" ",1),r("a",{href:"#",onClick:s(l,["prevent"])},u(e.$t("User.Login"))+"/"+u(e.$t("User.Register")),1)])])]))}}),ua=e({__name:"user-avatar-simple",setup(e){const a=D(),l=()=>{};return(e,t)=>i(a).userInfoLoading?v("",!0):(m(),p("a",{key:0,href:"#",class:"d-flex",target:"_blank",onClick:s(l,["prevent"]),style:{"align-items":"center"}},[d(S,{src:i(a).isUserLoggedIn?"./images/user/avatar.svg":"./images/user/avatar-not-login.svg",transition:!1,width:"36",height:"36",class:"github-icon mr-4"},null,8,["src"]),c(" "+u(i(a).isUserLoggedIn?i(a).currentUserData?.name:e.$t("User.NotLoggin")),1)]))}}),ma={key:0,class:"not-login login-overlay mt-2"},ga={class:"login-top-part pa-6"},pa={key:1,class:"login-success login-overlay mt-2"},ha={class:"login-top-part pa-6"},va=e({__name:"user-info-btn",setup(e){const a=D();return l((async()=>{a.updateCurrentUserData()})),(e,l)=>{const t=ua,s=ca,o=ta,c=We,u=Ze,g=de,v=oe;return m(),p(h,null,[d(B,{location:"bottom",transition:"slide-y-transition"},{activator:n((({props:e})=>[d(t,f(w(e)),null,16)])),default:n((()=>[i(a).isUserLoggedIn?(m(),p("div",pa,[r("div",ha,[d(s)]),d(c)])):(m(),p("div",ma,[r("div",ga,[d(s)]),d(o)]))])),_:1}),d(u),d(g),d(v)],64)}}});class fa{static async getDefaultHFHomeDir(){return await J()+"/.cache/huggingface"}static async getHFHomeDirDisplay(e){if(e.HF_HOME)return e.HF_HOME;return await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(e){const a=await this.getDefaultHFHomeDir(),l=Object.assign({},e);return l.HF_HOME===a&&(l.HF_HOME=""),await k(l)}}const wa=le("configDialog",{state:()=>({showDialog:!1}),actions:{showDialogTrigger(){this.showDialog=!0,setTimeout((()=>{this.showDialog=!1}),100)}}});class ya{static getGuideLink(){return U.localeIsEn()?"https://daiyl.com/lm-downloader-apps-data-migration.html":"https://seemts.com/zh/lm-downloader-apps-data-migration.html"}}const _a=["href"],Va=e({__name:"global-config-btn",setup(e){const f=wa(),{addToast:w}=C(),{t:V}=R(),U=a(!1),D=a({}),b=a({}),k=a(!1),N=a(!1),B=a(!1),q=a(!0),X=a(!0),J=a("");l((()=>{window.ipcRenderer?.on(K.OPEN_GLOBAL_CONFIG_DIALOG,((e,...a)=>{te()}))}));const ae=async()=>{if(N.value&&D){k.value=!0;try{await O(D.value),await fa.saveGlobalEnvVars(b.value);const e=V("Common.saveSuccess");w(e,"success"),le(),B.value&&setTimeout((()=>{ee()}),2e3)}catch(e){console.error(e),w(String(e),"error")}finally{k.value=!1}}},le=async()=>{U.value=!1},te=async()=>{if(U.value=!0,await me(),window.ipcRenderer){D.value=await $();const e=await P();e.HF_HOME=await fa.getHFHomeDirDisplay(e),b.value=e,ne(D.value.LMD_DATA_ROOT)}},se=async()=>{const e=await Q(D.value.LMD_DATA_ROOT,!0);e&&e.path&&(D.value.LMD_DATA_ROOT=e.path,ne(e.path),oe(e))},ie=()=>{L(D.value.LMD_DATA_ROOT)},oe=e=>{const a=W.checkModelsDirValid(e,["logs"]),l=W.checkModelsDirValid(e,["scripts"]);q.value=a||l},ne=e=>{const a=/^[a-zA-Z0-9._\-/\\()+=~]+$/.test(e);console.log("validCharsResult",a),X.value=a},re=async()=>{const e=await H();console.log("configAndDir",e),e?.rootDir?D.value.LMD_DATA_ROOT=e?.rootDir:w(V("ConfigDialog.NoDefraultDirError"),"warning")},de=[e=>!!e||V("Common.fieldRequired"),()=>q.value||V("ConfigDialog.DirNotValid")],ce=async()=>{const e=await Q(b.value.HF_HOME,!1);e&&e.path&&(b.value.HF_HOME=e.path)},ue=async()=>{const e=await fa.getDefaultHFHomeDir();e?b.value.HF_HOME=e:w(V("ConfigDialog.NoDefraultDirError"),"warning")},me=async()=>{J.value=await fa.getDefaultHFHomeDir()};return g((()=>f.showDialog),(e=>{e&&te()})),g((()=>D.value.LMD_DATA_ROOT),((e,a)=>{void 0!==a&&e!==a&&(B.value=!0)})),g((()=>X.value),(e=>{e||w(V("ConfigDialog.DirCharsNotValid"),"error")})),(e,a)=>(m(),p(h,null,[d(A,{class:"hover-border",width:"38",height:"38",icon:"",onClick:te,style:{"border-radius":"50%"}},{default:n((()=>[d(S,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})])),_:1}),d(E,{modelValue:i(U),"onUpdate:modelValue":a[7]||(a[7]=e=>o(U)?U.value=e:null),"min-width":"400","max-width":"900"},{default:n((()=>[d(z,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:e.$t("ConfigDialog.globalConfigTitle")},{append:n((()=>[d(A,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:a[0]||(a[0]=e=>U.value=!1)})])),default:n((()=>[i(D)?(m(),t(T,{key:0,class:"global-config-form pt-0 pb-3 mx-2 px-6",modelValue:i(N),"onUpdate:modelValue":a[6]||(a[6]=e=>o(N)?N.value=e:null),onSubmit:s(ae,["prevent"])},{default:n((()=>[d(G,{class:"px-0"},{default:n((()=>[c(u(e.$t("ConfigDialog.DefaultStorageTitle")),1)])),_:1}),d(F,{modelValue:i(D).LMD_DATA_ROOT,"onUpdate:modelValue":a[1]||(a[1]=e=>i(D).LMD_DATA_ROOT=e),rules:de,readonly:"",variant:"underlined",label:e.$t("ConfigDialog.DefaultStoragePathLabel")},{append:n((()=>[i(X)?v("",!0):(m(),t(Z,{key:0,location:"bottom"},{activator:n((({props:e})=>[d(I,y(e,{style:{opacity:"1"},color:"#F00",icon:"mdi-information-slab-circle-outline"}),null,16)])),default:n((()=>[r("pre",null,u(e.$t("ConfigDialog.DirCharsNotValid")),1)])),_:1})),d(A,{class:"ml-2",height:"30",onClick:se,color:i(x).PRIMARY_COLOR,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.DefaultStoragePathBrowse")),1)])),_:1},8,["color"]),d(A,{class:"ml-2",height:"30",onClick:ie,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.OpenDir")),1)])),_:1}),d(A,{class:"ml-2",height:"30",onClick:re,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["modelValue","label"]),i(X)?v("",!0):(m(),t(j,{key:0,class:"px-0 py-0",style:{color:"#F00"}},{default:n((()=>[c(u(e.$t("ConfigDialog.DirCharsNotValidReason")),1)])),_:1})),d(j,{class:"px-0 py-0"},{default:n((()=>[c(u(e.$t("ConfigDialog.DirTrouble"))+" ",1),r("a",{style:_(`color:${i(x).PRIMARY_COLOR};`),href:i(ya).getGuideLink(),target:"_blank"},u(e.$t("ConfigDialog.DataMigration")),13,_a)])),_:1}),d(Y,{class:"my-5"}),d(G,{class:"px-0"},{default:n((()=>[c(u(e.$t("ConfigDialog.GlobalVariablesTitle")),1)])),_:1}),d(F,{class:"mb-4",readonly:i(k),rules:[],modelValue:i(b).HF_MIRROR,"onUpdate:modelValue":a[2]||(a[2]=e=>i(b).HF_MIRROR=e),variant:"underlined",hint:e.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:e.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","modelValue","hint","label"]),d(F,{readonly:i(k),rules:[],modelValue:i(b).HF_HOME,"onUpdate:modelValue":a[3]||(a[3]=e=>i(b).HF_HOME=e),variant:"underlined",label:e.$t("ConfigDialog.HF_HOME_LABEL")},{append:n((()=>[d(Z,{location:"bottom"},{activator:n((({props:e})=>[d(I,y(e,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:n((()=>[r("pre",null,u(e.$t("ConfigDialog.HF_HOME_TIP")),1)])),_:1}),d(A,{height:"30",class:"ml-2",onClick:ce,color:i(x).PRIMARY_COLOR,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.HFHOMEPathBrowse")),1)])),_:1},8,["color"]),d(A,{height:"30",class:"ml-2",onClick:ue,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["readonly","modelValue","label"]),d(F,{readonly:i(k),rules:[],modelValue:i(b).GITHUB_PROXY,"onUpdate:modelValue":a[4]||(a[4]=e=>i(b).GITHUB_PROXY=e),variant:"underlined",hint:e.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:e.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","modelValue","hint","label"]),d(M,{class:"text-center justify-center"},{default:n((()=>[d(A,{variant:"outlined",onClick:a[5]||(a[5]=e=>U.value=!1)},{default:n((()=>[c(u(e.$t("ConfigDialog.close")),1)])),_:1}),d(A,{color:"primary",variant:"flat",type:"submit",loading:i(k)},{default:n((()=>[c(u(e.$t("ConfigDialog.saveConfig")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"])):v("",!0)])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Ua={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},Ca=e({__name:"top-right-controls",setup(e){const{locale:a}=ae(),t=te();l((async()=>{let e;try{e=(await $()).LMD_LOCALE}catch(a){e=U.getDefaultLocale()}s(e)}));const s=async e=>{a.value=e;const l=await $();l.LMD_LOCALE=a.value,await O(l),t.changeLocale(a.value)},o=V((()=>U.getLocaleIcon(a.value)));return(e,l)=>{const t=va;return m(),p("div",Ua,[d(Va),d(A,{class:"hover-border",style:{"margin-left":"-6px","border-radius":"50%"},width:"38",height:"38",icon:"",onClick:l[0]||(l[0]=e=>{"zhHans"===a.value?s("en"):s("zhHans")})},{default:n((()=>[d(S,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:i(o)},null,8,["src"])])),_:1}),d(q,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),d(t)])}}});export{Ca as _,wa as a,te as u};
