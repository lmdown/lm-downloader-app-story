import{u as a}from"./vuei18n.js";import{s as l,g as e,f as t,i as o,j as i,L as n}from"./index.js";import{e as s,b as r,H as u,a1 as c,F as d,k as g,$ as m,u as f,j as _,Z as p,a4 as D,W as h,Q as v,a3 as H,a0 as w,m as b,d as O,_ as y,c as C}from"./vue.js";import{e as L,I as V,d as E,D as F}from"./common-util.js";import{A as M,i as T,b as $,w as A,x as k,L as R,B as I,e as x,I as G,d as B,E as P,D as U,t as j}from"./vuetify.js";import{d as N}from"./pinia.js";class S{static async getDefaultHFHomeDir(){return await L()+"/.cache/huggingface"}static async getHFHomeDirDisplay(a){if(a.HF_HOME)return a.HF_HOME;return await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(a){const e=await this.getDefaultHFHomeDir(),t=Object.assign({},a);return t.HF_HOME===e&&(t.HF_HOME=""),await l(t)}}const z=s({__name:"global-config-btn",setup(a){const{t:l}=M(),n=r(!1),s=r({}),C=r({}),L=r(!1),U=r(!1),j=O("showToastMessage"),N=r(!0),z=r("");u((()=>{window.ipcRenderer?.on(V.OPEN_GLOBAL_CONFIG_DIALOG,((a,...l)=>{q()}))}));const X=async()=>{if(U.value&&s){L.value=!0;try{await i(s.value),await S.saveGlobalEnvVars(C.value);const a=l("Common.saveSuccess");j&&j(a,"success"),Y()}catch(a){console.error(a),j&&j(String(a),"error")}finally{L.value=!1}}},Y=async()=>{n.value=!1},q=async()=>{if(n.value=!0,await la(),window.ipcRenderer){s.value=await e();const a=await t();a.HF_HOME=await S.getHFHomeDirDisplay(a),C.value=a,console.log("envVars",C)}},Q=async()=>{const a=await E(s.value.LMD_DATA_ROOT,!0);a&&a.path&&(s.value.LMD_DATA_ROOT=a.path,W(a))},W=a=>{const l=F.checkModelsDirValid(a,["logs"]),e=F.checkModelsDirValid(a,["scripts"]);N.value=l||e},Z=async()=>{const a=await o();a?.rootDir?s.value.LMD_DATA_ROOT=a?.rootDir:j&&j(l("ConfigDialog.NoDefraultDirError"),"warning")},J=[a=>!!a||l("Common.fieldRequired"),()=>N.value||l("ConfigDialog.DirNotValid")],K=async()=>{const a=await E(C.value.HF_HOME,!1);a&&a.path&&(C.value.HF_HOME=a.path)},aa=async()=>{const a=await S.getDefaultHFHomeDir();a?C.value.HF_HOME=a:j&&j(l("ConfigDialog.NoDefraultDirError"),"warning")},la=async()=>{z.value=await S.getDefaultHFHomeDir()};return(a,l)=>(y(),c(d,null,[g(T,{class:"hover-border",width:"38",height:"38",icon:"",onClick:q},{default:m((()=>[g($,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})])),_:1}),g(A,{modelValue:f(n),"onUpdate:modelValue":l[7]||(l[7]=a=>_(n)?n.value=a:null),"min-width":"400","max-width":"800"},{default:m((()=>[g(k,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("ConfigDialog.globalConfigTitle")},{append:m((()=>[g(T,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:l[0]||(l[0]=a=>n.value=!1)})])),default:m((()=>[f(s)?(y(),p(R,{key:0,class:"pt-0 pb-3 px-6",modelValue:f(U),"onUpdate:modelValue":l[6]||(l[6]=a=>_(U)?U.value=a:null),onSubmit:h(X,["prevent"])},{default:m((()=>[g(I,null,{default:m((()=>[v(H(a.$t("ConfigDialog.DefaultStorageTitle")),1)])),_:1}),g(x,{modelValue:f(s).LMD_DATA_ROOT,"onUpdate:modelValue":l[1]||(l[1]=a=>f(s).LMD_DATA_ROOT=a),readonly:f(L),rules:J,label:a.$t("ConfigDialog.DefaultStoragePathLabel")},{append:m((()=>[g(G,{location:"bottom"},{activator:m((({props:a})=>[g(B,b(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:m((()=>[w("pre",null,H(a.$t("ConfigDialog.DefaultStorageSubtitle")),1)])),_:1}),g(T,{class:"ml-1",onClick:Q},{default:m((()=>[v(H(a.$t("ConfigDialog.DefaultStoragePathBrowse")),1)])),_:1}),g(T,{class:"ml-1",onClick:Z},{default:m((()=>[v(H(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["modelValue","readonly","label"]),g(I,null,{default:m((()=>[v(H(a.$t("ConfigDialog.GlobalVariablesTitle")),1)])),_:1}),g(x,{class:"mb-4",readonly:f(L),rules:[],modelValue:f(C).HF_MIRROR,"onUpdate:modelValue":l[2]||(l[2]=a=>f(C).HF_MIRROR=a),hint:a.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","modelValue","hint","label"]),g(x,{readonly:f(L),rules:[],modelValue:f(C).HF_HOME,"onUpdate:modelValue":l[3]||(l[3]=a=>f(C).HF_HOME=a),label:a.$t("ConfigDialog.HF_HOME_LABEL")},{append:m((()=>[g(G,{location:"bottom"},{activator:m((({props:a})=>[g(B,b(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:m((()=>[w("pre",null,H(a.$t("ConfigDialog.HF_HOME_TIP")),1)])),_:1}),g(T,{class:"ml-1",onClick:K},{default:m((()=>[v(H(a.$t("ConfigDialog.HFHOMEPathBrowse")),1)])),_:1}),g(T,{class:"ml-1",onClick:aa},{default:m((()=>[v(H(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["readonly","modelValue","label"]),g(x,{readonly:f(L),rules:[],modelValue:f(C).GITHUB_PROXY,"onUpdate:modelValue":l[4]||(l[4]=a=>f(C).GITHUB_PROXY=a),hint:a.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","modelValue","hint","label"]),g(P,{class:"text-center justify-center"},{default:m((()=>[g(T,{variant:"outlined",onClick:l[5]||(l[5]=a=>n.value=!1)},{default:m((()=>[v(H(a.$t("ConfigDialog.close")),1)])),_:1}),g(T,{color:"primary",variant:"flat",type:"submit",loading:f(L)},{default:m((()=>[v(H(a.$t("ConfigDialog.saveConfig")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"])):D("",!0)])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),X=s({__name:"git-info-btn",setup(a){const l=r(!1),e=a=>{a.preventDefault(),l.value=!0};return(a,t)=>(y(),c(d,null,[w("a",{href:"#",class:"d-flex",target:"_blank",onClick:e,style:{"align-items":"center"}},[g($,{src:"./images/icons/icon-github.png",transition:!1,width:"36",height:"36",class:"github-icon mr-4"}),v(" "+H(a.$t("App.AppName"))+" Github > ",1)]),g(A,{modelValue:f(l),"onUpdate:modelValue":t[1]||(t[1]=a=>_(l)?l.value=a:null),"min-width":"200","max-width":"560"},{default:m((()=>[g(k,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("GitDialog.DialogTitle")},{append:m((()=>[g(T,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:t[0]||(t[0]=a=>l.value=!1)})])),default:m((()=>[g(U,null,{default:m((()=>[w("h3",null,H(a.$t("GitDialog.CardTitle")),1),t[2]||(t[2]=w("div",null,[v("Github: "),w("a",{href:"https://github.com/lmdown",target:"_blank"},"https://github.com/lmdown")],-1)),t[3]||(t[3]=w("div",null,[v(" Gitee: "),w("a",{href:"https://gitee.com/lmdown",target:"_blank"},"https://gitee.com/lmdown")],-1))])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Y=N("localeInfo",{state:()=>({currentLocale:n.getCurrentLocale()}),actions:{async changeLocale(a){this.currentLocale=a}}}),q={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},Q=s({__name:"top-right-controls",setup(l){const{locale:t}=a(),o=Y();u((async()=>{let a;try{a=(await e()).LMD_LOCALE}catch(l){a=n.getDefaultLocale()}s(a)}));const s=async a=>{t.value=a;const l=await e();l.LMD_LOCALE=t.value,await i(l),o.changeLocale(t.value)},r=C((()=>n.getLocaleIcon(t.value)));return(a,l)=>(y(),c("div",q,[g(X),g(j,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),g(z),g(T,{class:"hover-border",style:{"margin-left":"-6px"},width:"38",height:"38",icon:"",onClick:l[0]||(l[0]=a=>{"zhHans"===t.value?s("en"):s("zhHans")})},{default:m((()=>[g($,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:f(r)},null,8,["src"])])),_:1})]))}});export{Q as _,Y as u};
