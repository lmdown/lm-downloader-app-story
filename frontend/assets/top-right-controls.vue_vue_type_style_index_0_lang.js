import{e,b as a,H as t,$ as s,Y as o,u as l,j as i,a1 as n,a2 as r,k as d,S as c,K as u,a0 as g,l as m,a3 as p,F as h,a5 as w,ad as v,ae as f,m as y,c as _}from"./vue.js";import{S as V,b as U,L as C,f as b,j as k,s as D,g as x,c as T,k as L,l as P}from"./index.js";import{d as $}from"./pinia.js";import{F as H,W as S,e as E,H as F,s as M,B as O,C as R,b as A,d as I,l as N,X as z,q as B,p as j,A as Z}from"./vuetify.js";import{_ as G,g as q,I as X,e as Y,D as K,r as J}from"./lmd-system.js";import{u as W}from"./vuei18n.js";class Q{static saveToLS(e){localStorage.setItem(V.LMD_USER_DATA,JSON.stringify(e))}static clearUserInfoInLS(){localStorage.setItem(V.LMD_USER_DATA,""),localStorage.setItem(V.LMD_USER_TOKEN,"")}}class ee extends Error{response=null}const ae=$("user",{state:()=>({currentUserData:{},loginViewVisible:!1,changeNicknameViewVisible:!1,changePwdViewVisible:!1,userInfoLoading:!1,isUserLoggedIn:!1}),actions:{async updateCurrentUserData(){this.userInfoLoading=!0;try{if(!this.getToken())return;try{const e=await(async()=>(await te.get("/api/auth/info")).data)();e&&Q.saveToLS(e)}catch(t){t instanceof ee&&403===t.response?.status&&this.logout()}}catch(t){console.log(t)}finally{this.userInfoLoading=!1}const e=localStorage.getItem(V.LMD_USER_DATA);let a;a=e?JSON.parse(e):{},this.setCurrentUser(a)},async userRegister(e){const{addToast:a}=U();try{const t=await(async e=>(await te.post("/api/reg/register",e,{ignoreTokenCheck:!0})).data)(e),s=t.user;if(s.token)return this.setToken(s),s;a(t.msg,"error")}catch(t){let e="";if(t instanceof axios.AxiosError){const a=t.response?.data;e=a.msg}else e=t.message;throw a(e,"error"),t}},async userLogin(e){const{addToast:a}=U();try{const t=await(async e=>(await te.post("/api/auth/login",e,{ignoreTokenCheck:!0})).data)(e),s=t.user;if(s.token)return this.setToken(s),s;a(t.msg,"error")}catch(t){let e="";if(t instanceof axios.AxiosError){const a=t.response?.data;e=a.msg}else e=t.message;throw a(e,"error"),t}},getToken:()=>localStorage.getItem(V.LMD_USER_TOKEN),setToken(e){if(e.token){localStorage.setItem(V.LMD_USER_TOKEN,e.token);const a=Object.assign({},e);a.token=void 0,Q.saveToLS(a),this.setCurrentUser(a),setTimeout((()=>{location.reload()}),100)}},showLoginView(){this.loginViewVisible=!0,setTimeout((()=>{this.loginViewVisible=!1}),100)},showChangePwdView(){this.changePwdViewVisible=!0,setTimeout((()=>{this.changePwdViewVisible=!1}),100)},showChangeNicknameView(){this.changeNicknameViewVisible=!0,setTimeout((()=>{this.changeNicknameViewVisible=!1}),100)},setCurrentUser(e){this.currentUserData=e,this.isUserLoggedIn=!0},changePwd:async e=>await(async e=>(await te.post("/api/auth/chpwd",e)).data)(e),changeNickname:async e=>await(async e=>(await te.post("/api/auth/chname",e)).data)(e),async forgotPwd(e){try{return await(async e=>(await te.post("/api/auth/forgot",e,{ignoreTokenCheck:!0})).data)(e)}catch(a){const{addToast:e}=U();throw e(a?.message,"error"),a}},async resetPwd(e){try{return await(async e=>(await te.post("/api/auth/reset",e,{ignoreTokenCheck:!0})).data)(e)}catch(a){const{addToast:e}=U();throw e(a?.message,"error"),a}},logout(){Q.clearUserInfoInLS(),location.reload()}}}),te=axios.create({baseURL:"https://seemts.com",timeout:6e3});te.interceptors.request.use((e=>{const a=ae(),t=a.getToken();if(!e.ignoreTokenCheck){if(!t)return a.showLoginView(),Promise.reject("No token");e.headers.Authorization=`Bearer ${t}`}if(e.url){const a=C.getCurrentLocale();e.url=b(e.url,{locale:a})}return e}),(e=>(console.error("Request Error:",e),Promise.reject(e)))),te.interceptors.response.use((e=>{if(e.data&&"string"==typeof e.data)try{e.data=JSON.parse(e.data)}catch(a){console.log("parse err",a)}if(e.data?.code){const a=e.data;throw new Error(`${a.msg} (${a.code})`)}return e}),(e=>{if(console.error("Response Error:",e),e.response)switch(e.response.status){case 401:console.warn("Unauthorized access. Redirecting to login...");break;case 403:console.warn("Forbidden access.");break;case 404:console.warn("Resource not found.");break;case 500:console.error("Server internal error.");break;default:console.error("Unexpected error occurred.")}if(e instanceof axios.AxiosError){const a=e.response;if(a?.data instanceof Object&&a?.data?.msg){const e=new ee(a?.data?.msg);return e.response=a,Promise.reject(e)}}return Promise.reject(e)}));const se=$("localeInfo",{state:()=>({currentLocale:C.getCurrentLocale()}),actions:{async changeLocale(e){this.currentLocale=e}}}),oe={class:"pt-4 pb-3 change-name-form"},le=e({__name:"change-nickname-form",emits:["changeSuccess","hideDialog"],setup(e,{emit:m}){const{t:p}=H(),{addToast:h}=U(),w=a(!1),v=a(!1),f=a({}),y=ae(),_=m,V=[e=>!!e||p("Common.fieldRequired"),e=>e&&e.length>=2||p("User.NicknameVMsgMoreThan2Chars"),e=>e&&e.length<=30||p("User.NicknameVMsgLessThan30Chars")];t((()=>{f.value={name:y.currentUserData.name}}));const C=async()=>{if(v.value){w.value=!0;try{await y.changeNickname(f.value),h(p("User.UpdateSuccess")),b(),y.updateCurrentUserData()}catch(e){console.error(e);const a=e?.message;a&&h(a,"error")}finally{w.value=!1}}},b=()=>{_("hideDialog")};return(e,a)=>(g(),s(S,{modelValue:l(v),"onUpdate:modelValue":a[1]||(a[1]=e=>i(v)?v.value=e:null),onSubmit:o(C,["prevent"])},{default:n((()=>[r("div",oe,[d(E,{class:"form-input",rules:V,density:"compact",modelValue:l(f).name,"onUpdate:modelValue":a[0]||(a[0]=e=>l(f).name=e),readonly:l(w),variant:"outlined",rounded:"lg"},null,8,["modelValue","readonly"])]),d(F,{style:{"border-top":"1px solid #EBEBF7"},class:"py-6 text-center justify-center"},{default:n((()=>[d(M,{variant:"outlined",onClick:b},{default:n((()=>[c(u(e.$t("User.Cancel")),1)])),_:1}),d(M,{variant:"flat",color:"primary",type:"submit",loading:l(w)},{default:n((()=>[c(u(e.$t("User.Submit")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"]))}}),ie=e({__name:"change-nickname-dialog",setup(e){const t=a(!1),o=ae(),r=()=>{t.value=!1};return m((()=>o.changeNicknameViewVisible),(e=>{e&&(t.value=!0)})),(e,a)=>{const o=le;return g(),s(O,{modelValue:l(t),"onUpdate:modelValue":a[0]||(a[0]=e=>i(t)?t.value=e:null),"min-width":"400","max-width":"480"},{default:n((()=>[d(R,{title:e.$t("User.ChangeName")},{append:n((()=>[d(M,{icon:"mdi-close",class:"ms-auto",size:"compact",elevation:"0",onClick:r})])),default:n((()=>[d(o,{onHideDialog:r,onChangeSuccess:r})])),_:1},8,["title"])])),_:1},8,["modelValue"])}}}),ne={class:"pt-4 pb-3 change-pwd-form"},re=e({__name:"change-pwd-form",emits:["changeSuccess","hideDialog"],setup(e,{emit:t}){const{t:m}=H(),{addToast:p}=U(),h=a(!1),w=a(!1),v=a({}),f=ae(),y=t,_=e=>!!e||m("Common.fieldRequired"),V=[_,e=>e&&e.length>=8||m("User.PwdVMsgMoreThan8Chars"),e=>e&&e.length<=30||m("User.PwdVMsgLessThan30Chars"),e=>/[0-9]/.test(e)||m("User.PwdVMsgHasNum"),e=>/[A-Z]/.test(e)||m("User.PwdVMsgHasUppercase"),e=>/[a-z]/.test(e)||m("User.PwdVMsgHasLowercase")],C=async()=>{if(console.log("onSubmit changePwd",v.value),w.value){h.value=!0;try{await f.changePwd(v.value),p(m("User.UpdateSuccess")),b()}catch(e){console.error(e);const a=e?.message;a&&p(a,"error")}finally{h.value=!1}}},b=()=>{y("hideDialog")};return(e,a)=>(g(),s(S,{modelValue:l(w),"onUpdate:modelValue":a[3]||(a[3]=e=>i(w)?w.value=e:null),onSubmit:o(C,["prevent"])},{default:n((()=>[r("div",ne,[d(E,{class:"form-input",rules:[_],density:"compact",modelValue:l(v).oldPassword,"onUpdate:modelValue":a[0]||(a[0]=e=>l(v).oldPassword=e),type:"password",readonly:l(h),variant:"outlined",rounded:"lg",placeholder:e.$t("User.OldPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["rules","modelValue","readonly","placeholder"]),d(E,{class:"form-input",rules:V,density:"compact",modelValue:l(v).password,"onUpdate:modelValue":a[1]||(a[1]=e=>l(v).password=e),type:"password",readonly:l(h),variant:"outlined",rounded:"lg",placeholder:e.$t("User.NewPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(E,{class:"form-input",rules:V,density:"compact",modelValue:l(v).repeatPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>l(v).repeatPassword=e),type:"password",readonly:l(h),variant:"outlined",rounded:"lg",placeholder:e.$t("User.ConfirmPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd-confirm.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"])]),d(F,{style:{"border-top":"1px solid #EBEBF7"},class:"py-6 text-center justify-center"},{default:n((()=>[d(M,{variant:"outlined",onClick:b},{default:n((()=>[c(u(e.$t("User.Cancel")),1)])),_:1}),d(M,{variant:"flat",color:"primary",type:"submit",loading:l(h)},{default:n((()=>[c(u(e.$t("User.Submit")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"]))}}),de=e({__name:"change-pwd-dialog",setup(e){const t=a(!1),o=ae(),r=()=>{t.value=!1};return m((()=>o.changePwdViewVisible),(e=>{e&&(t.value=!0)})),(e,a)=>{const o=re;return g(),s(O,{modelValue:l(t),"onUpdate:modelValue":a[0]||(a[0]=e=>i(t)?t.value=e:null),"min-width":"400","max-width":"480"},{default:n((()=>[d(R,{title:e.$t("User.ChangePwd")},{append:n((()=>[d(M,{icon:"mdi-close",class:"ms-auto",size:"compact",elevation:"0",onClick:r})])),default:n((()=>[d(o,{onHideDialog:r,onChangeSuccess:r})])),_:1},8,["title"])])),_:1},8,["modelValue"])}}}),ce={class:"reset-form-view mx-12"},ue={class:"d-flex flex-row",style:{"align-items":"center"}},ge={style:{"font-size":"16px","font-weight":"bold"}},me=e({__name:"reset-pwd-form",emits:["back","resetPwdSuccess"],setup(e,{emit:t}){const s=a(!1),m=a(!1),h=a({}),{addToast:w}=U(),v=ae(),{t:f}=H(),y=t,_=()=>{y("back")},V=e=>!!e||f("Common.fieldRequired"),C=[V,e=>e&&e.length>=8||f("User.PwdVMsgMoreThan8Chars"),e=>e&&e.length<=30||f("User.PwdVMsgLessThan30Chars"),e=>/[0-9]/.test(e)||f("User.PwdVMsgHasNum"),e=>/[A-Z]/.test(e)||f("User.PwdVMsgHasUppercase"),e=>/[a-z]/.test(e)||f("User.PwdVMsgHasLowercase")],b=[V,e=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)||f("User.EmailNotValid")],k=async()=>{console.log("sendCode"),await v.forgotPwd({email:h.value.email}),w(f("User.CodeSent"))},D=async()=>{if(m.value){s.value=!0;try{await v.resetPwd(h.value),w(f("User.PwdResetSuccess")),y("resetPwdSuccess")}catch(e){console.error(e)}finally{s.value=!1}}};return(e,a)=>(g(),p("div",ce,[r("div",ue,[d(M,{onClick:_,variant:"plain",style:{"margin-left":"-1rem"}},{default:n((()=>[d(I,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"24",icon:"mdi-chevron-left",color:"#FB6C00"})])),_:1}),r("div",ge,u(e.$t("User.ResetPwd")),1)]),d(S,{class:"pt-4 pb-3 px-0 login-form",modelValue:l(m),"onUpdate:modelValue":a[4]||(a[4]=e=>i(m)?m.value=e:null),onSubmit:o(D,["prevent"])},{default:n((()=>[d(E,{class:"login-input",rules:b,density:"compact",modelValue:l(h).email,"onUpdate:modelValue":a[0]||(a[0]=e=>l(h).email=e),readonly:l(s),variant:"outlined",rounded:"lg",placeholder:e.$t("User.FormEmail")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/email.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),"append-inner":n((()=>[d(M,{onClick:k,variant:"text"},{default:n((()=>[c(u(e.$t("User.SendCode")),1)])),_:1})])),_:1},8,["modelValue","readonly","placeholder"]),d(E,{class:"login-input",rules:[V],density:"compact",modelValue:l(h).resetToken,"onUpdate:modelValue":a[1]||(a[1]=e=>l(h).resetToken=e),readonly:l(s),variant:"outlined",rounded:"lg",placeholder:e.$t("User.VerifyCode")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["rules","modelValue","readonly","placeholder"]),d(E,{class:"login-input",rules:C,density:"compact",modelValue:l(h).password,"onUpdate:modelValue":a[2]||(a[2]=e=>l(h).password=e),readonly:l(s),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.FormPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(E,{class:"login-input",rules:C,density:"compact",modelValue:l(h).repeatPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>l(h).repeatPassword=e),readonly:l(s),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.ConfirmPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd-confirm.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(M,{class:"submit-btn mt-7",height:"40",variant:"flat",type:"submit",loading:l(s)},{default:n((()=>[c(u(e.$t("User.Submit")),1)])),_:1},8,["loading"])])),_:1},8,["modelValue"])]))}}),pe={class:"reg-form-view"},he={class:"d-flex flex-row",style:{"align-items":"center"}},we={style:{"font-size":"16px","font-weight":"bold"}},ve=e({__name:"reg-form",emits:["back","registerSuccess"],setup(e,{emit:t}){const s=a(!1),m=a(!1),h=a({}),{addToast:w}=U(),v=ae(),{t:f}=H(),y=t,_=()=>{y("back")},V=e=>!!e||f("Common.fieldRequired"),C=[V,e=>e&&e.length>=8||f("User.PwdVMsgMoreThan8Chars"),e=>e&&e.length<=30||f("User.PwdVMsgLessThan30Chars"),e=>/[0-9]/.test(e)||f("User.PwdVMsgHasNum"),e=>/[A-Z]/.test(e)||f("User.PwdVMsgHasUppercase"),e=>/[a-z]/.test(e)||f("User.PwdVMsgHasLowercase")],b=[V,e=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)||f("User.EmailNotValid")],k=async()=>{if(m.value){s.value=!0;try{await v.userRegister(h.value),y("registerSuccess")}catch(e){console.error(e)}finally{s.value=!1}}};return(e,a)=>(g(),p("div",pe,[r("div",he,[d(M,{onClick:_,variant:"plain",style:{"margin-left":"-1rem"}},{default:n((()=>[d(I,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"24",icon:"mdi-chevron-left",color:"#FB6C00"})])),_:1}),r("div",we,u(e.$t("User.UserRegister")),1)]),d(S,{class:"pt-4 pb-3 px-0 login-form",modelValue:l(m),"onUpdate:modelValue":a[3]||(a[3]=e=>i(m)?m.value=e:null),onSubmit:o(k,["prevent"])},{default:n((()=>[d(E,{class:"login-input",rules:b,density:"compact",modelValue:l(h).email,"onUpdate:modelValue":a[0]||(a[0]=e=>l(h).email=e),readonly:l(s),variant:"outlined",rounded:"lg",placeholder:e.$t("User.FormEmail")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/email.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(E,{class:"login-input",rules:C,density:"compact",modelValue:l(h).password,"onUpdate:modelValue":a[1]||(a[1]=e=>l(h).password=e),readonly:l(s),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.FormPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(E,{class:"login-input",rules:C,density:"compact",modelValue:l(h).repeatPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>l(h).repeatPassword=e),readonly:l(s),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.ConfirmPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(M,{class:"submit-btn mt-7",height:"40",variant:"flat",type:"submit",loading:l(s)},{default:n((()=>[c(u(e.$t("User.Login")),1)])),_:1},8,["loading"])])),_:1},8,["modelValue"])]))}}),fe={class:"login-title"},ye={style:{"text-align":"center"},class:"mt-10"},_e={style:{"font-size":"12px","margin-top":"80px",color:"rgba(0,0,0,0.45)"}},Ve={href:"https://seemts.com/lmd/term-of-service",target:"_blank"},Ue={href:"https://seemts.com/lmd/privacy-policy",target:"_blank"},Ce=e({__name:"login-form",emits:["loginSuccess","toResetPwdView","toRegisterView"],setup(e,{emit:t}){const{addToast:s}=U(),{t:m}=H(),w=a(!1),v=a(!1),f=a({}),y=ae(),_=e=>!!e||m("Common.fieldRequired"),V=[_,e=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)||m("User.EmailNotValid")],C=[_],b=t,k=async()=>{if(v.value){w.value=!0;try{await y.userLogin(f.value),b("loginSuccess")}catch(e){console.error(e)}finally{w.value=!1}}},D=async()=>{b("toResetPwdView")},x=async()=>{b("toRegisterView")};return(e,a)=>(g(),p(h,null,[r("div",null,[r("div",fe,u(e.$t("User.EmailLogin")),1)]),d(S,{class:"pt-4 pb-3 px-0 login-form",modelValue:l(v),"onUpdate:modelValue":a[2]||(a[2]=e=>i(v)?v.value=e:null),onSubmit:o(k,["prevent"])},{default:n((()=>[d(E,{class:"login-input",rules:V,density:"compact",modelValue:l(f).email,"onUpdate:modelValue":a[0]||(a[0]=e=>l(f).email=e),readonly:l(w),variant:"outlined",rounded:"lg",placeholder:e.$t("User.FormEmail")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/email.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(E,{class:"login-input",rules:C,density:"compact",modelValue:l(f).password,"onUpdate:modelValue":a[1]||(a[1]=e=>l(f).password=e),readonly:l(w),variant:"outlined",rounded:"lg",type:"password",placeholder:e.$t("User.FormPwd")},{"prepend-inner":n((()=>[d(A,{src:"./images/user/pwd.svg",width:"27",height:"27","max-width":"27","max-height":"27"})])),_:1},8,["modelValue","readonly","placeholder"]),d(M,{class:"submit-btn mt-7",height:"40",variant:"flat",type:"submit",loading:l(w)},{default:n((()=>[c(u(e.$t("User.Login")),1)])),_:1},8,["loading"]),r("div",ye,[r("a",{href:"#",onClick:o(D,["prevent"])},u(e.$t("User.ResetPwd")),1),a[3]||(a[3]=r("span",{class:"mx-3",style:{color:"#D2D8E6"}},"|",-1)),r("a",{href:"#",onClick:o(x,["prevent"])},u(e.$t("User.UserRegister")),1)]),r("div",_e,[c(u(e.$t("User.LoginPrivacyTip"))+" ",1),r("a",Ve,u(e.$t("User.UserAggrement")),1),c(" "+u(e.$t("User.And"))+" ",1),r("a",Ue,u(e.$t("User.PrivacyPolicy")),1)])])),_:1},8,["modelValue"])],64))}}),be={class:"left-side"},ke={class:"headline"},De={class:"login-tip"},xe={class:"login-tip-list"},Te={class:"login-tip-item"},Le={class:"check-icon"},Pe={class:"tip-str"},$e={class:"login-tip-item"},He={class:"check-icon"},Se={class:"tip-str"},Ee={class:"login-tip-item"},Fe={class:"check-icon"},Me={class:"tip-str"};const Oe=G({},[["render",function(e,a){return g(),p("div",be,[r("div",ke,u(e.$t("App.AppName")),1),r("div",De,u(e.$t("User.LoginTip")),1),r("div",xe,[r("div",Te,[r("div",Le,[d(I,{color:"#FFF",icon:"mdi-check",size:"12"})]),r("div",Pe,u(e.$t("User.LoginTip1")),1)]),r("div",$e,[r("div",He,[d(I,{color:"#FFF",icon:"mdi-check",size:"12"})]),r("div",Se,u(e.$t("User.LoginTip2")),1)]),r("div",Ee,[r("div",Fe,[d(I,{color:"#FFF",icon:"mdi-check",size:"12"})]),r("div",Me,u(e.$t("User.LoginTip3")),1)])])])}],["__scopeId","data-v-0467a237"]]),Re={class:"d-flex flex-row"},Ae={class:"right-side"},Ie={style:{"text-align":"right"}},Ne={style:{margin:"0 24px"}},ze=e({__name:"login-and-reg-dialog",setup(e){const o=a(!1),c=ae(),u=a("login");t((()=>{v()})),m((()=>c.loginViewVisible),(e=>{e&&p()}));const p=()=>{o.value=!0,v()},h=()=>{o.value=!1},v=()=>{u.value="login"},f=()=>{u.value="reg"},y=()=>{u.value="resetpwd"};return(e,a)=>{const t=Oe,c=Ce,m=ve,p=me;return g(),s(O,{modelValue:l(o),"onUpdate:modelValue":a[0]||(a[0]=e=>i(o)?o.value=e:null),"max-width":"690",class:"login-dialog"},{default:n((()=>[d(N,{style:{"border-radius":"16px"},class:"mx-auto px-0 py-0 window-no-drag",width:"100%"},{default:n((()=>[r("div",Re,["login"===l(u)||"reg"===l(u)?(g(),s(t,{key:0})):w("",!0),r("div",Ae,[r("div",Ie,[d(M,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:h})]),r("div",Ne,["login"===l(u)?(g(),s(c,{key:0,onLoginSuccess:h,onToRegisterView:f,onToResetPwdView:y})):"reg"===l(u)?(g(),s(m,{key:1,onRegisterSuccess:h,onBack:v})):"resetpwd"===l(u)?(g(),s(p,{key:2,onResetPwdSuccess:v,onBack:v})):w("",!0)])])])])),_:1})])),_:1},8,["modelValue"])}}}),Be={class:"login-action-list"},je={class:"title"},Ze={class:"title"},Ge={class:"login-action-list"},qe={class:"title"},Xe={class:"title"},Ye={class:"px-6 pb-6"},Ke=e({__name:"login-action-list",setup(e){const s=ae(),o=a("");t((async()=>{const e=await k.getAppInfo();e&&(o.value=e.version)}));const i=()=>{s.showChangePwdView()},m=()=>{s.showChangeNicknameView()},w=async()=>{k.info()},v=async()=>{s.logout()},f=()=>{const e=document.createElement("a");e.href="https://daiyl.com",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)};return(e,a)=>(g(),p(h,null,[r("div",Be,[r("div",{class:"item",onClick:i},[r("div",je,u(e.$t("User.ChangePwd")),1),d(I,{size:"16",icon:"mdi-chevron-right"})]),r("div",{class:"item",onClick:m},[r("div",Ze,u(e.$t("User.ChangeName")),1),d(I,{size:"16",icon:"mdi-chevron-right"})])]),r("div",Ge,[r("div",{class:"item",onClick:f},[r("div",qe,u(e.$t("Common.officialSite")),1),d(I,{size:"16",icon:"mdi-chevron-right"})]),r("div",{class:"item",onClick:w},[r("div",Xe,u(e.$t("Common.version"))+" "+u(l(o)),1),d(I,{size:"16",icon:"mdi-chevron-right"})])]),r("div",Ye,[d(M,{variant:"outlined",onClick:v,style:{"background-color":"#FFF2F2",border:"none"},color:"#F2313F",width:"100%"},{default:n((()=>[c(u(e.$t("User.Logout")),1)])),_:1})])],64))}}),Je={key:0,class:"d-flex flex-row"},We={style:{flex:"1","font-size":"14px","line-height":"22px","margin-top":"18px"}},Qe={key:1,class:"d-flex flex-row"},ea={style:{flex:"1","margin-top":"14px",width:"164px"}},aa={style:{"font-size":"16px","font-weight":"bold","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},ta={style:{"font-size":"14px","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},sa=e({__name:"user-avatar-with-status",setup(e){const a=ae(),t=()=>{a.showLoginView()};return(e,s)=>l(a).isUserLoggedIn?(g(),p("div",Qe,[d(A,{src:"./images/user/avatar-large.svg",transition:!1,"max-width":"68","max-height":"68",width:"68",height:"68",class:"mr-4"}),r("div",ea,[r("div",aa,u(l(a).currentUserData?.name),1),r("div",ta,u(l(a).currentUserData?.email),1)])])):(g(),p("div",Je,[d(A,{src:"./images/user/avatar-not-login-large.svg",transition:!1,"max-width":"68","max-height":"68",width:"68",height:"68",class:"mr-4"}),r("div",We,[r("div",null,u(e.$t("User.NotLoggin")),1),r("div",null,[c(u(e.$t("User.ClickTo"))+" ",1),r("a",{href:"#",onClick:o(t,["prevent"])},u(e.$t("User.Login"))+"/"+u(e.$t("User.Register")),1)])])]))}}),oa=e({__name:"user-avatar-simple",setup(e){const a=ae(),t=()=>{};return(e,s)=>l(a).userInfoLoading?w("",!0):(g(),p("a",{key:0,href:"#",class:"d-flex",target:"_blank",onClick:o(t,["prevent"]),style:{"align-items":"center"}},[d(A,{src:l(a).isUserLoggedIn?"./images/user/avatar.svg":"./images/user/avatar-not-login.svg",transition:!1,width:"36",height:"36",class:"github-icon mr-4"},null,8,["src"]),c(" "+u(l(a).isUserLoggedIn?l(a).currentUserData?.name:e.$t("User.NotLoggin")),1)]))}}),la={key:0,class:"not-login login-overlay"},ia={class:"login-top-part pt-6 px-6"},na={key:1,class:"login-success login-overlay"},ra={class:"login-top-part pt-6 px-6"},da=e({__name:"user-info-btn",setup(e){const a=ae();return t((async()=>{a.updateCurrentUserData()})),(e,t)=>{const s=oa,o=sa,i=Ke,c=ze,u=de,m=ie;return g(),p(h,null,[d(z,{location:"bottom"},{activator:n((({props:e})=>[d(s,v(f(e)),null,16)])),default:n((()=>[l(a).isUserLoggedIn?(g(),p("div",na,[r("div",ra,[d(o)]),d(i)])):(g(),p("div",la,[r("div",ia,[d(o)])]))])),_:1}),d(c),d(u),d(m)],64)}}});class ca{static async getDefaultHFHomeDir(){return await q()+"/.cache/huggingface"}static async getHFHomeDirDisplay(e){if(e.HF_HOME)return e.HF_HOME;return await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(e){const a=await this.getDefaultHFHomeDir(),t=Object.assign({},e);return t.HF_HOME===a&&(t.HF_HOME=""),await D(t)}}const ua=$("configDialog",{state:()=>({showDialog:!1}),actions:{showDialogTrigger(){this.showDialog=!0,setTimeout((()=>{this.showDialog=!1}),100)}}}),ga=e({__name:"global-config-btn",setup(e){const v=ua(),{addToast:f}=U(),{t:_}=H(),V=a(!1),C=a({}),b=a({}),k=a(!1),D=a(!1),$=a(!1),N=a(!0),z=a("");t((()=>{window.ipcRenderer?.on(X.OPEN_GLOBAL_CONFIG_DIALOG,((e,...a)=>{q()}))}));const Z=async()=>{if(D.value&&C){k.value=!0;try{await P(C.value),await ca.saveGlobalEnvVars(b.value);const e=_("Common.saveSuccess");f(e,"success"),G(),$.value&&setTimeout((()=>{J()}),2e3)}catch(e){console.error(e),f(String(e),"error")}finally{k.value=!1}}},G=async()=>{V.value=!1},q=async()=>{if(V.value=!0,await oe(),window.ipcRenderer){C.value=await x();const e=await T();e.HF_HOME=await ca.getHFHomeDirDisplay(e),b.value=e,console.log("envVars",b)}},W=async()=>{const e=await Y(C.value.LMD_DATA_ROOT,!0);e&&e.path&&(C.value.LMD_DATA_ROOT=e.path,Q(e))},Q=e=>{const a=K.checkModelsDirValid(e,["logs"]),t=K.checkModelsDirValid(e,["scripts"]);N.value=a||t},ee=async()=>{const e=await L();e?.rootDir?C.value.LMD_DATA_ROOT=e?.rootDir:f(_("ConfigDialog.NoDefraultDirError"),"warning")},ae=[e=>!!e||_("Common.fieldRequired"),()=>N.value||_("ConfigDialog.DirNotValid")],te=async()=>{const e=await Y(b.value.HF_HOME,!1);e&&e.path&&(b.value.HF_HOME=e.path)},se=async()=>{const e=await ca.getDefaultHFHomeDir();e?b.value.HF_HOME=e:f(_("ConfigDialog.NoDefraultDirError"),"warning")},oe=async()=>{z.value=await ca.getDefaultHFHomeDir()};return m((()=>v.showDialog),(e=>{e&&q()})),m((()=>C.value.LMD_DATA_ROOT),((e,a)=>{void 0!==a&&e!==a&&($.value=!0)})),(e,a)=>(g(),p(h,null,[d(M,{class:"hover-border",width:"38",height:"38",icon:"",onClick:q},{default:n((()=>[d(A,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})])),_:1}),d(O,{modelValue:l(V),"onUpdate:modelValue":a[7]||(a[7]=e=>i(V)?V.value=e:null),"min-width":"400","max-width":"800"},{default:n((()=>[d(R,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:e.$t("ConfigDialog.globalConfigTitle")},{append:n((()=>[d(M,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:a[0]||(a[0]=e=>V.value=!1)})])),default:n((()=>[l(C)?(g(),s(S,{key:0,class:"pt-0 pb-3 px-6",modelValue:l(D),"onUpdate:modelValue":a[6]||(a[6]=e=>i(D)?D.value=e:null),onSubmit:o(Z,["prevent"])},{default:n((()=>[d(B,null,{default:n((()=>[c(u(e.$t("ConfigDialog.DefaultStorageTitle")),1)])),_:1}),d(E,{modelValue:l(C).LMD_DATA_ROOT,"onUpdate:modelValue":a[1]||(a[1]=e=>l(C).LMD_DATA_ROOT=e),readonly:l(k),rules:ae,label:e.$t("ConfigDialog.DefaultStoragePathLabel")},{append:n((()=>[d(j,{location:"bottom"},{activator:n((({props:e})=>[d(I,y(e,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:n((()=>[r("pre",null,u(e.$t("ConfigDialog.DefaultStorageSubtitle")),1)])),_:1}),d(M,{class:"ml-1",onClick:W,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.DefaultStoragePathBrowse")),1)])),_:1}),d(M,{class:"ml-1",onClick:ee,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["modelValue","readonly","label"]),d(B,null,{default:n((()=>[c(u(e.$t("ConfigDialog.GlobalVariablesTitle")),1)])),_:1}),d(E,{class:"mb-4",readonly:l(k),rules:[],modelValue:l(b).HF_MIRROR,"onUpdate:modelValue":a[2]||(a[2]=e=>l(b).HF_MIRROR=e),hint:e.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:e.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","modelValue","hint","label"]),d(E,{readonly:l(k),rules:[],modelValue:l(b).HF_HOME,"onUpdate:modelValue":a[3]||(a[3]=e=>l(b).HF_HOME=e),label:e.$t("ConfigDialog.HF_HOME_LABEL")},{append:n((()=>[d(j,{location:"bottom"},{activator:n((({props:e})=>[d(I,y(e,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:n((()=>[r("pre",null,u(e.$t("ConfigDialog.HF_HOME_TIP")),1)])),_:1}),d(M,{class:"ml-1",onClick:te,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.HFHOMEPathBrowse")),1)])),_:1}),d(M,{class:"ml-1",onClick:se,variant:"outlined"},{default:n((()=>[c(u(e.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["readonly","modelValue","label"]),d(E,{readonly:l(k),rules:[],modelValue:l(b).GITHUB_PROXY,"onUpdate:modelValue":a[4]||(a[4]=e=>l(b).GITHUB_PROXY=e),hint:e.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:e.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","modelValue","hint","label"]),d(F,{class:"text-center justify-center"},{default:n((()=>[d(M,{variant:"outlined",onClick:a[5]||(a[5]=e=>V.value=!1)},{default:n((()=>[c(u(e.$t("ConfigDialog.close")),1)])),_:1}),d(M,{color:"primary",variant:"flat",type:"submit",loading:l(k)},{default:n((()=>[c(u(e.$t("ConfigDialog.saveConfig")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"])):w("",!0)])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),ma={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},pa=e({__name:"top-right-controls",setup(e){const{locale:a}=W(),s=se();t((async()=>{let e;try{e=(await x()).LMD_LOCALE}catch(a){e=C.getDefaultLocale()}o(e)}));const o=async e=>{a.value=e;const t=await x();t.LMD_LOCALE=a.value,await P(t),s.changeLocale(a.value)},i=_((()=>C.getLocaleIcon(a.value)));return(e,t)=>{const s=da;return g(),p("div",ma,[d(ga),d(M,{class:"hover-border",style:{"margin-left":"-6px"},width:"38",height:"38",icon:"",onClick:t[0]||(t[0]=e=>{"zhHans"===a.value?o("en"):o("zhHans")})},{default:n((()=>[d(A,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:l(i)},null,8,["src"])])),_:1}),d(Z,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),d(s)])}}});export{pa as _,ua as a,ae as b,te as c,se as u};
