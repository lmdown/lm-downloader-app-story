import{u as a}from"./vuei18n.js";import{s as l,b as e,g as t,c as o,j as i,k as n,L as s}from"./index.js";import{e as r,b as u,H as c,l as d,a3 as g,F as m,k as f,a1 as D,u as _,j as h,$ as p,a5 as v,Y as w,S as H,K as O,a2 as b,m as y,a0 as C,a as L}from"./vue.js";import{g as T,I as V,e as E,D as F,r as M}from"./lmd-system.js";import{d as A}from"./pinia.js";import{A as $,o as k,b as R,w as I,x,W as G,B,e as P,I as U,d as j,E as N,D as S,t as Y}from"./vuetify.js";class z{static async getDefaultHFHomeDir(){return await T()+"/.cache/huggingface"}static async getHFHomeDirDisplay(a){if(a.HF_HOME)return a.HF_HOME;return await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(a){const e=await this.getDefaultHFHomeDir(),t=Object.assign({},a);return t.HF_HOME===e&&(t.HF_HOME=""),await l(t)}}const X=A("configDialog",{state:()=>({showDialog:!1}),actions:{showDialogTrigger(){this.showDialog=!0,setTimeout((()=>{this.showDialog=!1}),100)}}}),q=r({__name:"global-config-btn",setup(a){const l=X(),{addToast:s}=e(),{t:r}=$(),L=u(!1),T=u({}),A=u({}),S=u(!1),Y=u(!1),q=u(!1),K=u(!0),W=u("");c((()=>{window.ipcRenderer?.on(V.OPEN_GLOBAL_CONFIG_DIALOG,((a,...l)=>{Z()}))}));const J=async()=>{if(Y.value&&T){S.value=!0;try{await n(T.value),await z.saveGlobalEnvVars(A.value);const a=r("Common.saveSuccess");s(a,"success"),Q(),q.value&&setTimeout((()=>{M()}),2e3)}catch(a){console.error(a),s(String(a),"error")}finally{S.value=!1}}},Q=async()=>{L.value=!1},Z=async()=>{if(L.value=!0,await na(),window.ipcRenderer){T.value=await t();const a=await o();a.HF_HOME=await z.getHFHomeDirDisplay(a),A.value=a,console.log("envVars",A)}},aa=async()=>{const a=await E(T.value.LMD_DATA_ROOT,!0);a&&a.path&&(T.value.LMD_DATA_ROOT=a.path,la(a))},la=a=>{const l=F.checkModelsDirValid(a,["logs"]),e=F.checkModelsDirValid(a,["scripts"]);K.value=l||e},ea=async()=>{const a=await i();a?.rootDir?T.value.LMD_DATA_ROOT=a?.rootDir:s(r("ConfigDialog.NoDefraultDirError"),"warning")},ta=[a=>!!a||r("Common.fieldRequired"),()=>K.value||r("ConfigDialog.DirNotValid")],oa=async()=>{const a=await E(A.value.HF_HOME,!1);a&&a.path&&(A.value.HF_HOME=a.path)},ia=async()=>{const a=await z.getDefaultHFHomeDir();a?A.value.HF_HOME=a:s(r("ConfigDialog.NoDefraultDirError"),"warning")},na=async()=>{W.value=await z.getDefaultHFHomeDir()};return d((()=>l.showDialog),(a=>{a&&Z()})),d((()=>T.value.LMD_DATA_ROOT),((a,l)=>{void 0!==l&&a!==l&&(q.value=!0)})),(a,l)=>(C(),g(m,null,[f(k,{class:"hover-border",width:"38",height:"38",icon:"",onClick:Z},{default:D((()=>[f(R,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})])),_:1}),f(I,{modelValue:_(L),"onUpdate:modelValue":l[7]||(l[7]=a=>h(L)?L.value=a:null),"min-width":"400","max-width":"800"},{default:D((()=>[f(x,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("ConfigDialog.globalConfigTitle")},{append:D((()=>[f(k,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:l[0]||(l[0]=a=>L.value=!1)})])),default:D((()=>[_(T)?(C(),p(G,{key:0,class:"pt-0 pb-3 px-6",modelValue:_(Y),"onUpdate:modelValue":l[6]||(l[6]=a=>h(Y)?Y.value=a:null),onSubmit:w(J,["prevent"])},{default:D((()=>[f(B,null,{default:D((()=>[H(O(a.$t("ConfigDialog.DefaultStorageTitle")),1)])),_:1}),f(P,{modelValue:_(T).LMD_DATA_ROOT,"onUpdate:modelValue":l[1]||(l[1]=a=>_(T).LMD_DATA_ROOT=a),readonly:_(S),rules:ta,label:a.$t("ConfigDialog.DefaultStoragePathLabel")},{append:D((()=>[f(U,{location:"bottom"},{activator:D((({props:a})=>[f(j,y(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:D((()=>[b("pre",null,O(a.$t("ConfigDialog.DefaultStorageSubtitle")),1)])),_:1}),f(k,{class:"ml-1",onClick:aa,variant:"outlined"},{default:D((()=>[H(O(a.$t("ConfigDialog.DefaultStoragePathBrowse")),1)])),_:1}),f(k,{class:"ml-1",onClick:ea,variant:"outlined"},{default:D((()=>[H(O(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["modelValue","readonly","label"]),f(B,null,{default:D((()=>[H(O(a.$t("ConfigDialog.GlobalVariablesTitle")),1)])),_:1}),f(P,{class:"mb-4",readonly:_(S),rules:[],modelValue:_(A).HF_MIRROR,"onUpdate:modelValue":l[2]||(l[2]=a=>_(A).HF_MIRROR=a),hint:a.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","modelValue","hint","label"]),f(P,{readonly:_(S),rules:[],modelValue:_(A).HF_HOME,"onUpdate:modelValue":l[3]||(l[3]=a=>_(A).HF_HOME=a),label:a.$t("ConfigDialog.HF_HOME_LABEL")},{append:D((()=>[f(U,{location:"bottom"},{activator:D((({props:a})=>[f(j,y(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:D((()=>[b("pre",null,O(a.$t("ConfigDialog.HF_HOME_TIP")),1)])),_:1}),f(k,{class:"ml-1",onClick:oa,variant:"outlined"},{default:D((()=>[H(O(a.$t("ConfigDialog.HFHOMEPathBrowse")),1)])),_:1}),f(k,{class:"ml-1",onClick:ia,variant:"outlined"},{default:D((()=>[H(O(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["readonly","modelValue","label"]),f(P,{readonly:_(S),rules:[],modelValue:_(A).GITHUB_PROXY,"onUpdate:modelValue":l[4]||(l[4]=a=>_(A).GITHUB_PROXY=a),hint:a.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","modelValue","hint","label"]),f(N,{class:"text-center justify-center"},{default:D((()=>[f(k,{variant:"outlined",onClick:l[5]||(l[5]=a=>L.value=!1)},{default:D((()=>[H(O(a.$t("ConfigDialog.close")),1)])),_:1}),f(k,{color:"primary",variant:"flat",type:"submit",loading:_(S)},{default:D((()=>[H(O(a.$t("ConfigDialog.saveConfig")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"])):v("",!0)])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),K=r({__name:"git-info-btn",setup(a){const l=u(!1),e=a=>{a.preventDefault(),l.value=!0};return(a,t)=>(C(),g(m,null,[b("a",{href:"#",class:"d-flex",target:"_blank",onClick:e,style:{"align-items":"center"}},[f(R,{src:"./images/icons/icon-github.png",transition:!1,width:"36",height:"36",class:"github-icon mr-4"}),H(" "+O(a.$t("App.AppName"))+" Github > ",1)]),f(I,{modelValue:_(l),"onUpdate:modelValue":t[1]||(t[1]=a=>h(l)?l.value=a:null),"min-width":"200","max-width":"560"},{default:D((()=>[f(x,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("GitDialog.DialogTitle")},{append:D((()=>[f(k,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:t[0]||(t[0]=a=>l.value=!1)})])),default:D((()=>[f(S,null,{default:D((()=>[b("h3",null,O(a.$t("GitDialog.CardTitle")),1),t[2]||(t[2]=b("div",null,[H("Github: "),b("a",{href:"https://github.com/lmdown",target:"_blank"},"https://github.com/lmdown")],-1)),t[3]||(t[3]=b("div",null,[H(" Gitee: "),b("a",{href:"https://gitee.com/lmdown",target:"_blank"},"https://gitee.com/lmdown")],-1))])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),W=A("localeInfo",{state:()=>({currentLocale:s.getCurrentLocale()}),actions:{async changeLocale(a){this.currentLocale=a}}}),J={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},Q=r({__name:"top-right-controls",setup(l){const{locale:e}=a(),o=W();c((async()=>{let a;try{a=(await t()).LMD_LOCALE}catch(l){a=s.getDefaultLocale()}i(a)}));const i=async a=>{e.value=a;const l=await t();l.LMD_LOCALE=e.value,await n(l),o.changeLocale(e.value)},r=L((()=>s.getLocaleIcon(e.value)));return(a,l)=>(C(),g("div",J,[f(K),f(Y,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),f(q),f(k,{class:"hover-border",style:{"margin-left":"-6px"},width:"38",height:"38",icon:"",onClick:l[0]||(l[0]=a=>{"zhHans"===e.value?i("en"):i("zhHans")})},{default:D((()=>[f(R,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:_(r)},null,8,["src"])])),_:1})]))}});export{Q as _,X as a,W as u};
