import{u as a}from"./vuei18n.js";import{s as l,g as e,f as t,i as o,j as i,L as n}from"./index.js";import{e as s,b as u,G as r,a1 as c,F as d,j as g,$ as m,u as f,k as _,Z as D,a4 as p,W as h,Q as v,a3 as H,a0 as w,m as b,d as O,_ as y,c as C}from"./vue.js";import{e as V,I as E,d as F,D as M}from"./common-util.js";import{B as T,h as L,b as $,s as k,t as A,K as R,z as G,d as x,H as I,E as B,N as P,y as U,q as N}from"./vuetify.js";class j{static async getDefaultHFHomeDir(){return await V()+"/.cache/huggingface"}static async getHFHomeDirDisplay(a){if(a.HF_HOME)return a.HF_HOME;return await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(a){const e=await this.getDefaultHFHomeDir(),t=Object.assign({},a);return t.HF_HOME===e&&(t.HF_HOME=""),await l(t)}}const S=s({__name:"global-config-btn",setup(a){const{t:l}=T(),n=u(!1),s=u({}),C=u({}),V=u(!1),U=u(!1),N=O("showToastMessage"),S=u(!0),z=u("");r((()=>{window.ipcRenderer?.on(E.OPEN_GLOBAL_CONFIG_DIALOG,((a,...l)=>{K()}))}));const X=async()=>{if(U.value&&s){V.value=!0;try{await i(s.value),await j.saveGlobalEnvVars(C.value);const a=l("Common.saveSuccess");N&&N(a,"success"),q()}catch(a){console.error(a),N&&N(String(a),"error")}finally{V.value=!1}}},Y=a=>!!a||l("Common.fieldRequired"),q=async()=>{n.value=!1},K=async()=>{if(n.value=!0,await ea(),window.ipcRenderer){s.value=await e();const a=await t();a.HF_HOME=await j.getHFHomeDirDisplay(a),C.value=a,console.log("envVars",C)}},Q=async()=>{const a=await F(s.value.LMD_DATA_ROOT,!0);a&&a.path&&(s.value.LMD_DATA_ROOT=a.path,W(a))},W=a=>{const l=M.checkModelsDirValid(a,["logs"]),e=M.checkModelsDirValid(a,["scripts"]);S.value=l||e},Z=async()=>{const a=await o();a?.rootDir?s.value.LMD_DATA_ROOT=a?.rootDir:N&&N(l("ConfigDialog.NoDefraultDirError"),"warning")},J=[Y,()=>S.value||l("ConfigDialog.DirNotValid")],aa=async()=>{const a=await F(C.value.HF_HOME,!1);a&&a.path&&(C.value.HF_HOME=a.path)},la=async()=>{const a=await j.getDefaultHFHomeDir();a?C.value.HF_HOME=a:N&&N(l("ConfigDialog.NoDefraultDirError"),"warning")},ea=async()=>{z.value=await j.getDefaultHFHomeDir()};return(a,l)=>(y(),c(d,null,[g(L,{class:"hover-border",width:"38",height:"38",icon:"",onClick:K},{default:m((()=>[g($,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})])),_:1}),g(k,{modelValue:f(n),"onUpdate:modelValue":l[7]||(l[7]=a=>_(n)?n.value=a:null),"min-width":"400","max-width":"800"},{default:m((()=>[g(A,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("ConfigDialog.globalConfigTitle")},{append:m((()=>[g(L,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:l[0]||(l[0]=a=>n.value=!1)})])),default:m((()=>[f(s)?(y(),D(R,{key:0,class:"pt-0 pb-3 px-6",modelValue:f(U),"onUpdate:modelValue":l[6]||(l[6]=a=>_(U)?U.value=a:null),onSubmit:h(X,["prevent"])},{default:m((()=>[g(G,null,{default:m((()=>[v(H(a.$t("ConfigDialog.DefaultStorageTitle")),1)])),_:1}),g(x,{modelValue:f(s).LMD_DATA_ROOT,"onUpdate:modelValue":l[1]||(l[1]=a=>f(s).LMD_DATA_ROOT=a),readonly:f(V),rules:J,label:a.$t("ConfigDialog.DefaultStoragePathLabel")},{append:m((()=>[g(I,{location:"bottom"},{activator:m((({props:a})=>[g(B,b(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:m((()=>[w("pre",null,H(a.$t("ConfigDialog.DefaultStorageSubtitle")),1)])),_:1}),g(L,{class:"ml-1",onClick:Q},{default:m((()=>[v(H(a.$t("ConfigDialog.DefaultStoragePathBrowse")),1)])),_:1}),g(L,{class:"ml-1",onClick:Z},{default:m((()=>[v(H(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["modelValue","readonly","label"]),g(G,null,{default:m((()=>[v(H(a.$t("ConfigDialog.GlobalVariablesTitle")),1)])),_:1}),g(x,{class:"mb-4",readonly:f(V),rules:[Y],modelValue:f(C).HF_MIRROR,"onUpdate:modelValue":l[2]||(l[2]=a=>f(C).HF_MIRROR=a),hint:a.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","rules","modelValue","hint","label"]),g(x,{readonly:f(V),rules:[Y],modelValue:f(C).HF_HOME,"onUpdate:modelValue":l[3]||(l[3]=a=>f(C).HF_HOME=a),label:a.$t("ConfigDialog.HF_HOME_LABEL")},{append:m((()=>[g(I,{location:"bottom"},{activator:m((({props:a})=>[g(B,b(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:m((()=>[w("pre",null,H(a.$t("ConfigDialog.HF_HOME_TIP")),1)])),_:1}),g(L,{class:"ml-1",onClick:aa},{default:m((()=>[v(H(a.$t("ConfigDialog.HFHOMEPathBrowse")),1)])),_:1}),g(L,{class:"ml-1",onClick:la},{default:m((()=>[v(H(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["readonly","rules","modelValue","label"]),g(x,{readonly:f(V),rules:[Y],modelValue:f(C).GITHUB_PROXY,"onUpdate:modelValue":l[4]||(l[4]=a=>f(C).GITHUB_PROXY=a),hint:a.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","rules","modelValue","hint","label"]),g(P,{class:"text-center justify-center"},{default:m((()=>[g(L,{variant:"outlined",onClick:l[5]||(l[5]=a=>n.value=!1)},{default:m((()=>[v(H(a.$t("ConfigDialog.close")),1)])),_:1}),g(L,{color:"primary",variant:"flat",type:"submit",loading:f(V)},{default:m((()=>[v(H(a.$t("ConfigDialog.saveConfig")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"])):p("",!0)])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),z=s({__name:"git-info-btn",setup(a){const l=u(!1),e=a=>{a.preventDefault(),l.value=!0};return(a,t)=>(y(),c(d,null,[w("a",{href:"#",class:"d-flex",target:"_blank",onClick:e,style:{"align-items":"center"}},[g($,{src:"./images/icons/icon-github.png",transition:!1,width:"36",height:"36",class:"github-icon mr-4"}),v(" "+H(a.$t("App.AppName"))+" Github > ",1)]),g(k,{modelValue:f(l),"onUpdate:modelValue":t[1]||(t[1]=a=>_(l)?l.value=a:null),"min-width":"200","max-width":"560"},{default:m((()=>[g(A,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("GitDialog.DialogTitle")},{append:m((()=>[g(L,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:t[0]||(t[0]=a=>l.value=!1)})])),default:m((()=>[g(U,null,{default:m((()=>[w("h3",null,H(a.$t("GitDialog.CardTitle")),1),t[2]||(t[2]=w("div",null,[v("Github: "),w("a",{href:"https://github.com/lmdown",target:"_blank"},"https://github.com/lmdown")],-1)),t[3]||(t[3]=w("div",null,[v(" Gitee: "),w("a",{href:"https://gitee.com/lmdown",target:"_blank"},"https://gitee.com/lmdown")],-1))])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),X={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},Y=s({__name:"top-right-controls",setup(l){const{locale:t}=a();r((async()=>{let a;try{a=(await e()).LMD_LOCALE}catch(l){a=n.getDefaultLocale()}o(a)}));const o=async a=>{t.value=a;const l=await e();l.LMD_LOCALE=t.value,await i(l)},s=C((()=>n.getLocaleIcon(t.value)));return(a,l)=>(y(),c("div",X,[g(z),g(N,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),g(S),g(L,{class:"hover-border",style:{"margin-left":"-6px"},width:"38",height:"38",icon:"",onClick:l[0]||(l[0]=a=>{"zhHans"===t.value?o("en"):o("zhHans")})},{default:m((()=>[g($,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:f(s)},null,8,["src"])])),_:1})]))}});export{Y as _};
