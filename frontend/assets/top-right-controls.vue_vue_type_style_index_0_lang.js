import{u as a}from"./vuei18n.js";import{s as l,b as e,f as t,g as o,j as i,k as n,L as s}from"./index.js";import{e as r,b as u,H as c,a3 as d,F as g,k as m,a1 as f,u as _,j as p,$ as D,a5 as h,Y as v,S as H,K as w,a2 as b,m as O,a0 as y,a as C}from"./vue.js";import{g as V,I as L,c as E,D as F}from"./common-util.js";import{A as T,o as M,b as $,w as k,x as A,W as R,B as I,e as x,I as G,d as B,E as P,D as U,t as j}from"./vuetify.js";import{d as N}from"./pinia.js";class S{static async getDefaultHFHomeDir(){return await V()+"/.cache/huggingface"}static async getHFHomeDirDisplay(a){if(a.HF_HOME)return a.HF_HOME;return await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(a){const e=await this.getDefaultHFHomeDir(),t=Object.assign({},a);return t.HF_HOME===e&&(t.HF_HOME=""),await l(t)}}const Y=r({__name:"global-config-btn",setup(a){const{addToast:l}=e(),{t:s}=T(),r=u(!1),C=u({}),V=u({}),U=u(!1),j=u(!1),N=u(!0),Y=u("");c((()=>{window.ipcRenderer?.on(L.OPEN_GLOBAL_CONFIG_DIALOG,((a,...l)=>{q()}))}));const z=async()=>{if(j.value&&C){U.value=!0;try{await n(C.value),await S.saveGlobalEnvVars(V.value);const a=s("Common.saveSuccess");l(a,"success"),X()}catch(a){console.error(a),l(String(a),"error")}finally{U.value=!1}}},X=async()=>{r.value=!1},q=async()=>{if(r.value=!0,await la(),window.ipcRenderer){C.value=await t();const a=await o();a.HF_HOME=await S.getHFHomeDirDisplay(a),V.value=a,console.log("envVars",V)}},K=async()=>{const a=await E(C.value.LMD_DATA_ROOT,!0);a&&a.path&&(C.value.LMD_DATA_ROOT=a.path,W(a))},W=a=>{const l=F.checkModelsDirValid(a,["logs"]),e=F.checkModelsDirValid(a,["scripts"]);N.value=l||e},J=async()=>{const a=await i();a?.rootDir?C.value.LMD_DATA_ROOT=a?.rootDir:l(s("ConfigDialog.NoDefraultDirError"),"warning")},Q=[a=>!!a||s("Common.fieldRequired"),()=>N.value||s("ConfigDialog.DirNotValid")],Z=async()=>{const a=await E(V.value.HF_HOME,!1);a&&a.path&&(V.value.HF_HOME=a.path)},aa=async()=>{const a=await S.getDefaultHFHomeDir();a?V.value.HF_HOME=a:l(s("ConfigDialog.NoDefraultDirError"),"warning")},la=async()=>{Y.value=await S.getDefaultHFHomeDir()};return(a,l)=>(y(),d(g,null,[m(M,{class:"hover-border",width:"38",height:"38",icon:"",onClick:q},{default:f((()=>[m($,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})])),_:1}),m(k,{modelValue:_(r),"onUpdate:modelValue":l[7]||(l[7]=a=>p(r)?r.value=a:null),"min-width":"400","max-width":"800"},{default:f((()=>[m(A,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("ConfigDialog.globalConfigTitle")},{append:f((()=>[m(M,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:l[0]||(l[0]=a=>r.value=!1)})])),default:f((()=>[_(C)?(y(),D(R,{key:0,class:"pt-0 pb-3 px-6",modelValue:_(j),"onUpdate:modelValue":l[6]||(l[6]=a=>p(j)?j.value=a:null),onSubmit:v(z,["prevent"])},{default:f((()=>[m(I,null,{default:f((()=>[H(w(a.$t("ConfigDialog.DefaultStorageTitle")),1)])),_:1}),m(x,{modelValue:_(C).LMD_DATA_ROOT,"onUpdate:modelValue":l[1]||(l[1]=a=>_(C).LMD_DATA_ROOT=a),readonly:_(U),rules:Q,label:a.$t("ConfigDialog.DefaultStoragePathLabel")},{append:f((()=>[m(G,{location:"bottom"},{activator:f((({props:a})=>[m(B,O(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:f((()=>[b("pre",null,w(a.$t("ConfigDialog.DefaultStorageSubtitle")),1)])),_:1}),m(M,{class:"ml-1",onClick:K},{default:f((()=>[H(w(a.$t("ConfigDialog.DefaultStoragePathBrowse")),1)])),_:1}),m(M,{class:"ml-1",onClick:J},{default:f((()=>[H(w(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["modelValue","readonly","label"]),m(I,null,{default:f((()=>[H(w(a.$t("ConfigDialog.GlobalVariablesTitle")),1)])),_:1}),m(x,{class:"mb-4",readonly:_(U),rules:[],modelValue:_(V).HF_MIRROR,"onUpdate:modelValue":l[2]||(l[2]=a=>_(V).HF_MIRROR=a),hint:a.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","modelValue","hint","label"]),m(x,{readonly:_(U),rules:[],modelValue:_(V).HF_HOME,"onUpdate:modelValue":l[3]||(l[3]=a=>_(V).HF_HOME=a),label:a.$t("ConfigDialog.HF_HOME_LABEL")},{append:f((()=>[m(G,{location:"bottom"},{activator:f((({props:a})=>[m(B,O(a,{icon:"mdi-information-slab-circle-outline"}),null,16)])),default:f((()=>[b("pre",null,w(a.$t("ConfigDialog.HF_HOME_TIP")),1)])),_:1}),m(M,{class:"ml-1",onClick:Z},{default:f((()=>[H(w(a.$t("ConfigDialog.HFHOMEPathBrowse")),1)])),_:1}),m(M,{class:"ml-1",onClick:aa},{default:f((()=>[H(w(a.$t("ConfigDialog.UseDefaultValue")),1)])),_:1})])),_:1},8,["readonly","modelValue","label"]),m(x,{readonly:_(U),rules:[],modelValue:_(V).GITHUB_PROXY,"onUpdate:modelValue":l[4]||(l[4]=a=>_(V).GITHUB_PROXY=a),hint:a.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","modelValue","hint","label"]),m(P,{class:"text-center justify-center"},{default:f((()=>[m(M,{variant:"outlined",onClick:l[5]||(l[5]=a=>r.value=!1)},{default:f((()=>[H(w(a.$t("ConfigDialog.close")),1)])),_:1}),m(M,{color:"primary",variant:"flat",type:"submit",loading:_(U)},{default:f((()=>[H(w(a.$t("ConfigDialog.saveConfig")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["modelValue"])):h("",!0)])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),z=r({__name:"git-info-btn",setup(a){const l=u(!1),e=a=>{a.preventDefault(),l.value=!0};return(a,t)=>(y(),d(g,null,[b("a",{href:"#",class:"d-flex",target:"_blank",onClick:e,style:{"align-items":"center"}},[m($,{src:"./images/icons/icon-github.png",transition:!1,width:"36",height:"36",class:"github-icon mr-4"}),H(" "+w(a.$t("App.AppName"))+" Github > ",1)]),m(k,{modelValue:_(l),"onUpdate:modelValue":t[1]||(t[1]=a=>p(l)?l.value=a:null),"min-width":"200","max-width":"560"},{default:f((()=>[m(A,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("GitDialog.DialogTitle")},{append:f((()=>[m(M,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:t[0]||(t[0]=a=>l.value=!1)})])),default:f((()=>[m(U,null,{default:f((()=>[b("h3",null,w(a.$t("GitDialog.CardTitle")),1),t[2]||(t[2]=b("div",null,[H("Github: "),b("a",{href:"https://github.com/lmdown",target:"_blank"},"https://github.com/lmdown")],-1)),t[3]||(t[3]=b("div",null,[H(" Gitee: "),b("a",{href:"https://gitee.com/lmdown",target:"_blank"},"https://gitee.com/lmdown")],-1))])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),X=N("localeInfo",{state:()=>({currentLocale:s.getCurrentLocale()}),actions:{async changeLocale(a){this.currentLocale=a}}}),q={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},K=r({__name:"top-right-controls",setup(l){const{locale:e}=a(),o=X();c((async()=>{let a;try{a=(await t()).LMD_LOCALE}catch(l){a=s.getDefaultLocale()}i(a)}));const i=async a=>{e.value=a;const l=await t();l.LMD_LOCALE=e.value,await n(l),o.changeLocale(e.value)},r=C((()=>s.getLocaleIcon(e.value)));return(a,l)=>(y(),d("div",q,[m(z),m(j,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),m(Y),m(M,{class:"hover-border",style:{"margin-left":"-6px"},width:"38",height:"38",icon:"",onClick:l[0]||(l[0]=a=>{"zhHans"===e.value?i("en"):i("zhHans")})},{default:f((()=>[m($,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:_(r)},null,8,["src"])])),_:1})]))}});export{K as _,X as u};
