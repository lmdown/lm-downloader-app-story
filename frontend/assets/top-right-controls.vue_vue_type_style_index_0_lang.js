import{a5 as K,d as O,J as W,r as p,o as A,a6 as h,a7 as aa,e as y,F as G,g as e,V as m,w as t,k as F,z as U,u as r,O as _,B as P,c as ea,b as la,a8 as ta,a3 as oa,G as L,H as f,t as c,a9 as V,a2 as M,p as v,Q as k,a1 as $,aa as ia,Z as na,ab as sa,i as w,ac as N,D as ra,ad as ua,Y as I,E as da,q as ga}from"./index.js";import{g as ca,I as fa,s as B,D as R}from"./common-util.js";class C{static async getDefaultHFHomeDir(){return await ca()+"/.cache/huggingface"}static async getHFHomeDirDisplay(o){return o.HF_HOME?o.HF_HOME:await this.getDefaultHFHomeDir()}static async saveGlobalEnvVars(o){const d=await this.getDefaultHFHomeDir(),i=Object.assign({},o);return i.HF_HOME===d&&(i.HF_HOME=""),await K(i)}}const ma=O({__name:"global-config-btn",setup(b){const{t:o}=W(),d=p(!1),i=p({}),l=p({}),u=p(!1),g=p(!1),D=na("showToastMessage"),E=p(!0),S=p("");A(()=>{window.ipcRenderer?.on(fa.OPEN_GLOBAL_CONFIG_DIALOG,(a,...s)=>{T()})});const z=async()=>{if(g.value&&i){u.value=!0;try{const a=await N(i.value),s=await C.saveGlobalEnvVars(l.value),n=o("Common.saveSuccess");D&&D(n,"success"),Y()}catch(a){console.error(a),D&&D(String(a),"error")}finally{u.value=!1}}},H=a=>!!a||o("Common.fieldRequired"),Y=async()=>{d.value=!1},T=async()=>{if(d.value=!0,await Z(),window.ipcRenderer){i.value=await h();const a=await aa();a.HF_HOME=await C.getHFHomeDirDisplay(a),l.value=a,console.log("envVars",l)}},X=async()=>{const a=await B(i.value.LMD_DATA_ROOT,!0);a&&a.path&&(i.value.LMD_DATA_ROOT=a.path,j(a))},j=a=>{const s=R.checkModelsDirValid(a,["logs"]),n=R.checkModelsDirValid(a,["scripts"]);E.value=s||n},q=async()=>{const a=await sa();a?.rootDir?i.value.LMD_DATA_ROOT=a?.rootDir:D&&D(o("ConfigDialog.NoDefraultDirError"),"warning")},x=[H,()=>E.value||o("ConfigDialog.DirNotValid")],J=async()=>{const a=await B(l.value.HF_HOME,!1);a&&a.path&&(l.value.HF_HOME=a.path)},Q=async()=>{const a=await C.getDefaultHFHomeDir();a?l.value.HF_HOME=a:D&&D(o("ConfigDialog.NoDefraultDirError"),"warning")},Z=async()=>{S.value=await C.getDefaultHFHomeDir()};return(a,s)=>(w(),y(G,null,[e(m,{class:"hover-border",width:"38",height:"38",icon:"",onClick:T},{default:t(()=>[e(F,{width:"36",height:"36",src:"./images/icons/icon-config.png",transition:!1})]),_:1}),e(U,{modelValue:r(d),"onUpdate:modelValue":s[7]||(s[7]=n=>_(d)?d.value=n:null),"min-width":"400","max-width":"800"},{default:t(()=>[e(P,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:a.$t("ConfigDialog.globalConfigTitle")},{append:t(()=>[e(m,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:s[0]||(s[0]=n=>d.value=!1)})]),default:t(()=>[r(i)?(w(),ea(ta,{key:0,class:"pt-0 pb-3 px-6",modelValue:r(g),"onUpdate:modelValue":s[6]||(s[6]=n=>_(g)?g.value=n:null),onSubmit:oa(z,["prevent"])},{default:t(()=>[e(L,null,{default:t(()=>[f(c(a.$t("ConfigDialog.DefaultStorageTitle")),1)]),_:1}),e(V,{modelValue:r(i).LMD_DATA_ROOT,"onUpdate:modelValue":s[1]||(s[1]=n=>r(i).LMD_DATA_ROOT=n),readonly:r(u),rules:x,label:a.$t("ConfigDialog.DefaultStoragePathLabel")},{append:t(()=>[e(M,{location:"bottom"},{activator:t(({props:n})=>[e(k,$(n,{icon:"mdi-information-slab-circle-outline"}),null,16)]),default:t(()=>[v("pre",null,c(a.$t("ConfigDialog.DefaultStorageSubtitle")),1)]),_:1}),e(m,{class:"ml-1",onClick:X},{default:t(()=>[f(c(a.$t("ConfigDialog.DefaultStoragePathBrowse")),1)]),_:1}),e(m,{class:"ml-1",onClick:q},{default:t(()=>[f(c(a.$t("ConfigDialog.UseDefaultValue")),1)]),_:1})]),_:1},8,["modelValue","readonly","label"]),e(L,null,{default:t(()=>[f(c(a.$t("ConfigDialog.GlobalVariablesTitle")),1)]),_:1}),e(V,{class:"mb-4",readonly:r(u),rules:[H],modelValue:r(l).HF_MIRROR,"onUpdate:modelValue":s[2]||(s[2]=n=>r(l).HF_MIRROR=n),hint:a.$t("ConfigDialog.HF_ENDPOINT_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.HF_ENDPOINT_LABEL")},null,8,["readonly","rules","modelValue","hint","label"]),e(V,{readonly:r(u),rules:[H],modelValue:r(l).HF_HOME,"onUpdate:modelValue":s[3]||(s[3]=n=>r(l).HF_HOME=n),label:a.$t("ConfigDialog.HF_HOME_LABEL")},{append:t(()=>[e(M,{location:"bottom"},{activator:t(({props:n})=>[e(k,$(n,{icon:"mdi-information-slab-circle-outline"}),null,16)]),default:t(()=>[v("pre",null,c(a.$t("ConfigDialog.HF_HOME_TIP")),1)]),_:1}),e(m,{class:"ml-1",onClick:J},{default:t(()=>[f(c(a.$t("ConfigDialog.HFHOMEPathBrowse")),1)]),_:1}),e(m,{class:"ml-1",onClick:Q},{default:t(()=>[f(c(a.$t("ConfigDialog.UseDefaultValue")),1)]),_:1})]),_:1},8,["readonly","rules","modelValue","label"]),e(V,{readonly:r(u),rules:[H],modelValue:r(l).GITHUB_PROXY,"onUpdate:modelValue":s[4]||(s[4]=n=>r(l).GITHUB_PROXY=n),hint:a.$t("ConfigDialog.GITHUB_PROXY_TIP"),"persistent-hint":"",label:a.$t("ConfigDialog.GITHUB_PROXY_LABEL")},null,8,["readonly","rules","modelValue","hint","label"]),e(ia,{class:"text-center justify-center"},{default:t(()=>[e(m,{variant:"outlined",onClick:s[5]||(s[5]=n=>d.value=!1)},{default:t(()=>[f(c(a.$t("ConfigDialog.close")),1)]),_:1}),e(m,{color:"primary",variant:"flat",type:"submit",loading:r(u)},{default:t(()=>[f(c(a.$t("ConfigDialog.saveConfig")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["modelValue"])):la("",!0)]),_:1},8,["title"])]),_:1},8,["modelValue"])],64))}}),Da=O({__name:"git-info-btn",setup(b){const o=p(!1),d=i=>{i.preventDefault(),o.value=!0};return(i,l)=>(w(),y(G,null,[v("a",{href:"#",class:"d-flex",target:"_blank",onClick:d,style:{"align-items":"center"}},[e(F,{src:"./images/icons/icon-github.png",transition:!1,width:"36",height:"36",class:"github-icon mr-4"}),l[2]||(l[2]=f(" Github > "))]),e(U,{modelValue:r(o),"onUpdate:modelValue":l[1]||(l[1]=u=>_(o)?o.value=u:null),"min-width":"200","max-width":"560"},{default:t(()=>[e(P,{class:"mx-auto px-0 py-0 window-no-drag",width:"100%",title:i.$t("GitDialog.DialogTitle")},{append:t(()=>[e(m,{icon:"mdi-close",class:"ms-auto",size:"compact",text:"Ok",elevation:"0",onClick:l[0]||(l[0]=u=>o.value=!1)})]),default:t(()=>[e(ra,null,{default:t(()=>[v("h3",null,c(i.$t("GitDialog.CardTitle")),1),l[3]||(l[3]=v("div",null,[f("Github: "),v("a",{href:"https://github.com/lmdown",target:"_blank"},"https://github.com/lmdown")],-1)),l[4]||(l[4]=v("div",null,[f(" Gitee: "),v("a",{href:"https://gitee.com/lmdown",target:"_blank"},"https://gitee.com/lmdown")],-1))]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])],64))}}),pa={class:"lmd-top-right-controls ga-6 mr-12 window-no-drag"},Va=O({__name:"top-right-controls",setup(b){const{locale:o}=ua();A(async()=>{let u;try{u=(await h()).LMD_LOCALE}catch{u=I.getDefaultLocale()}i(u)});const d=()=>{o.value==="zhHans"?i("en"):i("zhHans")},i=async u=>{o.value=u;const g=await h();g.LMD_LOCALE=o.value,await N(g)},l=da(()=>I.getLocaleIcon(o.value));return(u,g)=>(w(),y("div",pa,[e(Da),e(ga,{vertical:"",style:{opacity:"1"},color:"#EBEBF7"}),e(ma),e(m,{class:"hover-border",style:{"margin-left":"-6px"},width:"38",height:"38",icon:"",onClick:g[0]||(g[0]=D=>d())},{default:t(()=>[e(F,{style:{"margin-left":"16px"},width:"56",height:"36",transition:!1,src:r(l)},null,8,["src"])]),_:1})]))}});export{Va as _};
