import{_ as e}from"./delete-confirm-dialog-with-loading.js";import{_ as a}from"./common-app-bar.vue_vue_type_script_setup_true_lang.js";import{e as t,b as o,H as i,l,a4 as s,k as r,a2 as n,a3 as p,K as m,u as d,j as g,a0 as u,a6 as c,ae as v,af as h,S as y,V as f,F as L,a1 as x}from"./vue.js";import{a as b,r as O}from"./lmd-system.js";import{b as _,g as w}from"./index.js";import{u as j}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import{D as T}from"./DateTimeUtil.js";import{U as k,G as $,l as A,b as P,F as U,W as C,M as D,a as E,q as V,X as F,r as M}from"./vuetify.js";import"./pinia.js";import"./xterm.js";import"./debounce.js";import"./vuei18n.js";import"./lmd-locales.js";import"./dayjs.js";const N={class:"page-title"},R={class:"page-subtitle"},S={style:{width:"380px"}},W={key:1,class:"text-grey text-caption align-self-center"},G={class:"log-file-cell"},q=["onClick"],H=["onClick"],K=t({__name:"OperationLogList",setup(t){const K=o(10),X=o(1),{smAndDown:z}=k(),{t:B}=$(),{addToast:I}=_(),J=o([]),Q=o([]),Y=o(""),Z=o([]),ee=o([]),ae=o([]),te=o(!0),oe=o(0),ie=o(!1),le=o(!1),se=o(),re=({page:e,itemsPerPage:a})=>{te.value=!0,me(e,a)},ne=j();i((async()=>{pe(),ae.value=await(async()=>(await b.get("op-log/ai-app/apps")).data)()}));const pe=async()=>{Q.value=[{title:"id",key:"id",align:"end",sortable:!1,fixed:!0},{title:B("OperationLog.AppName"),align:"start",sortable:!1,key:"appName"},{title:B("OperationLog.Type"),key:"logType",sortable:!1,align:"start"},{title:B("OperationLog.RunningMode"),key:"installMethod",sortable:!1,align:"end"},{title:B("OperationLog.CreateTime"),key:"createTime",sortable:!1,align:"end"},{title:B("OperationLog.OperationStatus"),key:"operationStatus",sortable:!1,align:"start"},{title:B("OperationLog.Actions"),key:"logFilePath",align:"start",minWidth:"80px",maxWidth:"160px",width:z.value?"80px":"160px",fixed:!0,sortable:!1}]};l((()=>ne.currentLocale),pe),l((()=>Z.value),(()=>{J.value=[],re({page:1,itemsPerPage:K.value})}));const me=async(e,a)=>{const t=await(async(e,a,t)=>{let o=`op-log/ai-app?page=${a}&limit=${t}`;e&&e.length>0&&(o=`op-log/ai-app?ids=${e.join(",")}&page=${a}&limit=${t}`);return(await b.get(o)).data})(Z.value,e,a);ee.value=t.data,oe.value=t.total,te.value=!1},de=async e=>{try{await(async e=>{const a=e.id,t=await b({url:`/op-log/ai-app/export/${a}`,method:"GET",responseType:"blob"}),o=document.createElement("a"),i=URL.createObjectURL(t.data);o.href=i;const l=e.logFilePath||"app.log";o.setAttribute("download",l),document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(i)})(e)}catch(a){console.error("There was an error downloading the file!",a),a instanceof axios.AxiosError?404===a.status&&I(B("OperationLog.FileNotExist"),"error"):I(a.message,"error")}},ge=()=>{le.value=!0},ue=async()=>{try{await(async e=>(await b({url:"/op-log/ai-app/",method:"DELETE",data:e})).data)(J.value),le.value=!1,J.value=[],1!==X.value?X.value=1:re({page:1,itemsPerPage:K.value})}catch(e){I(e.message,"error")}};return(t,o)=>{const i=a,l=e;return x(),s(L,null,[r(i),r(M,{class:"mx-2 px-8"},{default:n((()=>[r(A,{class:"my-2 log-page-title-container"},{default:n((()=>[r(P,{src:"./images/app/log-icon.svg",width:"58",height:"48","max-width":"58","max-height":"48"}),p("div",N,m(t.$t("App.OpLog")),1),p("div",R,m(t.$t("OperationLog.TotalLogs",{totalCount:d(oe)})),1),r(U),p("div",S,[r(C,{items:d(ae),"hide-details":"",modelValue:d(Z),"onUpdate:modelValue":o[0]||(o[0]=e=>g(Z)?Z.value=e:null),multiple:"",variant:"outlined",density:"compact","item-title":"name",clearable:"","item-value":"id",placeholder:t.$t("OperationLog.AppName")},{item:n((({props:e})=>[r(E,v(h(e)),null,16)])),selection:n((({item:e,index:a})=>[a<2?(x(),u(D,{key:0,text:e.title},null,8,["text"])):c("",!0),2===a?(x(),s("span",W," (+"+m(d(Z).length-2)+" "+m(t.$t("OperationLog.Others"))+") ",1)):c("",!0)])),_:1},8,["items","modelValue","placeholder"])])])),_:1}),r(A,{class:"my-4 ga-2 d-flex"},{default:n((()=>[r(V,{variant:"flat",color:"red",disabled:0===d(J).length,onClick:ge},{default:n((()=>[y(m(t.$t("OperationLog.Delete")),1)])),_:1},8,["disabled"])])),_:1}),r(d(F),{class:"no-wrap-table",density:"compact",page:d(X),"onUpdate:page":o[1]||(o[1]=e=>g(X)?X.value=e:null),"items-per-page":d(K),"onUpdate:itemsPerPage":o[2]||(o[2]=e=>g(K)?K.value=e:null),modelValue:d(J),"onUpdate:modelValue":o[3]||(o[3]=e=>g(J)?J.value=e:null),headers:d(Q),items:d(ee),"items-length":d(oe),loading:d(te),search:d(Y),"item-value":"id","show-select":"",ref_key:"dataTable",ref:se,"onUpdate:options":re},{"item.logType":n((({item:e})=>{return[y(m((a=e.logType,B("OperationLog.LogType_"+a))),1)];var a})),"item.installMethod":n((({item:e})=>{return[y(m((a=e.installMethod,B("OperationLog.RunningMode_"+a))),1)];var a})),"item.createTime":n((({item:e})=>[y(m(d(T).format(e.createTime,!1)),1)])),"item.operationStatus":n((({item:e})=>[y(m(void 0!==e.operationStatus?e.operationStatus:"--"),1)])),"item.logFilePath":n((({item:e})=>[p("div",G,[p("a",{href:"#",onClick:f((a=>(async e=>{const a=(await w()).LMD_DATA_ROOT+"/logs/app/"+e.logFilePath;await O(a)||I(B("OperationLog.FileNotExist"),"error")})(e)),["prevent"])},m(t.$t("OperationLog.ActionView")),9,q),o[5]||(o[5]=y(" Â  ")),p("a",{href:"#",onClick:f((a=>de(e)),["prevent"])},m(t.$t("OperationLog.ActionExpor")),9,H)])])),_:1},8,["page","items-per-page","modelValue","headers","items","items-length","loading","search"])])),_:1}),r(l,{"waiting-delete-result":!0,"in-progress":d(ie),"model-value":d(le),"onUpdate:modelValue":o[4]||(o[4]=e=>le.value=e),"extra-tip":t.$t("OperationLog.DeleteConfirmMsg"),"remvoe-btn-label":t.$t("OperationLog.Delete"),itemName:t.$t("OperationLog.AppLog"),onConfirm:ue},null,8,["in-progress","model-value","extra-tip","remvoe-btn-label","itemName"])],64)}}});export{K as default};
