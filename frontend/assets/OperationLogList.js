import{_ as e}from"./delete-confirm-dialog-with-loading.js";import{_ as a}from"./common-app-bar.vue_vue_type_script_setup_true_lang.js";import{e as t,b as o,H as i,l,a4 as s,k as r,a2 as n,a3 as p,K as m,u as d,S as g,j as u,V as c,F as v,a1 as y}from"./vue.js";import{a as h,r as f}from"./lmd-system.js";import{b as L,g as b}from"./index.js";import{u as _}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import{D as O}from"./DateTimeUtil.js";import{U as x,G as j,l as w,q as T,W as k,r as A}from"./vuetify.js";import"./pinia.js";import"./xterm.js";import"./debounce.js";import"./vuei18n.js";import"./lmd-locales.js";import"./dayjs.js";const U={class:"op-log-list-title mt-4 mb-4"},$={class:"log-file-cell"},P=["onClick"],C=["onClick"],D=t({__name:"OperationLogList",setup(t){const D=o(10),E=o(1),{smAndDown:F}=x(),{t:M}=j(),{addToast:R}=L(),N=o([]),S=o([]),V=o(""),W=o(""),G=o([]),q=o(!0),H=o(0),K=o(!1),z=o(!1),B=o(),I=({page:e,itemsPerPage:a})=>{q.value=!0,X(e,a)},J=_();i((async()=>{Q()}));const Q=async()=>{S.value=[{title:"id",key:"id",align:"end",sortable:!1,fixed:!0},{title:M("OperationLog.AppName"),align:"start",sortable:!1,key:"appName"},{title:M("OperationLog.Type"),key:"logType",sortable:!1,align:"start"},{title:M("OperationLog.RunningMode"),key:"installMethod",sortable:!1,align:"end"},{title:M("OperationLog.CreateTime"),key:"createTime",sortable:!1,align:"end"},{title:M("OperationLog.OperationStatus"),key:"operationStatus",sortable:!1,align:"start"},{title:M("OperationLog.Actions"),key:"logFilePath",align:"start",minWidth:"80px",maxWidth:"160px",width:F.value?"80px":"160px",fixed:!0,sortable:!1}]};l((()=>J.currentLocale),Q);const X=async(e,a)=>{const t=await(async(e,a,t)=>(await h.get(`op-log/ai-app?ids=${e}&page=${a}&limit=${t}`)).data)(W.value,e,a);G.value=t.data,H.value=t.total,q.value=!1},Y=async e=>{try{await(async e=>{const a=e.id,t=await h({url:`/op-log/ai-app/export/${a}`,method:"GET",responseType:"blob"}),o=document.createElement("a"),i=URL.createObjectURL(t.data);o.href=i;const l=e.logFilePath||"app.log";o.setAttribute("download",l),document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(i)})(e)}catch(a){console.error("There was an error downloading the file!",a),a instanceof axios.AxiosError?404===a.status&&R(M("OperationLog.FileNotExist"),"error"):R(a.message,"error")}},Z=()=>{z.value=!0},ee=async()=>{try{await(async e=>(await h({url:"/op-log/ai-app/",method:"DELETE",data:e})).data)(N.value),z.value=!1,N.value=[],1!==E.value?E.value=1:I({page:1,itemsPerPage:D.value})}catch(e){R(e.message,"error")}};return(t,o)=>{const i=a,l=e;return y(),s(v,null,[r(i),r(A,{class:"mx-2 px-8"},{default:n((()=>[p("div",U,m(t.$t("App.OpLog")),1),r(w,{class:"my-2"},{default:n((()=>[r(T,{variant:"flat",color:"red",disabled:0===d(N).length,onClick:Z},{default:n((()=>[g(m(t.$t("OperationLog.Delete")),1)])),_:1},8,["disabled"])])),_:1}),r(w,{class:""},{default:n((()=>[r(d(k),{class:"no-wrap-table",page:d(E),"onUpdate:page":o[0]||(o[0]=e=>u(E)?E.value=e:null),"items-per-page":d(D),"onUpdate:itemsPerPage":o[1]||(o[1]=e=>u(D)?D.value=e:null),modelValue:d(N),"onUpdate:modelValue":o[2]||(o[2]=e=>u(N)?N.value=e:null),headers:d(S),items:d(G),"items-length":d(H),loading:d(q),search:d(V),"item-value":"id","show-select":"",ref_key:"dataTable",ref:B,"onUpdate:options":I},{"item.logType":n((({item:e})=>{return[g(m((a=e.logType,M("OperationLog.LogType_"+a))),1)];var a})),"item.installMethod":n((({item:e})=>{return[g(m((a=e.installMethod,M("OperationLog.RunningMode_"+a))),1)];var a})),"item.createTime":n((({item:e})=>[g(m(d(O).format(e.createTime,!1)),1)])),"item.operationStatus":n((({item:e})=>[g(m(void 0!==e.operationStatus?e.operationStatus:"--"),1)])),"item.logFilePath":n((({item:e})=>[p("div",$,[p("a",{href:"#",onClick:c((a=>(async e=>{const a=(await b()).LMD_DATA_ROOT+"/logs/app/"+e.logFilePath;await f(a)||R(M("OperationLog.FileNotExist"),"error")})(e)),["prevent"])},m(t.$t("OperationLog.ActionView")),9,P),o[4]||(o[4]=g(" Â  ")),p("a",{href:"#",onClick:c((a=>Y(e)),["prevent"])},m(t.$t("OperationLog.ActionExpor")),9,C)])])),_:1},8,["page","items-per-page","modelValue","headers","items","items-length","loading","search"])])),_:1})])),_:1}),r(l,{"waiting-delete-result":!0,"in-progress":d(K),"model-value":d(z),"onUpdate:modelValue":o[3]||(o[3]=e=>z.value=e),"extra-tip":t.$t("OperationLog.DeleteConfirmMsg"),"remvoe-btn-label":t.$t("OperationLog.Delete"),itemName:t.$t("OperationLog.AppLog"),onConfirm:ee},null,8,["in-progress","model-value","extra-tip","remvoe-btn-label","itemName"])],64)}}});export{D as default};
