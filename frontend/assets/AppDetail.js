import{N as e}from"./vue-easy-lightbox.js";import{t as a,u as t,w as s,b as l,x as n,y as p,z as i,p as o,A as r,B as m,q as c,r as u,C as d,D as f,E as A,h,F as y,G as D,s as v}from"./vuetify.js";import{e as g,b as x,o as _,a6 as w,F as k,j as b,a4 as L,a7 as F,u as I,a3 as M,a2 as j,a8 as $,V as C,c as T,a5 as V,Q as z,G as R,x as S,k as B,aa as O,ab as H}from"./vue.js";import"./index2.js";import{d as E}from"./pinia.js";import{a as G,_ as U}from"./index.js";import{c as q}from"./install-instance.js";import{A as N}from"./AppScriptType.js";import{A as P,_ as Q}from"./single-installed-instance.vue_vue_type_style_index_0_lang.js";import{u as W}from"./lmapp.js";import{_ as J}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./vuei18n.js";import"./lmd-locales.js";import"./xterm.js";import"./dayjs.js";import"./common-util.js";const K=E("installedInstance",{state:()=>({instancesForApp:[],instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(e){try{const a=await G.get(`/self-manage/installed-instance/app/${e}`);this.instancesForApp=a.data}catch(a){console.error("Failed to fetch app:",a)}},async getInstalledInstanceForRunning(e){try{const a=await G.get(`/self-manage/installed-instance/${e}`);this.instanceForRunning=a.data}catch(a){console.error("Failed to fetch app:",a)}}}}),X=g({__name:"app-snapshot-slide",props:{snapshots:{}},setup(i){const o=x(!1),r=x(!1),m=x(""),c=x(0),u=i;_(c,(e=>{void 0===e&&(e=0);const a=u.snapshots[e];d(a)}));const d=e=>{null!==e&&(r.value=!0,m.value=e)};return(i,u)=>(M(),w(k,null,[b(a,{"show-arrows":"",class:"pa-0 snapshots-slider-group",style:{"margin-left":"0rem","margin-right":"0"},"selected-class":"bg-success",modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=e=>c.value=e)},{default:L((()=>[(M(!0),w(k,null,F(i.snapshots,((e,a)=>(M(),j(p,{key:a},{default:L((({isSelected:a,toggle:t,selectedClass:n})=>[b(s,{class:"my-3 ma-4",width:"265",height:"160",onClick:t},{default:L((()=>[b(l,{cover:"",width:"100%",height:"100%",src:e},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"]),b(t,{class:"mx-10 my-16",modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=e=>o.value=e),width:"auto","min-width":"1200px","max-width":"1800px"},{default:L((()=>[b(s,null,{default:L((()=>[b(l,{src:m.value},null,8,["src"])])),_:1}),b(n,{icon:"mdi-close",location:"bottom center",absolute:"",elevation:"6",offset:"",onClick:u[1]||(u[1]=e=>o.value=!1)})])),_:1},8,["modelValue"]),b(I(e),{class:"window-no-drag",visible:r.value,imgs:i.snapshots,index:c.value,onHide:u[3]||(u[3]=e=>r.value=!1)},null,8,["visible","imgs","index"])],64))}}),Y={key:0,class:""},Z={key:1,class:""},ee=g({__name:"simple-install-btn",setup(e){const a=K();return(e,t)=>(M(),j(i,null,{default:L((()=>[I(a).instancesForApp&&I(a).instancesForApp.length>0?(M(),w("span",Y,C(e.$t("LMAppDetail.AppInstalled")),1)):$("",!0),I(a).instancesForApp&&0==I(a).instancesForApp.length?(M(),w("span",Z,C(e.$t("LMAppDetail.notInstalled")),1)):$("",!0)])),_:1}))}}),ae={style:{flex:"1"}},te={key:0,class:"d-flex ga-3 mx-4"},se=U(g({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(e){const a=e;return T((()=>{if(!a.lmAppData.installLimit)return[];return[...a.lmAppData.installLimit.os,...a.lmAppData.installLimit.hardware]})),(e,a)=>(M(),w(k,null,[b(o,{class:"mt-1 mx-1"},{default:L((()=>[V("div",null,[b(l,{src:e.lmAppData.icon,width:"7.5rem",height:"7.5rem",style:{"border-radius":"8px"}},null,8,["src"])]),V("div",ae,[b(r,{class:"",style:{"font-size":"1.375rem","font-weight":"bold"}},{default:L((()=>[z(C(e.lmAppData.name),1)])),_:1}),b(m,{class:"",style:{"font-size":"1rem",color:"#111",opacity:"1"}},{default:L((()=>[z(C(e.lmAppData.shortDesc),1)])),_:1}),b(ee)])])),_:1}),b(o,null,{default:L((()=>[b(c,null,{default:L((()=>[b(u,{class:"mt-2 mb-3 mx-4",style:{opacity:"1"},color:"#EBEBF7"}),b(r,{"primary-title":"",style:{"font-weight":"bold"}},{default:L((()=>[z(C(e.$t("LMAppDetail.AppFeatures")),1)])),_:1}),e.lmAppData.tags?(M(),w("div",te,[(M(!0),w(k,null,F(e.lmAppData.tags,((e,a)=>(M(),w("div",{class:"app-feature-tag px-4",key:a},C(e),1)))),128))])):$("",!0),b(u,{class:"mt-6 mb-2 mx-4",style:{opacity:"1"},color:"#EBEBF7"})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-14c8ebc5"]]),le={class:"text-medium-emphasis mr-2"},ne=["href"],pe={key:1},ie={class:"text-medium-emphasis mr-2"},oe={key:2},re={class:"text-medium-emphasis mr-2"},me={key:3},ce={class:"text-medium-emphasis mr-2"},ue={key:4},de={class:"text-medium-emphasis mr-2"},fe={key:5},Ae={class:"text-medium-emphasis mr-2"},he={key:6},ye={class:"text-medium-emphasis mr-2"},De={key:7},ve={class:"text-medium-emphasis mr-2"},ge=g({__name:"extra-info",props:{lmAppData:{}},setup(e){const{t:a}=d(),t=e=>{let t=a("LMAppDetail.refLinkOther");return"homepage"===e.type?t=a("LMAppDetail.refLinkHomePage"):"github"===e.type&&(t=a("LMAppDetail.refLinkGithub")),t};return(e,a)=>(M(),j(f,{class:"mx-3 extra-info mt-3 mb-2"},{default:L((()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(M(!0),w(k,{key:0},F(e.lmAppData.refLinks,((e,a)=>(M(),w("p",{key:a},[V("span",le,C(t(e)),1),V("a",{href:e.url,target:"_blank"},C(e.url),9,ne)])))),128)):$("",!0),e.lmAppData?.newVersion?(M(),w("p",pe,[V("span",ie,C(e.$t("LMAppDetail.newVersion")),1),z(" "+C(e.lmAppData.newVersion),1)])):$("",!0),e.lmAppData?.releaseTime?(M(),w("p",oe,[V("span",re,C(e.$t("LMAppDetail.releaseTime")),1),z(" "+C(e.lmAppData.releaseTime),1)])):$("",!0),e.lmAppData?.licenseInfo?.licenseType?(M(),w("p",me,[V("span",ce,C(e.$t("LMAppDetail.licenseType")),1),z(" "+C(e.lmAppData?.licenseInfo?.licenseType),1)])):$("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(M(),w("p",ue,[V("span",de,C(e.$t("LMAppDetail.isOpenSource")),1),z(" "+C(e.lmAppData?.licenseInfo?.isOpenSource),1)])):$("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(M(),w("p",fe,[V("span",Ae,C(e.$t("LMAppDetail.isFullOpenSource")),1),z(" "+C(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):$("",!0),e.lmAppData?.licenseInfo?.isFree?(M(),w("p",he,[V("span",ye,C(e.$t("LMAppDetail.isFree")),1),z(" "+C(e.lmAppData?.licenseInfo?.isFree),1)])):$("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(M(),w("p",De,[V("span",ve,C(e.$t("LMAppDetail.sourceCodeRepo")),1),z(" "+C(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):$("",!0)])),_:1}))}}),xe={style:{"font-size":"14px",color:"#7D7D7D"},class:"text-center"},_e=g({__name:"installed-info-list",props:{lmAppData:{}},setup(e){const a=K(),t=x(),s=e;R((async()=>{n()}));const n=async()=>{await a.getInstalledInstanceForApp(s.lmAppData?.id),t.value=a.instancesForApp},p=async()=>{try{if(await q(s.lmAppData),await n(),t.value){const e=t.value[0];if(e){const a=e.id;P.openAppRunningWindow(a,N.INSTALL)}else console.error("data err firstInstallInstance",e)}}catch(e){console.error("install app err ",e)}},i=async()=>{n()},r=async()=>{n()};return(e,a)=>(M(),w(k,null,[b(A,{class:"my-2"}),I(t)&&I(t).length>0?(M(),j(f,{key:0,class:"d-flex flex-column ga-2",style:{width:"100%"}},{default:L((()=>[b(o,null,{default:L((()=>[(M(!0),w(k,null,F(I(t),((e,a)=>(M(),j(c,{key:a},{default:L((()=>[b(Q,{"app-version-visible":!0,"instance-data":e,onDeleted:i,onRefresh:r,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])])),_:2},1024)))),128))])),_:1})])),_:1})):$("",!0),I(t)&&0===I(t).length?(M(),j(f,{key:1,class:"d-flex flex-column ga-2 text-center justify-center"},{default:L((()=>[b(l,{width:"100%",height:"160",src:"./images/app/no-data.png"}),V("div",xe,C(e.$t("LMAppDetail.notInstalled")),1),b(A),b(h,{color:"primary",variant:"flat",onClick:p},{default:L((()=>[z(C(e.$t("LMAppDetail.install")),1)])),_:1})])),_:1})):$("",!0)],64))}}),we={class:"fullDescBlock overflow-y-hidden mx-6 mt-1 mb-4"},ke=["innerHTML"],be={class:"text-right justify-end mr-2",style:{width:"100%","margin-top":"-1rem",overflow:"visible",height:"1rem"}},Le=["innerHTML"],Fe=g({__name:"full-desc-text",props:{lmAppData:{}},setup(e){const a=x(!1),l=x(null),n=x(!1);let p;return R((()=>{p=new ResizeObserver((e=>{for(const a of e)a.target===l.value&&(n.value=a.contentRect.height>=200)})),l.value&&p.observe(l.value),l.value&&(n.value=l.value.scrollHeight>=200)})),S((()=>{p&&p.unobserve(l.value)})),(e,p)=>(M(),w(k,null,[b(o,null,{default:L((()=>[b(r,{class:"mb-0 mx-2",style:{"font-weight":"bold"}},{default:L((()=>[z(C(e.$t("LMAppDetail.AboutTheApp")),1)])),_:1}),V("div",we,[V("p",{ref_key:"visibleText",ref:l,innerHTML:e.lmAppData.desc},null,8,ke)]),V("div",be,[I(n)?(M(),j(h,{key:0,class:"mr-4",variant:"text",size:"small",active:!0,onClick:p[0]||(p[0]=e=>a.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",text:e.$t("LMAppDetail.More")},null,8,["text"])):$("",!0)])])),_:1}),b(t,{"min-width":"1000px","max-width":"1300px",modelValue:I(a),"onUpdate:modelValue":p[2]||(p[2]=e=>B(a)?a.value=e:null),width:"auto"},{default:L((()=>[b(s,{"prepend-icon":"mdi-text-box-outline",title:e.lmAppData.name},{actions:L((()=>[b(h,{class:"ms-auto",text:e.$t("LMAppDetail.Close"),onClick:p[1]||(p[1]=e=>a.value=!1)},null,8,["text"])])),default:L((()=>[b(i,{class:"mx-6 my-2"},{default:L((()=>[V("p",{innerHTML:e.lmAppData.desc},null,8,Le)])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Ie={style:{"font-size":"20px"}},Me={style:{"font-size":"1.25rem","font-weight":"bold"}},je=g({__name:"AppDetail",setup(e){const a=O(),t=W(),s=x({}),l=H();_((()=>a.params.id),((e,a)=>{console.log("app detail ",e,a)})),R((async()=>{const e=a.params.id;await t.fetchApp(e),s.value=t.currentLmApp}));const n=()=>{l.go(-1)};return(e,a)=>(M(),w(k,null,[b(D,{elevation:"0",class:"window-drag pt-4"},{prepend:L((()=>[b(h,{class:"window-no-drag",onClick:n,variant:"plain"},{default:L((()=>[b(y,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),V("span",Ie,C(e.$t("LMAppDetail.goBack")),1)])),_:1})])),append:L((()=>[b(J)])),_:1}),b(v,{class:"px-0 py-0",style:{"max-width":"none"}},{default:L((()=>[b(o,{class:"app-detail my-4 mx-6"},{default:L((()=>[b(c,{cols:"9"},{default:L((()=>[b(se,{lmAppData:I(s)},null,8,["lmAppData"]),I(s).snapshots?(M(),j(X,{key:0,snapshots:I(s).snapshots},null,8,["snapshots"])):$("",!0),b(A,{class:"mb-4"}),b(Fe,{"lm-app-data":I(s)},null,8,["lm-app-data"]),b(ge,{lmAppData:I(s)},null,8,["lmAppData"])])),_:1}),b(c,{class:"app-detail-container-sidebar px-4",cols:"3"},{default:L((()=>[V("div",Me,C(e.$t("LMAppDetail.InstallRecord")),1),I(s).id?(M(),j(_e,{key:0,lmAppData:I(s)},null,8,["lmAppData"])):$("",!0)])),_:1})])),_:1})])),_:1})],64))}});export{je as default};
