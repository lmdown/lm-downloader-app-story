import{N as e}from"./vue-easy-lightbox.js";import{u as a,w as t,x as s,b as l,y as n,z as p,A as i,i as o,B as r,r as m,C as c,D as d,s as u,t as f,E as A,n as h,F as y,d as g,G as D,o as _}from"./vuetify.js";import{e as v,b as x,l as k,a1 as L,F as w,k as b,$ as F,a2 as I,u as M,_ as j,Z as $,a4 as C,a0 as T,Q as R,a3 as V,c as z,H as S,y as B,j as H,a8 as O,a9 as E}from"./vue.js";import{c as U,A as G}from"./install-instance.js";import"./index2.js";import{A as N,_ as W}from"./single-installed-instance.vue_vue_type_style_index_0_lang.js";import{d as P}from"./pinia.js";import{a as Q}from"./index.js";import{_ as Z}from"./_plugin-vue_export-helper.js";import{u as q}from"./lmapp.js";import{_ as J}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./xterm.js";import"./dayjs.js";import"./debounce.js";import"./vuei18n.js";import"./lmd-locales.js";import"./common-util.js";const K=P("installedInstance",{state:()=>({instancesForApp:[],instancesForAppLoading:!1,instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(e){try{this.instancesForAppLoading=!0;const a=await Q.get(`/self-manage/installed-instance/app/${e}`);this.instancesForApp=a.data,this.instancesForAppLoading=!1}catch(a){console.error("Failed to fetch app:",a)}},async getInstalledInstanceForRunning(e){try{const a=await Q.get(`/self-manage/installed-instance/${e}`);this.instanceForRunning=a.data}catch(a){console.error("Failed to fetch app:",a)}}}}),X=v({__name:"app-snapshot-slide",props:{snapshots:{}},setup(i){const o=x(!1),r=x(!1),m=x(""),c=x(0),d=i;k(c,(e=>{void 0===e&&(e=0);const a=d.snapshots[e];u(a)}));const u=e=>{null!==e&&(r.value=!0,m.value=e)};return(i,d)=>(j(),L(w,null,[b(a,{"show-arrows":"",class:"pa-0 snapshots-slider-group",style:{"margin-left":"0rem","margin-right":"0"},"selected-class":"bg-success",modelValue:c.value,"onUpdate:modelValue":d[0]||(d[0]=e=>c.value=e)},{default:F((()=>[(j(!0),L(w,null,I(i.snapshots,((e,a)=>(j(),$(p,{key:a},{default:F((({isSelected:a,toggle:t,selectedClass:n})=>[b(s,{class:"my-3 ma-4",width:"265",height:"160",onClick:t},{default:F((()=>[b(l,{cover:"",width:"100%",height:"100%",src:e},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"]),b(t,{class:"mx-10 my-16",modelValue:o.value,"onUpdate:modelValue":d[2]||(d[2]=e=>o.value=e),width:"auto","min-width":"1200px","max-width":"1800px"},{default:F((()=>[b(s,null,{default:F((()=>[b(l,{src:m.value},null,8,["src"])])),_:1}),b(n,{icon:"mdi-close",location:"bottom center",absolute:"",elevation:"6",offset:"",onClick:d[1]||(d[1]=e=>o.value=!1)})])),_:1},8,["modelValue"]),b(M(e),{class:"window-no-drag",visible:r.value,imgs:i.snapshots,index:c.value,onHide:d[3]||(d[3]=e=>r.value=!1)},null,8,["visible","imgs","index"])],64))}}),Y={class:"mx-5"},ee=v({__name:"simple-install-btn",props:{lmAppData:{}},setup(e){const a=K(),t=e,s=async()=>{console.log("startInstallApp",t.lmAppData),await U(t.lmAppData),l()},l=async()=>{await a.getInstalledInstanceForApp(t.lmAppData?.id),n()},n=()=>{if(a.instancesForApp){const e=a.instancesForApp[0];if(e){const a=e.id;N.openAppRunningWindow(a,G.INSTALL)}else console.error("data err firstInstallInstance",e)}},p=()=>{const e=a.instancesForApp;e&&e.length>0&&N.openAppRunningWindow(e[0].id,G.INSTALL)};return(e,t)=>(j(),$(r,{style:{"padding-top":"1.3rem"}},{default:F((()=>[M(a).instancesForAppLoading?(j(),$(i,{key:0,color:"primary",indeterminate:""})):(j(),L(w,{key:1},[M(a).instancesForApp&&M(a).instancesForApp.length>0?(j(),L(w,{key:0},[M(a).instancesForApp&&M(a).instancesForApp.length>0?(j(),$(o,{key:0,variant:"flat",color:"primary",onClick:p},{default:F((()=>[R(V(e.$t("LMAppDetail.Reinstall")),1)])),_:1})):C("",!0),T("span",Y,V(e.$t("LMAppDetail.AppInstalled")),1)],64)):C("",!0),M(a).instancesForApp&&0==M(a).instancesForApp.length?(j(),L(w,{key:1},[M(a).instancesForApp&&0==M(a).instancesForApp.length?(j(),$(o,{key:0,variant:"flat",color:"primary",onClick:s},{default:F((()=>[R(V(e.$t("LMAppDetail.install")),1)])),_:1})):C("",!0)],64)):C("",!0)],64))])),_:1}))}}),ae={class:"mr-2"},te={style:{flex:"1"}},se={key:0,class:"d-flex ga-3 mx-4"},le=Z(v({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(e){const a=e;return z((()=>{if(!a.lmAppData.installLimit)return[];return[...a.lmAppData.installLimit.os,...a.lmAppData.installLimit.hardware]})),(e,a)=>(j(),L(w,null,[b(m,{class:"mt-1 mx-1"},{default:F((()=>[T("div",ae,[b(l,{src:e.lmAppData.icon,width:"7.5rem",height:"7.5rem",style:{"border-radius":"8px"}},null,8,["src"])]),T("div",te,[b(c,{class:"",style:{"font-size":"1.375rem","font-weight":"bold","padding-bottom":"0.2rem","padding-top":"0.0rem"}},{default:F((()=>[R(V(e.lmAppData.name),1)])),_:1}),b(d,{class:"",style:{"font-size":"1rem",color:"#111",opacity:"1"}},{default:F((()=>[R(V(e.lmAppData.shortDesc),1)])),_:1}),b(ee,{"lm-app-data":e.lmAppData},null,8,["lm-app-data"])])])),_:1}),b(m,null,{default:F((()=>[b(u,null,{default:F((()=>[b(f,{class:"mt-0 mb-3 mx-4",style:{opacity:"1"},color:"#EBEBF7"}),b(c,{"primary-title":"",style:{"font-weight":"bold"}},{default:F((()=>[R(V(e.$t("LMAppDetail.AppFeatures")),1)])),_:1}),e.lmAppData.tags?(j(),L("div",se,[(j(!0),L(w,null,I(e.lmAppData.tags,((e,a)=>(j(),L("div",{class:"app-feature-tag px-4",key:a},V(e),1)))),128))])):C("",!0),b(f,{class:"mt-6 mb-2 mx-4",style:{opacity:"1"},color:"#EBEBF7"})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-aa1f9717"]]),ne={class:"text-medium-emphasis mr-2"},pe=["href"],ie={key:1},oe={class:"text-medium-emphasis mr-2"},re={key:2},me={class:"text-medium-emphasis mr-2"},ce={key:3},de={class:"text-medium-emphasis mr-2"},ue={key:4},fe={class:"text-medium-emphasis mr-2"},Ae={key:5},he={class:"text-medium-emphasis mr-2"},ye={key:6},ge={class:"text-medium-emphasis mr-2"},De={key:7},_e={class:"text-medium-emphasis mr-2"},ve=v({__name:"extra-info",props:{lmAppData:{}},setup(e){const{t:a}=A(),t=e=>{let t=a("LMAppDetail.refLinkOther");return"homepage"===e.type?t=a("LMAppDetail.refLinkHomePage"):"github"===e.type&&(t=a("LMAppDetail.refLinkGithub")),t};return(e,a)=>(j(),$(h,{class:"mx-3 extra-info mt-3 mb-2"},{default:F((()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(j(!0),L(w,{key:0},I(e.lmAppData.refLinks,((e,a)=>(j(),L("p",{key:a},[T("span",ne,V(t(e)),1),T("a",{class:"ref-link",href:e.url,target:"_blank"},V(e.url),9,pe)])))),128)):C("",!0),e.lmAppData?.newVersion?(j(),L("p",ie,[T("span",oe,V(e.$t("LMAppDetail.newVersion")),1),R(" "+V(e.lmAppData.newVersion),1)])):C("",!0),e.lmAppData?.releaseTime?(j(),L("p",re,[T("span",me,V(e.$t("LMAppDetail.releaseTime")),1),R(" "+V(e.lmAppData.releaseTime),1)])):C("",!0),e.lmAppData?.licenseInfo?.licenseType?(j(),L("p",ce,[T("span",de,V(e.$t("LMAppDetail.licenseType")),1),R(" "+V(e.lmAppData?.licenseInfo?.licenseType),1)])):C("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(j(),L("p",ue,[T("span",fe,V(e.$t("LMAppDetail.isOpenSource")),1),R(" "+V(e.lmAppData?.licenseInfo?.isOpenSource),1)])):C("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(j(),L("p",Ae,[T("span",he,V(e.$t("LMAppDetail.isFullOpenSource")),1),R(" "+V(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):C("",!0),e.lmAppData?.licenseInfo?.isFree?(j(),L("p",ye,[T("span",ge,V(e.$t("LMAppDetail.isFree")),1),R(" "+V(e.lmAppData?.licenseInfo?.isFree),1)])):C("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(j(),L("p",De,[T("span",_e,V(e.$t("LMAppDetail.sourceCodeRepo")),1),R(" "+V(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):C("",!0)])),_:1}))}}),xe={style:{"font-size":"14px",color:"#7D7D7D"},class:"text-center"},ke=v({__name:"installed-info-list",props:{lmAppData:{}},setup(e){const a=K(),t=x(),s=e;S((async()=>{n()}));const n=async()=>{await a.getInstalledInstanceForApp(s.lmAppData?.id)};k((()=>a.instancesForApp),(async e=>{t.value=e}));const p=async()=>{n()},i=async()=>{n()};return(e,a)=>(j(),L(w,null,[b(y,{class:"my-2"}),M(t)&&M(t).length>0?(j(),$(h,{key:0,class:"d-flex flex-column ga-2",style:{width:"100%"}},{default:F((()=>[b(m,null,{default:F((()=>[(j(!0),L(w,null,I(M(t),((e,a)=>(j(),$(u,{key:a},{default:F((()=>[b(W,{"app-version-visible":!0,"instance-data":e,onDeleted:p,onRefresh:i,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])])),_:2},1024)))),128))])),_:1})])),_:1})):C("",!0),M(t)&&0===M(t).length?(j(),$(h,{key:1,class:"d-flex flex-column ga-2 text-center justify-center"},{default:F((()=>[b(l,{width:"100%",height:"160",src:"./images/app/no-data.png"}),T("div",xe,V(e.$t("LMAppDetail.notInstalled")),1)])),_:1})):C("",!0)],64))}}),Le={class:"fullDescBlock overflow-y-hidden mx-6 mt-1 mb-4"},we=["innerHTML"],be={class:"text-right justify-end mr-2",style:{width:"100%","margin-top":"-1rem",overflow:"visible",height:"1rem"}},Fe=["innerHTML"],Ie=v({__name:"full-desc-text",props:{lmAppData:{}},setup(e){const a=x(!1),l=x(null),n=x(!1);let p;return S((()=>{p=new ResizeObserver((e=>{for(const a of e)a.target===l.value&&(n.value=a.contentRect.height>=200)})),l.value&&p.observe(l.value),l.value&&(n.value=l.value.scrollHeight>=200)})),B((()=>{p&&p.unobserve(l.value)})),(e,p)=>(j(),L(w,null,[b(m,null,{default:F((()=>[b(u,{class:"px-0 py-0"},{default:F((()=>[b(c,{class:"mb-0 mx-2",style:{"font-weight":"bold"}},{default:F((()=>[R(V(e.$t("LMAppDetail.AboutTheApp")),1)])),_:1}),T("div",Le,[T("p",{ref_key:"visibleText",ref:l,innerHTML:e.lmAppData.desc},null,8,we)]),T("div",be,[M(n)?(j(),$(o,{key:0,class:"mr-4",variant:"text",size:"small",active:!0,onClick:p[0]||(p[0]=e=>a.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",text:e.$t("LMAppDetail.More")},null,8,["text"])):C("",!0)])])),_:1})])),_:1}),b(t,{"min-width":"1000px","max-width":"1300px",modelValue:M(a),"onUpdate:modelValue":p[2]||(p[2]=e=>H(a)?a.value=e:null),width:"auto"},{default:F((()=>[b(s,{"prepend-icon":"mdi-text-box-outline",title:e.lmAppData.name},{actions:F((()=>[b(o,{class:"ms-auto",text:e.$t("LMAppDetail.Close"),onClick:p[1]||(p[1]=e=>a.value=!1)},null,8,["text"])])),default:F((()=>[b(r,{class:"mx-6 my-2"},{default:F((()=>[T("p",{innerHTML:e.lmAppData.desc},null,8,Fe)])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Me={style:{"font-size":"20px"}},je={class:"mt-4"},$e={style:{"font-size":"1.25rem","font-weight":"bold"}},Ce=v({__name:"AppDetail",setup(e){const a=O(),t=q(),s=x({}),l=E();k((()=>a.params.id),((e,a)=>{console.log("app detail ",e,a)})),S((async()=>{const e=a.params.id;await t.fetchApp(e),s.value=t.currentLmApp}));const n=()=>{l.go(-1)};return(e,a)=>(j(),L(w,null,[b(D,{elevation:"0",class:"window-drag",height:"80"},{prepend:F((()=>[b(o,{class:"window-no-drag mt-4",onClick:n,variant:"plain"},{default:F((()=>[b(g,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),T("span",Me,V(e.$t("LMAppDetail.goBack")),1)])),_:1})])),append:F((()=>[T("div",je,[b(J)])])),_:1}),b(_,{class:"px-0 py-0",style:{"max-width":"none"}},{default:F((()=>[b(m,{class:"app-detail my-4 mx-6"},{default:F((()=>[b(u,{cols:"12",md:"8",lg:"9"},{default:F((()=>[b(le,{lmAppData:M(s)},null,8,["lmAppData"]),M(s).snapshots?(j(),$(X,{key:0,snapshots:M(s).snapshots},null,8,["snapshots"])):C("",!0),b(y,{class:"mb-1"}),b(Ie,{"lm-app-data":M(s)},null,8,["lm-app-data"]),b(ve,{lmAppData:M(s)},null,8,["lmAppData"])])),_:1}),b(u,{class:"app-detail-container-sidebar px-4",cols:"12",md:"4",lg:"3"},{default:F((()=>[T("div",$e,V(e.$t("LMAppDetail.InstallRecord")),1),M(s).id?(j(),$(ke,{key:0,lmAppData:M(s)},null,8,["lmAppData"])):C("",!0)])),_:1})])),_:1})])),_:1})],64))}});export{Ce as default};
