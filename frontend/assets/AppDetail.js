import{C as z,k as C,d as M,r as V,l as b,D as x,E as H,o as s,n as r,b as t,w as a,x as k,f as B,g as d,t as l,G as T,F as y,p as w,s as u,z as f,y as v,a as m,c as g,H as N,i as O,m as F,I as j,J as U,K as R,_ as E,L as G,B as $,M as P,N as J,O as K,P as Q,j as W,Q as q,V as X}from"./index.js";import"./index2.js";import{c as Y}from"./install-instance.js";import{A as Z}from"./AppScriptType.js";import{A as ee,_ as ae}from"./installed-instance-item.vue_vue_type_script_setup_true_lang.js";import{u as te}from"./lmapp.js";import{_ as se}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./IPCChannelName.js";const le=z("installedInstance",{state:()=>({instancesForApp:[],instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(h){try{const n=await C.get(`/self-manage/installed-instance/app/${h}`);this.instancesForApp=n.data}catch(n){console.error("Failed to fetch app:",n)}},async getInstalledInstanceForRunning(h){try{const n=await C.get(`/self-manage/installed-instance/${h}`);this.instanceForRunning=n.data}catch(n){console.error("Failed to fetch app:",n)}}}}),ne={key:0,class:"d-flex justify-end ga-3"},oe={key:1,class:"d-flex justify-end ga-3"},ie={class:"fullDescBlock overflow-y-hidden"},pe=["innerHTML"],re=["innerHTML"],S=200,ce=M({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(h){const n=h,o=V(null),e=V(!1),p=V(!1);let _;b(()=>{_=new ResizeObserver(i=>{for(let c of i)c.target===o.value&&(e.value=c.contentRect.height>=S)}),o.value&&_.observe(o.value),A()}),x(()=>{_&&_.unobserve(o.value)});function A(){o.value&&(e.value=o.value.scrollHeight>=S)}const L=H(()=>{if(!n.lmAppData.installLimit)return[];const i=n.lmAppData.installLimit.os,c=n.lmAppData.installLimit.hardware;return[...i,...c]});return(i,c)=>(s(),r(y,null,[t(v,null,{default:a(()=>[t(k,{cols:"12",md:"6",sm:"6"},{default:a(()=>[t(B,null,{default:a(()=>[d(l(i.lmAppData.name),1)]),_:1}),t(T,null,{default:a(()=>[d(l(i.lmAppData.shortDesc),1)]),_:1})]),_:1}),t(k,{cols:"12",md:"6",sm:"6",class:"d-flex flex-column ga-2 pt-4"},{default:a(()=>[i.lmAppData.tags?(s(),r("div",ne,[(s(!0),r(y,null,w(i.lmAppData.tags,(D,I)=>(s(),g(R,{variant:"tonal",size:"x-small",key:I},{default:a(()=>[d(l(D),1)]),_:2},1024))),128))])):u("",!0),i.lmAppData.tags?(s(),r("div",oe,[(s(!0),r(y,null,w(f(L),(D,I)=>(s(),g(R,{variant:"tonal",size:"x-small",key:I},{default:a(()=>[d(l(D?.trim()),1)]),_:2},1024))),128))])):u("",!0)]),_:1})]),_:1}),t(v,null,{default:a(()=>[m("div",ie,[m("p",{ref_key:"visibleText",ref:o,innerHTML:i.lmAppData.desc},null,8,pe)]),f(e)?(s(),g(N,{key:0,active:!0,class:"me-4",onClick:c[0]||(c[0]=D=>p.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",location:"bottom right",extended:"",absolute:"",offset:"",text:"More"})):u("",!0)]),_:1}),t(U,{modelValue:f(p),"onUpdate:modelValue":c[2]||(c[2]=D=>j(p)?p.value=D:null),width:"auto"},{default:a(()=>[t(O,{"prepend-icon":"mdi-text-box-outline",title:i.lmAppData.name},{actions:a(()=>[t(F,{class:"ms-auto",text:"Ok",onClick:c[1]||(c[1]=D=>p.value=!1)})]),default:a(()=>[t(T,{class:"mx-6 my-2"},{default:a(()=>[m("p",{innerHTML:i.lmAppData.desc},null,8,re)]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])],64))}}),ue=E(ce,[["__scopeId","data-v-a2dcc400"]]),me={class:"text-medium-emphasis mr-2"},de=["href"],fe={key:1},_e={class:"text-medium-emphasis mr-2"},Ae={key:2},he={class:"text-medium-emphasis mr-2"},De={key:3},ge={class:"text-medium-emphasis mr-2"},ye={key:4},ke={class:"text-medium-emphasis mr-2"},ve={key:5},Le={class:"text-medium-emphasis mr-2"},Ie={key:6},Ve={class:"text-medium-emphasis mr-2"},we={key:7},$e={class:"text-medium-emphasis mr-2"},Me=M({__name:"extra-info",props:{lmAppData:{}},setup(h){const{t:n}=G(),o=e=>{let p=n("LMAppDetail.refLinkOther");return e.type==="homepage"?p=n("LMAppDetail.refLinkHomePage"):e.type==="github"&&(p=n("LMAppDetail.refLinkGithub")),p};return(e,p)=>(s(),g($,{class:"mx-10"},{default:a(()=>[t(v,null,{default:a(()=>[t(k,null,{default:a(()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(s(!0),r(y,{key:0},w(e.lmAppData.refLinks,(_,A)=>(s(),r("p",{key:A},[m("span",me,l(o(_)),1),m("a",{href:_.url,target:"_blank"},l(_.url),9,de)]))),128)):u("",!0),e.lmAppData?.newVersion?(s(),r("p",fe,[m("span",_e,l(e.$t("LMAppDetail.newVersion")),1),d(" "+l(e.lmAppData.newVersion),1)])):u("",!0),e.lmAppData?.releaseTime?(s(),r("p",Ae,[m("span",he,l(e.$t("LMAppDetail.releaseTime")),1),d(" "+l(e.lmAppData.releaseTime),1)])):u("",!0),e.lmAppData?.licenseInfo?.licenseType?(s(),r("p",De,[m("span",ge,l(e.$t("LMAppDetail.licenseType")),1),d(" "+l(e.lmAppData?.licenseInfo?.licenseType),1)])):u("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(s(),r("p",ye,[m("span",ke,l(e.$t("LMAppDetail.isOpenSource")),1),d(" "+l(e.lmAppData?.licenseInfo?.isOpenSource),1)])):u("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(s(),r("p",ve,[m("span",Le,l(e.$t("LMAppDetail.isFullOpenSource")),1),d(" "+l(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):u("",!0),e.lmAppData?.licenseInfo?.isFree?(s(),r("p",Ie,[m("span",Ve,l(e.$t("LMAppDetail.isFree")),1),d(" "+l(e.lmAppData?.licenseInfo?.isFree),1)])):u("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(s(),r("p",we,[m("span",$e,l(e.$t("LMAppDetail.sourceCodeRepo")),1),d(" "+l(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):u("",!0)]),_:1})]),_:1})]),_:1}))}}),be=M({__name:"installed-info-list",props:{lmAppData:{}},setup(h){const n=le(),o=V(),e=h;b(async()=>{p()});const p=async()=>{await n.getInstalledInstanceForApp(e.lmAppData?.id),o.value=n.instancesForApp},_=async()=>{try{if(await Y(e.lmAppData),await p(),o.value){const i=o.value[0];if(i){const c=i.id;ee.openAppRunningWindow(c,Z.INSTALL)}else console.error("data err firstInstallInstance",i)}}catch(i){console.error("install app err ",i)}},A=async()=>{p()},L=async()=>{p()};return(i,c)=>(s(),r(y,null,[f(o)&&f(o).length>0?(s(),g($,{key:0,class:"mx-10 d-flex flex-column ga-2",style:{width:"100%"}},{default:a(()=>[t(v,null,{default:a(()=>[(s(!0),r(y,null,w(f(o),(D,I)=>(s(),g(k,{key:I,cols:"6"},{default:a(()=>[t(ae,{"instance-data":D,onDeleted:A,onRefresh:L,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])]),_:2},1024))),128))]),_:1})]),_:1})):u("",!0),f(o)&&f(o).length===0?(s(),g($,{key:1,class:"mx-10 d-flex flex-column ga-2"},{default:a(()=>[t(v,null,{default:a(()=>[t(k,{cols:"6"},{default:a(()=>[t(O,{class:"common-instance-card rounded-lg"},{actions:a(()=>[t(P),t(F,{color:"primary",variant:"outlined",onClick:_},{default:a(()=>[d(l(i.$t("LMAppDetail.install")),1)]),_:1})]),default:a(()=>[t(B,null,{default:a(()=>[d(l(i.$t("LMAppDetail.notInstalled")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):u("",!0)],64))}}),Fe={style:{"font-size":"20px"}},He=M({__name:"AppDetail",setup(h){const n=J(),o=te(),e=V({}),p=K();Q(()=>n.params.id,(A,L)=>{console.log("app detail ",A,L)}),b(async()=>{const A=n.params.id;await o.fetchApp(A),e.value=o.currentLmApp});const _=()=>{p.go(-1)};return(A,L)=>(s(),r(y,null,[t(W,{elevation:"0",class:"window-drag pt-4"},{prepend:a(()=>[t(F,{class:"window-no-drag",onClick:_,variant:"plain"},{default:a(()=>[t(q,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),m("span",Fe,l(A.$t("LMAppDetail.goBack")),1)]),_:1})]),append:a(()=>[t(se)]),_:1}),t($,{class:"mt-4"},{default:a(()=>[t(v,null,{default:a(()=>[t(k,{cols:"12",lg:"1",md:"2",sm:"3"},{default:a(()=>[t(X,{src:f(e).icon,cover:"",style:{"border-radius":"8px"}},null,8,["src"])]),_:1}),t(k,{cols:"12",lg:"11",md:"10",sm:"9"},{default:a(()=>[t(ue,{lmAppData:f(e)},null,8,["lmAppData"])]),_:1})]),_:1}),t(v,null,{default:a(()=>[f(e).id?(s(),g(be,{key:0,lmAppData:f(e)},null,8,["lmAppData"])):u("",!0),t(Me,{lmAppData:f(e)},null,8,["lmAppData"])]),_:1})]),_:1})],64))}});export{He as default};
