import{t as e,u as a,w as t,b as s,x as l,y as n,z as p,p as i,A as o,B as r,q as m,r as c,C as u,D as d,E as f,h as A,F as h,G as y,s as D}from"./vuetify.js";import{e as _,b as g,o as v,a6 as x,F as k,j as w,a4 as L,a7 as b,a3 as F,a2 as I,a8 as M,u as j,V as $,c as C,a5 as T,Q as V,G as z,x as R,k as S,aa as B,ab as O}from"./vue.js";import"./index2.js";import{d as H}from"./pinia.js";import{a as E,_ as G}from"./index.js";import{c as U}from"./install-instance.js";import{A as q}from"./AppScriptType.js";import{A as N,_ as P}from"./single-installed-instance.vue_vue_type_style_index_0_lang.js";import{u as Q}from"./lmapp.js";import{_ as W}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./vuei18n.js";import"./lmd-locales.js";import"./xterm.js";import"./dayjs.js";import"./common-util.js";const J=H("installedInstance",{state:()=>({instancesForApp:[],instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(e){try{const a=await E.get(`/self-manage/installed-instance/app/${e}`);this.instancesForApp=a.data}catch(a){console.error("Failed to fetch app:",a)}},async getInstalledInstanceForRunning(e){try{const a=await E.get(`/self-manage/installed-instance/${e}`);this.instanceForRunning=a.data}catch(a){console.error("Failed to fetch app:",a)}}}}),K=_({__name:"app-snapshot-slide",props:{snapshots:{}},setup(p){const i=g(!1),o=g(""),r=g(0),m=p;v(r,(e=>{void 0===e&&(e=0);const a=m.snapshots[e];c(a)}));const c=e=>{null!==e&&(i.value=!0,o.value=e)};return(p,m)=>(F(),x(k,null,[w(e,{"show-arrows":"",class:"pa-0 snapshots-slider-group",style:{"margin-left":"0rem","margin-right":"0"},"selected-class":"bg-success",modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=e=>r.value=e)},{default:L((()=>[(F(!0),x(k,null,b(p.snapshots,((e,a)=>(F(),I(n,{key:a},{default:L((({isSelected:a,toggle:l,selectedClass:n})=>[w(t,{class:"my-3 ma-4",width:"265",height:"160",onClick:l},{default:L((()=>[w(s,{cover:"",width:"100%",height:"100%",src:e},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"]),w(a,{class:"mx-10 my-16",modelValue:i.value,"onUpdate:modelValue":m[2]||(m[2]=e=>i.value=e),width:"auto","min-width":"1200px","max-width":"1800px"},{default:L((()=>[w(t,null,{default:L((()=>[w(s,{src:o.value},null,8,["src"])])),_:1}),w(l,{icon:"mdi-close",location:"bottom center",absolute:"",elevation:"6",offset:"",onClick:m[1]||(m[1]=e=>i.value=!1)})])),_:1},8,["modelValue"])],64))}}),X={key:0,class:""},Y={key:1,class:""},Z=_({__name:"simple-install-btn",setup(e){const a=J();return(e,t)=>(F(),I(p,null,{default:L((()=>[j(a).instancesForApp&&j(a).instancesForApp.length>0?(F(),x("span",X,$(e.$t("LMAppDetail.AppInstalled")),1)):M("",!0),j(a).instancesForApp&&0==j(a).instancesForApp.length?(F(),x("span",Y,$(e.$t("LMAppDetail.notInstalled")),1)):M("",!0)])),_:1}))}}),ee={style:{flex:"1"}},ae={key:0,class:"d-flex ga-3 mx-4"},te=G(_({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(e){const a=e;return C((()=>{if(!a.lmAppData.installLimit)return[];return[...a.lmAppData.installLimit.os,...a.lmAppData.installLimit.hardware]})),(e,a)=>(F(),x(k,null,[w(i,{class:"mt-1 mx-1"},{default:L((()=>[T("div",null,[w(s,{src:e.lmAppData.icon,width:"7.5rem",height:"7.5rem",style:{"border-radius":"8px"}},null,8,["src"])]),T("div",ee,[w(o,{class:"",style:{"font-size":"1.375rem","font-weight":"bold"}},{default:L((()=>[V($(e.lmAppData.name),1)])),_:1}),w(r,{class:"",style:{"font-size":"1rem",color:"#111",opacity:"1"}},{default:L((()=>[V($(e.lmAppData.shortDesc),1)])),_:1}),w(Z)])])),_:1}),w(i,null,{default:L((()=>[w(m,null,{default:L((()=>[w(c,{class:"mt-2 mb-3 mx-4",style:{opacity:"1"},color:"#EBEBF7"}),w(o,{"primary-title":"",style:{"font-weight":"bold"}},{default:L((()=>[V($(e.$t("LMAppDetail.AppFeatures")),1)])),_:1}),e.lmAppData.tags?(F(),x("div",ae,[(F(!0),x(k,null,b(e.lmAppData.tags,((e,a)=>(F(),x("div",{class:"app-feature-tag px-4",key:a},$(e),1)))),128))])):M("",!0),w(c,{class:"mt-6 mb-2 mx-4",style:{opacity:"1"},color:"#EBEBF7"})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-14c8ebc5"]]),se={class:"text-medium-emphasis mr-2"},le=["href"],ne={key:1},pe={class:"text-medium-emphasis mr-2"},ie={key:2},oe={class:"text-medium-emphasis mr-2"},re={key:3},me={class:"text-medium-emphasis mr-2"},ce={key:4},ue={class:"text-medium-emphasis mr-2"},de={key:5},fe={class:"text-medium-emphasis mr-2"},Ae={key:6},he={class:"text-medium-emphasis mr-2"},ye={key:7},De={class:"text-medium-emphasis mr-2"},_e=_({__name:"extra-info",props:{lmAppData:{}},setup(e){const{t:a}=u(),t=e=>{let t=a("LMAppDetail.refLinkOther");return"homepage"===e.type?t=a("LMAppDetail.refLinkHomePage"):"github"===e.type&&(t=a("LMAppDetail.refLinkGithub")),t};return(e,a)=>(F(),I(d,{class:"mx-3 extra-info mt-3 mb-2"},{default:L((()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(F(!0),x(k,{key:0},b(e.lmAppData.refLinks,((e,a)=>(F(),x("p",{key:a},[T("span",se,$(t(e)),1),T("a",{href:e.url,target:"_blank"},$(e.url),9,le)])))),128)):M("",!0),e.lmAppData?.newVersion?(F(),x("p",ne,[T("span",pe,$(e.$t("LMAppDetail.newVersion")),1),V(" "+$(e.lmAppData.newVersion),1)])):M("",!0),e.lmAppData?.releaseTime?(F(),x("p",ie,[T("span",oe,$(e.$t("LMAppDetail.releaseTime")),1),V(" "+$(e.lmAppData.releaseTime),1)])):M("",!0),e.lmAppData?.licenseInfo?.licenseType?(F(),x("p",re,[T("span",me,$(e.$t("LMAppDetail.licenseType")),1),V(" "+$(e.lmAppData?.licenseInfo?.licenseType),1)])):M("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(F(),x("p",ce,[T("span",ue,$(e.$t("LMAppDetail.isOpenSource")),1),V(" "+$(e.lmAppData?.licenseInfo?.isOpenSource),1)])):M("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(F(),x("p",de,[T("span",fe,$(e.$t("LMAppDetail.isFullOpenSource")),1),V(" "+$(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):M("",!0),e.lmAppData?.licenseInfo?.isFree?(F(),x("p",Ae,[T("span",he,$(e.$t("LMAppDetail.isFree")),1),V(" "+$(e.lmAppData?.licenseInfo?.isFree),1)])):M("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(F(),x("p",ye,[T("span",De,$(e.$t("LMAppDetail.sourceCodeRepo")),1),V(" "+$(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):M("",!0)])),_:1}))}}),ge={style:{"font-size":"14px",color:"#7D7D7D"},class:"text-center"},ve=_({__name:"installed-info-list",props:{lmAppData:{}},setup(e){const a=J(),t=g(),l=e;z((async()=>{n()}));const n=async()=>{await a.getInstalledInstanceForApp(l.lmAppData?.id),t.value=a.instancesForApp},p=async()=>{try{if(await U(l.lmAppData),await n(),t.value){const e=t.value[0];if(e){const a=e.id;N.openAppRunningWindow(a,q.INSTALL)}else console.error("data err firstInstallInstance",e)}}catch(e){console.error("install app err ",e)}},o=async()=>{n()},r=async()=>{n()};return(e,a)=>(F(),x(k,null,[w(f,{class:"my-2"}),j(t)&&j(t).length>0?(F(),I(d,{key:0,class:"d-flex flex-column ga-2",style:{width:"100%"}},{default:L((()=>[w(i,null,{default:L((()=>[(F(!0),x(k,null,b(j(t),((e,a)=>(F(),I(m,{key:a},{default:L((()=>[w(P,{"app-version-visible":!0,"instance-data":e,onDeleted:o,onRefresh:r,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])])),_:2},1024)))),128))])),_:1})])),_:1})):M("",!0),j(t)&&0===j(t).length?(F(),I(d,{key:1,class:"d-flex flex-column ga-2 text-center justify-center"},{default:L((()=>[w(s,{width:"100%",height:"160",src:"./images/app/no-data.png"}),T("div",ge,$(e.$t("LMAppDetail.notInstalled")),1),w(f),w(A,{color:"primary",variant:"flat",onClick:p},{default:L((()=>[V($(e.$t("LMAppDetail.install")),1)])),_:1})])),_:1})):M("",!0)],64))}}),xe={class:"fullDescBlock overflow-y-hidden mx-6 mt-1 mb-4"},ke=["innerHTML"],we={class:"text-right justify-end mr-2",style:{width:"100%","margin-top":"-1rem",overflow:"visible",height:"1rem"}},Le=["innerHTML"],be=_({__name:"full-desc-text",props:{lmAppData:{}},setup(e){const s=g(!1),l=g(null),n=g(!1);let r;return z((()=>{r=new ResizeObserver((e=>{for(const a of e)a.target===l.value&&(n.value=a.contentRect.height>=200)})),l.value&&r.observe(l.value),l.value&&(n.value=l.value.scrollHeight>=200)})),R((()=>{r&&r.unobserve(l.value)})),(e,r)=>(F(),x(k,null,[w(i,null,{default:L((()=>[w(o,{class:"mb-0 mx-2",style:{"font-weight":"bold"}},{default:L((()=>[V($(e.$t("LMAppDetail.AboutTheApp")),1)])),_:1}),T("div",xe,[T("p",{ref_key:"visibleText",ref:l,innerHTML:e.lmAppData.desc},null,8,ke)]),T("div",we,[j(n)?(F(),I(A,{key:0,class:"mr-4",variant:"text",size:"small",active:!0,onClick:r[0]||(r[0]=e=>s.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",text:e.$t("LMAppDetail.More")},null,8,["text"])):M("",!0)])])),_:1}),w(a,{"min-width":"1000px","max-width":"1300px",modelValue:j(s),"onUpdate:modelValue":r[2]||(r[2]=e=>S(s)?s.value=e:null),width:"auto"},{default:L((()=>[w(t,{"prepend-icon":"mdi-text-box-outline",title:e.lmAppData.name},{actions:L((()=>[w(A,{class:"ms-auto",text:e.$t("LMAppDetail.Close"),onClick:r[1]||(r[1]=e=>s.value=!1)},null,8,["text"])])),default:L((()=>[w(p,{class:"mx-6 my-2"},{default:L((()=>[T("p",{innerHTML:e.lmAppData.desc},null,8,Le)])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Fe={style:{"font-size":"20px"}},Ie={style:{"font-size":"1.25rem","font-weight":"bold"}},Me=_({__name:"AppDetail",setup(e){const a=B(),t=Q(),s=g({}),l=O();v((()=>a.params.id),((e,a)=>{console.log("app detail ",e,a)})),z((async()=>{const e=a.params.id;await t.fetchApp(e),s.value=t.currentLmApp}));const n=()=>{l.go(-1)};return(e,a)=>(F(),x(k,null,[w(y,{elevation:"0",class:"window-drag pt-4"},{prepend:L((()=>[w(A,{class:"window-no-drag",onClick:n,variant:"plain"},{default:L((()=>[w(h,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),T("span",Fe,$(e.$t("LMAppDetail.goBack")),1)])),_:1})])),append:L((()=>[w(W)])),_:1}),w(D,{class:"px-0 py-0",style:{"max-width":"none"}},{default:L((()=>[w(i,{class:"app-detail my-4 mx-6"},{default:L((()=>[w(m,{cols:"9"},{default:L((()=>[w(te,{lmAppData:j(s)},null,8,["lmAppData"]),j(s).snapshots?(F(),I(K,{key:0,snapshots:j(s).snapshots},null,8,["snapshots"])):M("",!0),w(f,{class:"mb-4"}),w(be,{"lm-app-data":j(s)},null,8,["lm-app-data"]),w(_e,{lmAppData:j(s)},null,8,["lmAppData"])])),_:1}),w(m,{class:"app-detail-container-sidebar px-4",cols:"3"},{default:L((()=>[T("div",Ie,$(e.$t("LMAppDetail.InstallRecord")),1),j(s).id?(F(),I(ve,{key:0,lmAppData:j(s)},null,8,["lmAppData"])):M("",!0)])),_:1})])),_:1})])),_:1})],64))}});export{Me as default};
