import{t as e,u as a,w as t,b as s,x as l,y as n,z as p,p as i,A as o,B as r,q as c,r as m,C as u,D as d,E as f,h as A,F as h,G as y,s as D}from"./vuetify.js";import{e as _,b as x,o as g,a6 as v,F as k,j as b,a4 as w,a7 as L,a3 as F,a2 as I,a8 as M,u as $,V as j,c as C,a5 as T,Q as V,G as R,x as z,k as S,aa as B,ab as O}from"./vue.js";import"./index2.js";import{d as H}from"./pinia.js";import{a as E,_ as G}from"./index.js";import{c as U}from"./install-instance.js";import{A as q}from"./AppScriptType.js";import{A as N,_ as P}from"./single-installed-instance.vue_vue_type_style_index_0_lang.js";import{u as Q}from"./lmapp.js";import{_ as W}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./vuei18n.js";import"./lmd-locales.js";import"./xterm.js";import"./dayjs.js";import"./common-util.js";const J=H("installedInstance",{state:()=>({instancesForApp:[],instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(e){try{const a=await E.get(`/self-manage/installed-instance/app/${e}`);this.instancesForApp=a.data}catch(a){console.error("Failed to fetch app:",a)}},async getInstalledInstanceForRunning(e){try{const a=await E.get(`/self-manage/installed-instance/${e}`);this.instanceForRunning=a.data}catch(a){console.error("Failed to fetch app:",a)}}}}),K=_({__name:"app-snapshot-slide",props:{snapshots:{}},setup(p){const i=x(!1),o=x(""),r=x(0),c=p;g(r,(e=>{void 0===e&&(e=0);const a=c.snapshots[e];m(a)}));const m=e=>{null!==e&&(i.value=!0,o.value=e)};return(p,c)=>(F(),v(k,null,[b(e,{"show-arrows":"",class:"pa-0 snapshots-slider-group",style:{"margin-left":"0rem","margin-right":"0"},"selected-class":"bg-success",modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=e=>r.value=e)},{default:w((()=>[(F(!0),v(k,null,L(p.snapshots,((e,a)=>(F(),I(n,{key:a},{default:w((({isSelected:a,toggle:l,selectedClass:n})=>[b(t,{class:"my-3 ma-4",width:"265",height:"160",onClick:l},{default:w((()=>[b(s,{cover:"",width:"100%",height:"100%",src:e},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"]),b(a,{class:"mx-10 my-16",modelValue:i.value,"onUpdate:modelValue":c[2]||(c[2]=e=>i.value=e),width:"auto","min-width":"1200px","max-width":"1800px"},{default:w((()=>[b(t,null,{default:w((()=>[b(s,{src:o.value},null,8,["src"])])),_:1}),b(l,{icon:"mdi-close",location:"bottom center",absolute:"",elevation:"6",offset:"",onClick:c[1]||(c[1]=e=>i.value=!1)})])),_:1},8,["modelValue"])],64))}}),X={key:0,class:""},Y={key:1,class:""},Z=_({__name:"simple-install-btn",setup(e){const a=J();return(e,t)=>(F(),I(p,null,{default:w((()=>[$(a).instancesForApp&&$(a).instancesForApp.length>0?(F(),v("span",X,j(e.$t("LMAppDetail.AppInstalled")),1)):M("",!0),$(a).instancesForApp&&0==$(a).instancesForApp.length?(F(),v("span",Y,j(e.$t("LMAppDetail.notInstalled")),1)):M("",!0)])),_:1}))}}),ee={style:{flex:"1"}},ae={key:0,class:"d-flex ga-3 mx-4"},te=G(_({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(e){const a=e;return C((()=>{if(!a.lmAppData.installLimit)return[];return[...a.lmAppData.installLimit.os,...a.lmAppData.installLimit.hardware]})),(e,a)=>(F(),v(k,null,[b(i,{class:"mt-1 mx-1"},{default:w((()=>[T("div",null,[b(s,{src:e.lmAppData.icon,width:"7.5rem",height:"7.5rem",style:{"border-radius":"8px"}},null,8,["src"])]),T("div",ee,[b(o,{class:"",style:{"font-size":"1.375rem","font-weight":"bold"}},{default:w((()=>[V(j(e.lmAppData.name),1)])),_:1}),b(r,{class:"",style:{"font-size":"1rem",color:"#111",opacity:"1"}},{default:w((()=>[V(j(e.lmAppData.shortDesc),1)])),_:1}),b(Z)])])),_:1}),b(i,null,{default:w((()=>[b(c,null,{default:w((()=>[b(m,{class:"mt-2 mb-3 mx-4",style:{opacity:"1"},color:"#EBEBF7"}),b(o,{"primary-title":"",style:{"font-weight":"bold"}},{default:w((()=>[V(j(e.$t("LMAppDetail.AppFeatures")),1)])),_:1}),e.lmAppData.tags?(F(),v("div",ae,[(F(!0),v(k,null,L(e.lmAppData.tags,((e,a)=>(F(),v("div",{class:"app-feature-tag px-4",key:a},j(e),1)))),128))])):M("",!0),b(m,{class:"mt-6 mb-2 mx-4",style:{opacity:"1"},color:"#EBEBF7"})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-14c8ebc5"]]),se={class:"text-medium-emphasis mr-2"},le=["href"],ne={key:1},pe={class:"text-medium-emphasis mr-2"},ie={key:2},oe={class:"text-medium-emphasis mr-2"},re={key:3},ce={class:"text-medium-emphasis mr-2"},me={key:4},ue={class:"text-medium-emphasis mr-2"},de={key:5},fe={class:"text-medium-emphasis mr-2"},Ae={key:6},he={class:"text-medium-emphasis mr-2"},ye={key:7},De={class:"text-medium-emphasis mr-2"},_e=_({__name:"extra-info",props:{lmAppData:{}},setup(e){const{t:a}=u(),t=e=>{let t=a("LMAppDetail.refLinkOther");return"homepage"===e.type?t=a("LMAppDetail.refLinkHomePage"):"github"===e.type&&(t=a("LMAppDetail.refLinkGithub")),t};return(e,a)=>(F(),I(d,{class:"mx-3 extra-info mt-3 mb-2"},{default:w((()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(F(!0),v(k,{key:0},L(e.lmAppData.refLinks,((e,a)=>(F(),v("p",{key:a},[T("span",se,j(t(e)),1),T("a",{href:e.url,target:"_blank"},j(e.url),9,le)])))),128)):M("",!0),e.lmAppData?.newVersion?(F(),v("p",ne,[T("span",pe,j(e.$t("LMAppDetail.newVersion")),1),V(" "+j(e.lmAppData.newVersion),1)])):M("",!0),e.lmAppData?.releaseTime?(F(),v("p",ie,[T("span",oe,j(e.$t("LMAppDetail.releaseTime")),1),V(" "+j(e.lmAppData.releaseTime),1)])):M("",!0),e.lmAppData?.licenseInfo?.licenseType?(F(),v("p",re,[T("span",ce,j(e.$t("LMAppDetail.licenseType")),1),V(" "+j(e.lmAppData?.licenseInfo?.licenseType),1)])):M("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(F(),v("p",me,[T("span",ue,j(e.$t("LMAppDetail.isOpenSource")),1),V(" "+j(e.lmAppData?.licenseInfo?.isOpenSource),1)])):M("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(F(),v("p",de,[T("span",fe,j(e.$t("LMAppDetail.isFullOpenSource")),1),V(" "+j(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):M("",!0),e.lmAppData?.licenseInfo?.isFree?(F(),v("p",Ae,[T("span",he,j(e.$t("LMAppDetail.isFree")),1),V(" "+j(e.lmAppData?.licenseInfo?.isFree),1)])):M("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(F(),v("p",ye,[T("span",De,j(e.$t("LMAppDetail.sourceCodeRepo")),1),V(" "+j(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):M("",!0)])),_:1}))}}),xe={style:{"font-size":"14px",color:"#7D7D7D"},class:"text-center"},ge=_({__name:"installed-info-list",props:{lmAppData:{}},setup(e){const a=J(),t=x(),l=e;R((async()=>{n()}));const n=async()=>{await a.getInstalledInstanceForApp(l.lmAppData?.id),t.value=a.instancesForApp},p=async()=>{try{if(await U(l.lmAppData),await n(),t.value){const e=t.value[0];if(e){const a=e.id;N.openAppRunningWindow(a,q.INSTALL)}else console.error("data err firstInstallInstance",e)}}catch(e){console.error("install app err ",e)}},o=async()=>{n()},r=async()=>{n()};return(e,a)=>(F(),v(k,null,[b(f,{class:"my-2"}),$(t)&&$(t).length>0?(F(),I(d,{key:0,class:"d-flex flex-column ga-2",style:{width:"100%"}},{default:w((()=>[b(i,null,{default:w((()=>[(F(!0),v(k,null,L($(t),((e,a)=>(F(),I(c,{key:a},{default:w((()=>[b(P,{"app-version-visible":!0,"instance-data":e,onDeleted:o,onRefresh:r,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])])),_:2},1024)))),128))])),_:1})])),_:1})):M("",!0),$(t)&&0===$(t).length?(F(),I(d,{key:1,class:"d-flex flex-column ga-2 text-center justify-center"},{default:w((()=>[b(s,{width:"100%",height:"160",src:"./images/app/no-data.png"}),T("div",xe,j(e.$t("LMAppDetail.notInstalled")),1),b(f),b(A,{color:"primary",variant:"flat",onClick:p},{default:w((()=>[V(j(e.$t("LMAppDetail.install")),1)])),_:1})])),_:1})):M("",!0)],64))}}),ve={class:"fullDescBlock overflow-y-hidden mx-6 mt-1 mb-4"},ke=["innerHTML"],be=["innerHTML"],we=_({__name:"full-desc-text",props:{lmAppData:{}},setup(e){const s=x(!1),n=x(null),r=x(!1);let c;return R((()=>{c=new ResizeObserver((e=>{for(const a of e)a.target===n.value&&(r.value=a.contentRect.height>=200)})),n.value&&c.observe(n.value),n.value&&(r.value=n.value.scrollHeight>=200)})),z((()=>{c&&c.unobserve(n.value)})),(e,c)=>(F(),v(k,null,[b(i,null,{default:w((()=>[b(o,{class:"mb-0 mx-2",style:{"font-weight":"bold"}},{default:w((()=>[V(j(e.$t("LMAppDetail.AboutTheApp")),1)])),_:1}),T("div",ve,[T("p",{ref_key:"visibleText",ref:n,innerHTML:e.lmAppData.desc},null,8,ke)]),$(r)?(F(),I(l,{key:0,class:"mr-4",active:!0,onClick:c[0]||(c[0]=e=>s.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",location:"bottom end",extended:"",absolute:"",offset:"",text:e.$t("LMAppDetail.More")},null,8,["text"])):M("",!0)])),_:1}),b(a,{"min-width":"1000px","max-width":"1300px",modelValue:$(s),"onUpdate:modelValue":c[2]||(c[2]=e=>S(s)?s.value=e:null),width:"auto"},{default:w((()=>[b(t,{"prepend-icon":"mdi-text-box-outline",title:e.lmAppData.name},{actions:w((()=>[b(A,{class:"ms-auto",text:e.$t("LMAppDetail.Close"),onClick:c[1]||(c[1]=e=>s.value=!1)},null,8,["text"])])),default:w((()=>[b(p,{class:"mx-6 my-2"},{default:w((()=>[T("p",{innerHTML:e.lmAppData.desc},null,8,be)])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Le={style:{"font-size":"20px"}},Fe={style:{"font-size":"1.25rem","font-weight":"bold"}},Ie=_({__name:"AppDetail",setup(e){const a=B(),t=Q(),s=x({}),l=O();g((()=>a.params.id),((e,a)=>{console.log("app detail ",e,a)})),R((async()=>{const e=a.params.id;await t.fetchApp(e),s.value=t.currentLmApp}));const n=()=>{l.go(-1)};return(e,a)=>(F(),v(k,null,[b(y,{elevation:"0",class:"window-drag pt-4"},{prepend:w((()=>[b(A,{class:"window-no-drag",onClick:n,variant:"plain"},{default:w((()=>[b(h,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),T("span",Le,j(e.$t("LMAppDetail.goBack")),1)])),_:1})])),append:w((()=>[b(W)])),_:1}),b(D,{class:"px-0 py-0",style:{"max-width":"none"}},{default:w((()=>[b(i,{class:"app-detail my-4 mx-6"},{default:w((()=>[b(c,{cols:"9"},{default:w((()=>[b(te,{lmAppData:$(s)},null,8,["lmAppData"]),$(s).snapshots?(F(),I(K,{key:0,snapshots:$(s).snapshots},null,8,["snapshots"])):M("",!0),b(f,{class:"mb-4"}),b(we,{"lm-app-data":$(s)},null,8,["lm-app-data"]),b(_e,{lmAppData:$(s)},null,8,["lmAppData"])])),_:1}),b(c,{class:"app-detail-container-sidebar px-4",cols:"3"},{default:w((()=>[T("div",Fe,j(e.$t("LMAppDetail.InstallRecord")),1),$(s).id?(F(),I(ge,{key:0,lmAppData:$(s)},null,8,["lmAppData"])):M("",!0)])),_:1})])),_:1})])),_:1})],64))}});export{Ie as default};
