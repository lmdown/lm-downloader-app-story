import{N as e}from"./vue-easy-lightbox.js";import{u as a,w as l,x as t,b as s,y as n,z as i,A as p,B as o,n as r,C as m,D as c,E as u,F as d,i as f,G as A,r as g,s as y,t as h,d as v,H as D,o as _}from"./vuetify.js";import{e as x,b,l as L,a1 as k,F as w,k as F,$ as I,a2 as M,u as $,_ as V,Z as j,Q as T,a3 as C,a0 as B,a4 as R,d as S,j as z,c as H,H as O,y as E,a8 as U,a9 as G}from"./vue.js";import{c as N,A as W}from"./install-instance.js";import"./index2.js";import{A as q,_ as P}from"./single-installed-instance.vue_vue_type_style_index_0_lang.js";import{i as Q,c as Z}from"./lmd-system.js";import{d as J}from"./pinia.js";import{a as K}from"./index.js";import{_ as X}from"./_plugin-vue_export-helper.js";import{u as Y}from"./lmapp.js";import{_ as ee}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./xterm.js";import"./dayjs.js";import"./debounce.js";import"./vuei18n.js";import"./lmd-locales.js";import"./common-util.js";const ae=J("installedInstance",{state:()=>({instancesForApp:[],instancesForAppLoading:!1,instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(e){try{this.instancesForAppLoading=!0;const a=await K.get(`/self-manage/installed-instance/app/${e}`);this.instancesForApp=a.data,this.instancesForAppLoading=!1}catch(a){console.error("Failed to fetch app:",a)}},async getInstalledInstanceForRunning(e){try{const a=await K.get(`/self-manage/installed-instance/${e}`);this.instanceForRunning=a.data}catch(a){console.error("Failed to fetch app:",a)}}}}),le=x({__name:"app-snapshot-slide",props:{snapshots:{}},setup(p){const o=b(!1),r=b(!1),m=b(""),c=b(0),u=p;L(c,(e=>{void 0===e&&(e=0);const a=u.snapshots[e];d(a)}));const d=e=>{null!==e&&(r.value=!0,m.value=e)};return(p,u)=>(V(),k(w,null,[F(a,{"show-arrows":"",class:"pa-0 snapshots-slider-group",style:{"margin-left":"0rem","margin-right":"0"},"selected-class":"bg-success",modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=e=>c.value=e)},{default:I((()=>[(V(!0),k(w,null,M(p.snapshots,((e,a)=>(V(),j(i,{key:a},{default:I((({isSelected:a,toggle:l,selectedClass:n})=>[F(t,{class:"my-3 ma-4",width:"265",height:"160",onClick:l},{default:I((()=>[F(s,{cover:"",width:"100%",height:"100%",src:e},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"]),F(l,{class:"mx-10 my-16",modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=e=>o.value=e),width:"auto","min-width":"1200px","max-width":"1800px"},{default:I((()=>[F(t,null,{default:I((()=>[F(s,{src:m.value},null,8,["src"])])),_:1}),F(n,{icon:"mdi-close",location:"bottom center",absolute:"",elevation:"6",offset:"",onClick:u[1]||(u[1]=e=>o.value=!1)})])),_:1},8,["modelValue"]),F($(e),{class:"window-no-drag",visible:r.value,imgs:p.snapshots,index:c.value,onHide:u[3]||(u[3]=e=>r.value=!1)},null,8,["visible","imgs","index"])],64))}}),te=x({__name:"install-confirm-dialog",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""},title2:{type:String,default:""},message:{type:String,default:""},cancelBtnLabel:{type:String,default:""},confirmBtnLabel:{type:String,default:""}},emits:["update:modelValue","confirm","cancel"],setup(e,{emit:a}){const n=S("showToastMessage"),{t:i}=p(),A=e,g=a,y=b(A.modelValue),h=b(!1);L((()=>A.modelValue),(e=>{y.value=e})),L(y,(e=>{g("update:modelValue",e)}));const v=()=>{y.value=!1,g("cancel")},D=async()=>{h.value=!0;const e=await Q();if(!e)return n&&n(i("LMAppDetail.InstallToolDialogErrorMsg"),"error"),void(h.value=!1);console.log("installResult",e),y.value=!1,h.value=!1,g("confirm")};return(a,n)=>(V(),j(l,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),"max-width":"600","min-width":"250",persistent:h.value},{default:I((()=>[F(t,{class:"px-4"},{default:I((()=>[F(o,{class:"dialog-title"},{default:I((()=>[T(C(e.title),1)])),_:1}),F(r,{class:"d-flex flex-row pt-8 pb-4"},{default:I((()=>[B("div",null,[F(s,{src:"./images/app/task.svg",width:"164",height:"120"})]),F(r,{style:{flex:"1"}},{default:I((()=>[F(m,{class:"dialog-title2"},{default:I((()=>[T(C(e.title2),1)])),_:1}),F(c,null,{default:I((()=>[T(C(e.message),1)])),_:1})])),_:1})])),_:1}),F(u,null,{default:I((()=>[F(d),h.value?R("",!0):(V(),j(f,{key:0,variant:"outlined",onClick:v},{default:I((()=>[T(C(e.cancelBtnLabel),1)])),_:1})),F(f,{variant:"flat",color:"primary",onClick:D,disabled:h.value,loading:h.value},{default:I((()=>[T(C(e.confirmBtnLabel),1)])),_:1},8,["disabled","loading"])])),_:1})])),_:1})])),_:1},8,["modelValue","persistent"]))}}),se={class:"mx-5"},ne=x({__name:"simple-install-btn",props:{lmAppData:{}},setup(e){const a=ae(),l=b(!1),t=b(!1),s=e,n=()=>{l.value=!1},i=()=>{n()},p=()=>{n(),o()},o=()=>{t.value?m():g()},r=async e=>{t.value=e;const a=await Z();console.log("checkAndInstallGit",a,e),a?o():l.value=!0},m=async()=>{console.log("startInstallApp",s.lmAppData),await N(s.lmAppData),u()},u=async()=>{await a.getInstalledInstanceForApp(s.lmAppData?.id),d()},d=()=>{if(a.instancesForApp){const e=a.instancesForApp[0];if(e){const a=e.id;q.openAppRunningWindow(a,W.INSTALL)}else console.error("data err firstInstallInstance",e)}},g=()=>{const e=a.instancesForApp;e&&e.length>0&&q.openAppRunningWindow(e[0].id,W.INSTALL)};return(e,t)=>(V(),k(w,null,[F(c,{style:{"padding-top":"1.3rem"}},{default:I((()=>[$(a).instancesForAppLoading?(V(),j(A,{key:0,color:"primary",indeterminate:""})):(V(),k(w,{key:1},[$(a).instancesForApp&&$(a).instancesForApp.length>0?(V(),k(w,{key:0},[$(a).instancesForApp&&$(a).instancesForApp.length>0?(V(),j(f,{key:0,variant:"flat",color:"primary",onClick:t[0]||(t[0]=e=>r(!1))},{default:I((()=>[T(C(e.$t("LMAppDetail.Reinstall")),1)])),_:1})):R("",!0),B("span",se,C(e.$t("LMAppDetail.AppInstalled")),1)],64)):R("",!0),$(a).instancesForApp&&0==$(a).instancesForApp.length?(V(),k(w,{key:1},[$(a).instancesForApp&&0==$(a).instancesForApp.length?(V(),j(f,{key:0,variant:"flat",color:"primary",onClick:t[1]||(t[1]=e=>r(!0))},{default:I((()=>[T(C(e.$t("LMAppDetail.install")),1)])),_:1})):R("",!0)],64)):R("",!0)],64))])),_:1}),F(te,{modelValue:$(l),"onUpdate:modelValue":t[2]||(t[2]=e=>z(l)?l.value=e:null),title:e.$t("LMAppDetail.InstallToolDialogTitle"),title2:e.$t("LMAppDetail.InstallToolDialogTitle2"),message:e.$t("LMAppDetail.InstallToolDialogMsg"),"cancel-btn-label":e.$t("LMAppDetail.Cancel"),"confirm-btn-label":e.$t("LMAppDetail.InstallGitBtnLabel"),onConfirm:p,onCancel:i},null,8,["modelValue","title","title2","message","cancel-btn-label","confirm-btn-label"])],64))}}),ie={class:"mr-2"},pe={style:{flex:"1"}},oe={key:0,class:"d-flex ga-3 mx-4"},re=X(x({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(e){const a=e;return H((()=>{if(!a.lmAppData.installLimit)return[];return[...a.lmAppData.installLimit.os,...a.lmAppData.installLimit.hardware]})),(e,a)=>(V(),k(w,null,[F(g,{class:"mt-1 mx-1"},{default:I((()=>[B("div",ie,[F(s,{src:e.lmAppData.icon,width:"7.5rem",height:"7.5rem",style:{"border-radius":"8px"}},null,8,["src"])]),B("div",pe,[F(o,{class:"",style:{"font-size":"1.375rem","font-weight":"bold","padding-bottom":"0.2rem","padding-top":"0.0rem"}},{default:I((()=>[T(C(e.lmAppData.name),1)])),_:1}),F(m,{class:"",style:{"font-size":"1rem",color:"#111",opacity:"1"}},{default:I((()=>[T(C(e.lmAppData.shortDesc),1)])),_:1}),F(ne,{"lm-app-data":e.lmAppData},null,8,["lm-app-data"])])])),_:1}),F(g,null,{default:I((()=>[F(y,null,{default:I((()=>[F(h,{class:"mt-0 mb-3 mx-4",style:{opacity:"1"},color:"#EBEBF7"}),F(o,{"primary-title":"",style:{"font-weight":"bold"}},{default:I((()=>[T(C(e.$t("LMAppDetail.AppFeatures")),1)])),_:1}),e.lmAppData.tags?(V(),k("div",oe,[(V(!0),k(w,null,M(e.lmAppData.tags,((e,a)=>(V(),k("div",{class:"app-feature-tag px-4",key:a},C(e),1)))),128))])):R("",!0),F(h,{class:"mt-6 mb-2 mx-4",style:{opacity:"1"},color:"#EBEBF7"})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-aa1f9717"]]),me={class:"text-medium-emphasis mr-2"},ce=["href"],ue={key:1},de={class:"text-medium-emphasis mr-2"},fe={key:2},Ae={class:"text-medium-emphasis mr-2"},ge={key:3},ye={class:"text-medium-emphasis mr-2"},he={key:4},ve={class:"text-medium-emphasis mr-2"},De={key:5},_e={class:"text-medium-emphasis mr-2"},xe={key:6},be={class:"text-medium-emphasis mr-2"},Le={key:7},ke={class:"text-medium-emphasis mr-2"},we=x({__name:"extra-info",props:{lmAppData:{}},setup(e){const{t:a}=p(),l=e=>{let l=a("LMAppDetail.refLinkOther");return"homepage"===e.type?l=a("LMAppDetail.refLinkHomePage"):"github"===e.type&&(l=a("LMAppDetail.refLinkGithub")),l};return(e,a)=>(V(),j(r,{class:"mx-3 extra-info mt-3 mb-2"},{default:I((()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(V(!0),k(w,{key:0},M(e.lmAppData.refLinks,((e,a)=>(V(),k("p",{key:a},[B("span",me,C(l(e)),1),B("a",{class:"ref-link",href:e.url,target:"_blank"},C(e.url),9,ce)])))),128)):R("",!0),e.lmAppData?.newVersion?(V(),k("p",ue,[B("span",de,C(e.$t("LMAppDetail.newVersion")),1),T(" "+C(e.lmAppData.newVersion),1)])):R("",!0),e.lmAppData?.releaseTime?(V(),k("p",fe,[B("span",Ae,C(e.$t("LMAppDetail.releaseTime")),1),T(" "+C(e.lmAppData.releaseTime),1)])):R("",!0),e.lmAppData?.licenseInfo?.licenseType?(V(),k("p",ge,[B("span",ye,C(e.$t("LMAppDetail.licenseType")),1),T(" "+C(e.lmAppData?.licenseInfo?.licenseType),1)])):R("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(V(),k("p",he,[B("span",ve,C(e.$t("LMAppDetail.isOpenSource")),1),T(" "+C(e.lmAppData?.licenseInfo?.isOpenSource),1)])):R("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(V(),k("p",De,[B("span",_e,C(e.$t("LMAppDetail.isFullOpenSource")),1),T(" "+C(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):R("",!0),e.lmAppData?.licenseInfo?.isFree?(V(),k("p",xe,[B("span",be,C(e.$t("LMAppDetail.isFree")),1),T(" "+C(e.lmAppData?.licenseInfo?.isFree),1)])):R("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(V(),k("p",Le,[B("span",ke,C(e.$t("LMAppDetail.sourceCodeRepo")),1),T(" "+C(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):R("",!0)])),_:1}))}}),Fe={style:{"font-size":"14px",color:"#7D7D7D"},class:"text-center"},Ie=x({__name:"installed-info-list",props:{lmAppData:{}},setup(e){const a=ae(),l=b(),t=e;O((async()=>{n()}));const n=async()=>{await a.getInstalledInstanceForApp(t.lmAppData?.id)};L((()=>a.instancesForApp),(async e=>{l.value=e}));const i=async()=>{n()},p=async()=>{n()};return(e,a)=>(V(),k(w,null,[F(d,{class:"my-2"}),$(l)&&$(l).length>0?(V(),j(r,{key:0,class:"d-flex flex-column ga-2",style:{width:"100%"}},{default:I((()=>[F(g,null,{default:I((()=>[(V(!0),k(w,null,M($(l),((e,a)=>(V(),j(y,{key:a},{default:I((()=>[F(P,{"app-version-visible":!0,"instance-data":e,onDeleted:i,onRefresh:p,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])])),_:2},1024)))),128))])),_:1})])),_:1})):R("",!0),$(l)&&0===$(l).length?(V(),j(r,{key:1,class:"d-flex flex-column ga-2 text-center justify-center"},{default:I((()=>[F(s,{width:"100%",height:"160",src:"./images/app/no-data.svg"}),B("div",Fe,C(e.$t("LMAppDetail.notInstalled")),1)])),_:1})):R("",!0)],64))}}),Me={class:"fullDescBlock overflow-y-hidden mx-6 mt-1 mb-4"},$e=["innerHTML"],Ve={class:"text-right justify-end mr-2",style:{width:"100%","margin-top":"-1rem",overflow:"visible",height:"1rem"}},je=["innerHTML"],Te=x({__name:"full-desc-text",props:{lmAppData:{}},setup(e){const a=b(!1),s=b(null),n=b(!1);let i;return O((()=>{i=new ResizeObserver((e=>{for(const a of e)a.target===s.value&&(n.value=a.contentRect.height>=200)})),s.value&&i.observe(s.value),s.value&&(n.value=s.value.scrollHeight>=200)})),E((()=>{i&&i.unobserve(s.value)})),(e,i)=>(V(),k(w,null,[F(g,null,{default:I((()=>[F(y,{class:"px-0 py-0"},{default:I((()=>[F(o,{class:"mb-0 mx-2",style:{"font-weight":"bold"}},{default:I((()=>[T(C(e.$t("LMAppDetail.AboutTheApp")),1)])),_:1}),B("div",Me,[B("p",{ref_key:"visibleText",ref:s,innerHTML:e.lmAppData.desc},null,8,$e)]),B("div",Ve,[$(n)?(V(),j(f,{key:0,class:"mr-4",variant:"text",size:"small",active:!0,onClick:i[0]||(i[0]=e=>a.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",text:e.$t("LMAppDetail.More")},null,8,["text"])):R("",!0)])])),_:1})])),_:1}),F(l,{"min-width":"1000px","max-width":"1300px",modelValue:$(a),"onUpdate:modelValue":i[2]||(i[2]=e=>z(a)?a.value=e:null),width:"auto"},{default:I((()=>[F(t,{"prepend-icon":"mdi-text-box-outline",title:e.lmAppData.name},{actions:I((()=>[F(f,{class:"ms-auto",text:e.$t("LMAppDetail.Close"),onClick:i[1]||(i[1]=e=>a.value=!1)},null,8,["text"])])),default:I((()=>[F(c,{class:"mx-6 my-2"},{default:I((()=>[B("p",{innerHTML:e.lmAppData.desc},null,8,je)])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])],64))}}),Ce={style:{"font-size":"20px"}},Be={class:"mt-4"},Re={style:{"font-size":"1.25rem","font-weight":"bold"}},Se=x({__name:"AppDetail",setup(e){const a=U(),l=Y(),t=b({}),s=G();L((()=>a.params.id),((e,a)=>{console.log("app detail ",e,a)})),O((async()=>{const e=a.params.id;await l.fetchApp(e),t.value=l.currentLmApp}));const n=()=>{s.go(-1)};return(e,a)=>(V(),k(w,null,[F(D,{elevation:"0",class:"window-drag",height:"80"},{prepend:I((()=>[F(f,{class:"window-no-drag mt-4",onClick:n,variant:"plain"},{default:I((()=>[F(v,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),B("span",Ce,C(e.$t("LMAppDetail.goBack")),1)])),_:1})])),append:I((()=>[B("div",Be,[F(ee)])])),_:1}),F(_,{class:"px-0 py-0",style:{"max-width":"none"}},{default:I((()=>[F(g,{class:"app-detail my-4 mx-6"},{default:I((()=>[F(y,{cols:"12",md:"8",lg:"9"},{default:I((()=>[F(re,{lmAppData:$(t)},null,8,["lmAppData"]),$(t).snapshots?(V(),j(le,{key:0,snapshots:$(t).snapshots},null,8,["snapshots"])):R("",!0),F(d,{class:"mb-1"}),F(Te,{"lm-app-data":$(t)},null,8,["lm-app-data"]),F(we,{lmAppData:$(t)},null,8,["lmAppData"])])),_:1}),F(y,{class:"app-detail-container-sidebar px-4",cols:"12",md:"4",lg:"3"},{default:I((()=>[B("div",Re,C(e.$t("LMAppDetail.InstallRecord")),1),$(t).id?(V(),j(Ie,{key:0,lmAppData:$(t)},null,8,["lmAppData"])):R("",!0)])),_:1})])),_:1})])),_:1})],64))}});export{Se as default};
