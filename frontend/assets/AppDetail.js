import{C as J,k as x,d as b,r as $,D as P,o as l,n as u,b as t,w as n,F as v,p as C,E as K,i as S,V as k,G as E,c as y,H as Q,z as A,t as o,s as f,I as T,J as H,a as r,f as R,g as _,h as q,y as w,x as V,e as z,_ as X,K as G,L as M,M as Y,N as Z,m as L,O as F,v as O,A as U,l as B,P as ee,Q as te,R as ae,S as se,T as ne,j as le,B as oe,U as ie}from"./index.js";import"./index2.js";import{c as pe}from"./_commonjsHelpers.js";import{A as re}from"./AppScriptType.js";import{D as ce,_ as de,A as j}from"./storage-simple-btn.vue_vue_type_script_setup_true_lang.js";import{u as ue}from"./lmapp.js";import{_ as me}from"./top-right-controls.vue_vue_type_style_index_0_lang.js";import"./IPCChannelName.js";const W=J("installedInstance",{state:()=>({instancesForApp:[],instanceForRunning:{}}),actions:{async getInstalledInstanceForApp(D){try{const s=await x.get(`/self-manage/installed-instance/app/${D}`);this.instancesForApp=s.data}catch(s){console.error("Failed to fetch app:",s)}},async getInstalledInstanceForRunning(D){try{const s=await x.get(`/self-manage/installed-instance/${D}`);this.instanceForRunning=s.data}catch(s){console.error("Failed to fetch app:",s)}}}}),fe=b({__name:"app-snapshot-slide",props:{snapshots:{}},setup(D){const s=$(!1),a=$(""),e=$(0),c=D;P(e,i=>{i===void 0&&(i=0);const d=c.snapshots[i];g(d)});const g=i=>{i!==null&&(s.value=!0,a.value=i)};return(i,d)=>(l(),u(v,null,[t(K,{"show-arrows":"",class:"pa-0 snapshots-slider-group",style:{"margin-left":"0rem","margin-right":"0"},"selected-class":"bg-success",modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=m=>e.value=m)},{default:n(()=>[(l(!0),u(v,null,C(i.snapshots,(m,p)=>(l(),y(Q,{key:p},{default:n(({isSelected:h,toggle:I,selectedClass:Ze})=>[t(S,{class:"my-3 ma-4",width:"265",height:"160",onClick:I},{default:n(()=>[t(k,{cover:"",width:"100%",height:"100%",src:m},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1},8,["modelValue"]),t(E,{class:"mx-10 my-16",modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=m=>s.value=m),width:"auto","min-width":"1200px","max-width":"1800px"},{default:n(()=>[t(S,null,{default:n(()=>[t(k,{src:a.value},null,8,["src"])]),_:1})]),_:1},8,["modelValue"])],64))}}),he={key:0,class:""},Ae={key:1,class:""},De=b({__name:"simple-install-btn",setup(D){const s=W();return(a,e)=>(l(),y(T,null,{default:n(()=>[A(s).instancesForApp&&A(s).instancesForApp.length>0?(l(),u("span",he,o(a.$t("LMAppDetail.AppInstalled")),1)):f("",!0),A(s).instancesForApp&&A(s).instancesForApp.length==0?(l(),u("span",Ae,o(a.$t("LMAppDetail.notInstalled")),1)):f("",!0)]),_:1}))}}),ge={style:{flex:"1"}},_e={key:0,class:"d-flex ga-3 mx-4"},ye=b({__name:"basic-info-and-tags",props:{lmAppData:{}},setup(D){const s=D;return H(()=>{if(!s.lmAppData.installLimit)return[];const a=s.lmAppData.installLimit.os,e=s.lmAppData.installLimit.hardware;return[...a,...e]}),(a,e)=>(l(),u(v,null,[t(w,{class:"mt-1 mx-1"},{default:n(()=>[r("div",null,[t(k,{src:a.lmAppData.icon,width:"7.5rem",height:"7.5rem",style:{"border-radius":"8px"}},null,8,["src"])]),r("div",ge,[t(R,{class:"pb-0 pt-1",style:{"font-size":"1.375rem","font-weight":"bold"}},{default:n(()=>[_(o(a.lmAppData.name),1)]),_:1}),t(q,{class:"pb-0 pt-0",style:{"font-size":"1rem",color:"#111",opacity:"1"}},{default:n(()=>[_(o(a.lmAppData.shortDesc),1)]),_:1}),t(De)])]),_:1}),t(w,null,{default:n(()=>[t(V,null,{default:n(()=>[t(z,{class:"mt-2 mb-3 mx-4",style:{opacity:"1"},color:"#EBEBF7"}),t(R,{"primary-title":"",style:{"font-weight":"bold"}},{default:n(()=>[_(o(a.$t("LMAppDetail.AppFeatures")),1)]),_:1}),a.lmAppData.tags?(l(),u("div",_e,[(l(!0),u(v,null,C(a.lmAppData.tags,(c,g)=>(l(),u("div",{class:"app-feature-tag px-4",key:g},o(c),1))),128))])):f("",!0),t(z,{class:"mt-6 mb-2 mx-4",style:{opacity:"1"},color:"#EBEBF7"})]),_:1})]),_:1})],64))}}),ve=X(ye,[["__scopeId","data-v-637db13c"]]),Ie={class:"text-medium-emphasis mr-2"},$e=["href"],be={key:1},ke={class:"text-medium-emphasis mr-2"},Le={key:2},we={class:"text-medium-emphasis mr-2"},Ve={key:3},Me={class:"text-medium-emphasis mr-2"},Fe={key:4},Ce={class:"text-medium-emphasis mr-2"},Se={key:5},Re={class:"text-medium-emphasis mr-2"},Te={key:6},Be={class:"text-medium-emphasis mr-2"},xe={key:7},ze={class:"text-medium-emphasis mr-2"},Oe=b({__name:"extra-info",props:{lmAppData:{}},setup(D){const{t:s}=G(),a=e=>{let c=s("LMAppDetail.refLinkOther");return e.type==="homepage"?c=s("LMAppDetail.refLinkHomePage"):e.type==="github"&&(c=s("LMAppDetail.refLinkGithub")),c};return(e,c)=>(l(),y(M,{class:"mx-3 extra-info mt-3 mb-2"},{default:n(()=>[e.lmAppData.refLinks&&e.lmAppData.refLinks.length>0?(l(!0),u(v,{key:0},C(e.lmAppData.refLinks,(g,i)=>(l(),u("p",{key:i},[r("span",Ie,o(a(g)),1),r("a",{href:g.url,target:"_blank"},o(g.url),9,$e)]))),128)):f("",!0),e.lmAppData?.newVersion?(l(),u("p",be,[r("span",ke,o(e.$t("LMAppDetail.newVersion")),1),_(" "+o(e.lmAppData.newVersion),1)])):f("",!0),e.lmAppData?.releaseTime?(l(),u("p",Le,[r("span",we,o(e.$t("LMAppDetail.releaseTime")),1),_(" "+o(e.lmAppData.releaseTime),1)])):f("",!0),e.lmAppData?.licenseInfo?.licenseType?(l(),u("p",Ve,[r("span",Me,o(e.$t("LMAppDetail.licenseType")),1),_(" "+o(e.lmAppData?.licenseInfo?.licenseType),1)])):f("",!0),e.lmAppData?.licenseInfo?.isOpenSource?(l(),u("p",Fe,[r("span",Ce,o(e.$t("LMAppDetail.isOpenSource")),1),_(" "+o(e.lmAppData?.licenseInfo?.isOpenSource),1)])):f("",!0),e.lmAppData?.licenseInfo?.isFullOpenSource?(l(),u("p",Se,[r("span",Re,o(e.$t("LMAppDetail.isFullOpenSource")),1),_(" "+o(e.lmAppData?.licenseInfo?.isFullOpenSource),1)])):f("",!0),e.lmAppData?.licenseInfo?.isFree?(l(),u("p",Te,[r("span",Be,o(e.$t("LMAppDetail.isFree")),1),_(" "+o(e.lmAppData?.licenseInfo?.isFree),1)])):f("",!0),e.lmAppData?.licenseInfo?.sourceCodeRepo?(l(),u("p",xe,[r("span",ze,o(e.$t("LMAppDetail.sourceCodeRepo")),1),_(" "+o(e.lmAppData?.licenseInfo?.sourceCodeRepo),1)])):f("",!0)]),_:1}))}}),Ue={key:1,class:"small-title-for-version"},Ne={class:"app-info-item align-center"},Pe={style:{flex:"1","text-align":"center"}},Ee={class:"app-info-item align-center"},He={key:2,style:{"text-align":"center"}},Ge=b({__name:"single-installed-instance",props:{appNameVisible:{type:Boolean},iconVisible:{type:Boolean},appVersionVisible:{type:Boolean},appIconUrl:{},instanceData:{}},emits:["deleted","refresh"],setup(D,{emit:s}){const{t:a}=G(),e=D,c=s;H(()=>{const p="./images/icons/lmd-logo.png",h={};return e.instanceData?(e.instanceData.installMethod==="import"?(h.type="icon",h.value="mdi-application-import",h.installMethodStr=a("InstalledApps.Imported")):(h.type="img",h.value=p,h.installMethodStr=a("InstalledApps.InstalledByLMD")),h):null});const g=()=>{console.log("gotoDetailPage",e.instanceData.appId),O.currentRoute.value.name!==U.AppDetail&&O.push({name:U.AppDetail,params:{id:e.instanceData.appId}})},i=p=>{j.openAppRunningWindow(p,"start")},d=()=>{c("deleted")},m=()=>{c("refresh")};return(p,h)=>p.instanceData?(l(),y(M,{key:0,"background-color":"#FFF6EE",class:"single-instance-card rounded-lg"},{default:n(()=>[p.iconVisible&&p.appIconUrl?(l(),y(T,{key:0},{default:n(()=>[t(k,{width:"68",height:"68",cover:"",style:{"border-radius":"8px",cursor:"pointer"},onClick:g,alt:p.instanceData.name,src:p.appIconUrl},null,8,["alt","src"])]),_:1})):f("",!0),p.appVersionVisible?(l(),u("div",Ue,o(p.$t("LMAppDetail.version"))+" "+o(p.instanceData.version),1)):f("",!0),r("div",Ne,[t(Y,{text:p.$t("LMAppDetail.installedAt"),location:"top"},{activator:n(({props:I})=>[r("div",null,[t(k,Z({width:"32",height:"2rem"},I,{src:"./images/app/install-time.png"}),null,16)])]),_:1},8,["text"]),r("div",Pe,o(A(ce).format(p.instanceData.createTime)),1)]),r("div",Ee,[r("div",null,[t(k,{width:"2rem",height:"2rem",src:"./images/app/model-dir.png"})]),t(L,{variant:"text",style:{flex:"1"}},{default:n(()=>[_(o(p.$t("LMAppDetail.appDirectory"))+" > ",1)]),_:1})]),t(F,{class:"mt-6"}),t(L,{variant:"flat",color:"primary",class:"control-btn",onClick:h[0]||(h[0]=I=>i(p.instanceData.id))},{default:n(()=>[_(o(p.$t("LMAppDetail.RunApp")),1)]),_:1}),p.instanceData.appInstallPath?f("",!0):(l(),u("div",He,[h[2]||(h[2]=r("div",{class:"mt-2"},null,-1)),t(de,{onDeleted:d,"installed-instance":p.instanceData},null,8,["installed-instance"]),t(L,{variant:"flat",color:"light-green-lighten-5","prepend-icon":"mdi-folder-refresh-outline",onClick:h[1]||(h[1]=I=>m())},{default:n(()=>[_(o(p.$t("StorageDialog.Refresh")),1)]),_:1}),h[3]||(h[3]=r("div",{class:"pb-2"},null,-1))]))]),_:1})):f("",!0)}}),je={style:{"font-size":"14px",color:"#7D7D7D"},class:"text-center"},We=b({__name:"installed-info-list",props:{lmAppData:{}},setup(D){const s=W(),a=$(),e=D;B(async()=>{c()});const c=async()=>{await s.getInstalledInstanceForApp(e.lmAppData?.id),a.value=s.instancesForApp},g=async()=>{try{if(await pe(e.lmAppData),await c(),a.value){const m=a.value[0];if(m){const p=m.id;j.openAppRunningWindow(p,re.INSTALL)}else console.error("data err firstInstallInstance",m)}}catch(m){console.error("install app err ",m)}},i=async()=>{c()},d=async()=>{c()};return(m,p)=>(l(),u(v,null,[t(F,{class:"my-2"}),A(a)&&A(a).length>0?(l(),y(M,{key:0,class:"d-flex flex-column ga-2",style:{width:"100%"}},{default:n(()=>[t(w,null,{default:n(()=>[(l(!0),u(v,null,C(A(a),(h,I)=>(l(),y(V,{key:I},{default:n(()=>[t(Ge,{"app-version-visible":!0,"instance-data":h,onDeleted:i,onRefresh:d,"app-name-visible":!0,"icon-visible":!1},null,8,["instance-data"])]),_:2},1024))),128))]),_:1})]),_:1})):f("",!0),A(a)&&A(a).length===0?(l(),y(M,{key:1,class:"d-flex flex-column ga-2 text-center justify-center"},{default:n(()=>[t(k,{width:"100%",height:"171",src:"./images/app/no-data.png"}),r("div",je,o(m.$t("LMAppDetail.notInstalled")),1),t(F),t(L,{color:"primary",variant:"flat",onClick:g},{default:n(()=>[_(o(m.$t("LMAppDetail.install")),1)]),_:1})]),_:1})):f("",!0)],64))}}),Je={class:"fullDescBlock overflow-y-hidden mx-6 mt-1 mb-4"},Ke=["innerHTML"],Qe=["innerHTML"],N=200,qe=b({__name:"full-desc-text",props:{lmAppData:{}},setup(D){const s=$(!1),a=$(null),e=$(!1);let c;B(()=>{c=new ResizeObserver(i=>{for(const d of i)d.target===a.value&&(e.value=d.contentRect.height>=N)}),a.value&&c.observe(a.value),g()}),ee(()=>{c&&c.unobserve(a.value)});function g(){a.value&&(e.value=a.value.scrollHeight>=N)}return(i,d)=>(l(),u(v,null,[t(w,null,{default:n(()=>[t(R,{class:"mb-0 mx-2",style:{"font-weight":"bold"}},{default:n(()=>[_(o(i.$t("LMAppDetail.AboutTheApp")),1)]),_:1}),r("div",Je,[r("p",{ref_key:"visibleText",ref:a,innerHTML:i.lmAppData.desc},null,8,Ke)]),A(e)?(l(),y(te,{key:0,class:"mr-4",active:!0,onClick:d[0]||(d[0]=m=>s.value=!0),"prepend-icon":"mdi-unfold-more-horizontal",location:"bottom end",extended:"",absolute:"",offset:"",text:i.$t("LMAppDetail.More")},null,8,["text"])):f("",!0)]),_:1}),t(E,{"min-width":"1000px","max-width":"1300px",modelValue:A(s),"onUpdate:modelValue":d[2]||(d[2]=m=>ae(s)?s.value=m:null),width:"auto"},{default:n(()=>[t(S,{"prepend-icon":"mdi-text-box-outline",title:i.lmAppData.name},{actions:n(()=>[t(L,{class:"ms-auto",text:i.$t("LMAppDetail.Close"),onClick:d[1]||(d[1]=m=>s.value=!1)},null,8,["text"])]),default:n(()=>[t(T,{class:"mx-6 my-2"},{default:n(()=>[r("p",{innerHTML:i.lmAppData.desc},null,8,Qe)]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])],64))}}),Xe={style:{"font-size":"20px"}},Ye={style:{"font-size":"1.25rem","font-weight":"bold"}},pt=b({__name:"AppDetail",setup(D){const s=se(),a=ue(),e=$({}),c=ne();P(()=>s.params.id,(i,d)=>{console.log("app detail ",i,d)}),B(async()=>{const i=s.params.id;await a.fetchApp(i),e.value=a.currentLmApp});const g=()=>{c.go(-1)};return(i,d)=>(l(),u(v,null,[t(le,{elevation:"0",class:"window-drag pt-4"},{prepend:n(()=>[t(L,{class:"window-no-drag",onClick:g,variant:"plain"},{default:n(()=>[t(ie,{class:"lmd-back-icon mr-3",style:{"font-size":"1.4rem"},size:"36",icon:"mdi-chevron-left",color:"#FB6C00"}),r("span",Xe,o(i.$t("LMAppDetail.goBack")),1)]),_:1})]),append:n(()=>[t(me)]),_:1}),t(oe,{class:"px-0 py-0",style:{"max-width":"none"}},{default:n(()=>[t(w,{class:"app-detail my-4 mx-6"},{default:n(()=>[t(V,{cols:"9"},{default:n(()=>[t(ve,{lmAppData:A(e)},null,8,["lmAppData"]),A(e).snapshots?(l(),y(fe,{key:0,snapshots:A(e).snapshots},null,8,["snapshots"])):f("",!0),t(F,{class:"mb-4"}),t(qe,{"lm-app-data":A(e)},null,8,["lm-app-data"]),t(Oe,{lmAppData:A(e)},null,8,["lmAppData"])]),_:1}),t(V,{class:"app-detail-container-sidebar px-4",cols:"3"},{default:n(()=>[r("div",Ye,o(i.$t("LMAppDetail.InstallRecord")),1),A(e).id?(l(),y(We,{key:0,lmAppData:A(e)},null,8,["lmAppData"])):f("",!0)]),_:1})]),_:1})]),_:1})],64))}});export{pt as default};
